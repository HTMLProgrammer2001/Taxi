(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{126:function(e,t,n){"use strict";var r,i,o,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a=function(e){function a(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function o(n,r,i){var o,e=new Promise(function(e,t){a(o=n[r].apply(n,i)).then(e,t)});return e.request=o,e}function t(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return o(this[n],e,arguments)})})}function r(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function i(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=o(e,n,arguments)).then(function(e){if(e)return new u(e,t.request)});var e,t})})}function s(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function c(e){this._store=e}function h(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new h(n)}function f(e){this._db=e}t(s,"_index",["name","keyPath","multiEntry","unique"]),n(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),t(u,"_cursor",["direction","key","primaryKey","value"]),n(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(u.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),a(t._request).then(function(e){if(e)return new u(e,t._request)})})})}),c.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},t(c,"_store",["name","keyPath","indexNames","autoIncrement"]),n(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),r(c,"_store",IDBObjectStore,["deleteIndex"]),h.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},t(h,"_tx",["objectStoreNames","mode"]),r(h,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},t(l,"_db",["name","version","objectStoreNames"]),r(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new h(this._db.transaction.apply(this._db,arguments))},t(f,"_db",["name","version","objectStoreNames"]),r(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(o){[c,s].forEach(function(e){o in e.prototype&&(e.prototype[o.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,i=r[o].apply(r,t.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[s,c].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})}),e.openDb=function(e,t,n){var r=o(indexedDB,"open",[e,t]),i=r.request;return i&&(i.onupgradeneeded=function(e){n&&n(new l(i.result,e.oldVersion,i.transaction))}),r.then(function(e){return new f(e)})},e.deleteDb=function(e){return o(indexedDB,"deleteDatabase",[e])},Object.defineProperty(e,"__esModule",{value:!0})},"object"===s(t)&&void 0!==e?a(t):(i=[t],void 0===(o="function"==typeof(r=a)?r.apply(t,i):r)||(e.exports=o))},187:function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i,o=(i=n(16))&&"object"===(void 0===i?"undefined":r(i))&&"default"in i?i.default:i;n(124),n(123),n(188),n(190),n(191),n(127),n(192),n(193),n(194);
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
o.registerVersion("firebase","7.7.0","app");
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the module builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nCommonJS Modules:\nconst firebase = require('firebase/app');\nrequire('firebase/<PACKAGE>');\n\nES Modules:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n\nTypescript:\nimport * as firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n"),o.registerVersion("firebase","7.7.0"),e.exports=o},188:function(e,xh,Fh){"use strict";(function(t){var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(xh,"__esModule",{value:!0});var e,f,n,r=(e=Fh(16))&&"object"===(void 0===e?"undefined":l(e))&&"default"in e?e.default:e,m=Fh(17),o=Fh(57),d=Fh(32),i=Fh(27),p=Fh(189),a=r.SDK_VERSION,s=new o.Logger("@firebase/firestore");function g(){return s.logLevel===o.LogLevel.DEBUG?f.DEBUG:s.logLevel===o.LogLevel.SILENT?f.SILENT:f.ERROR}function u(e){switch(e){case f.DEBUG:s.logLevel=o.LogLevel.DEBUG;break;case f.ERROR:s.logLevel=o.LogLevel.ERROR;break;case f.SILENT:s.logLevel=o.LogLevel.SILENT;break;default:s.error("Firestore ("+a+"): Invalid value passed to `setLogLevel`")}}function y(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(s.logLevel<=o.LogLevel.DEBUG){var i=n.map(h);s.debug.apply(s,m.__spreadArrays(["Firestore ("+a+") ["+e+"]: "+t],i))}}function c(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(s.logLevel<=o.LogLevel.ERROR){var r=t.map(h);s.error.apply(s,m.__spreadArrays(["Firestore ("+a+"): "+e],r))}}function h(t){if("string"==typeof t)return t;var e=b.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w(e){var t="FIRESTORE ("+a+") INTERNAL ASSERTION FAILED: "+e;throw c(t),new Error(t)}function v(e,t){e||w(t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n=f=f||{})[n.DEBUG=0]="DEBUG",n[n.ERROR=1]="ERROR",n[n.SILENT=2]="SILENT";var b=(T.setPlatform=function(e){T.platform&&w("Platform already defined"),T.platform=e},T.getPlatform=function(){return T.platform||w("Platform not set"),T.platform},T);function T(){}function S(){return b.getPlatform().emptyByteString}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _,E={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},I=(_=Error,m.__extends(C,_),C);function C(e,t){var n=_.call(this,t)||this;return n.code=e,n.message=t,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D(e,t){function n(){var e="This constructor is private.";throw t&&(e+=" ",e+=t),new I(E.INVALID_ARGUMENT,e)}for(var r in n.prototype=e.prototype,e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function N(e,t){return void 0!==e?e:t}function k(e,t){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Number(n);isNaN(r)||t(r,e[n])}}function M(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function R(e){for(var t in v(null!=e&&"object"===(void 0===e?"undefined":l(e)),"isEmpty() expects object parameter."),e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O(e,t){if(0!==t.length)throw new I(E.INVALID_ARGUMENT,"Function "+e+"() does not support arguments, but was called with "+X(t.length,"argument")+".")}function L(e,t,n){if(t.length!==n)throw new I(E.INVALID_ARGUMENT,"Function "+e+"() requires "+X(n,"argument")+", but was called with "+X(t.length,"argument")+".")}function P(e,t,n){if(t.length<n)throw new I(E.INVALID_ARGUMENT,"Function "+e+"() requires at least "+X(n,"argument")+", but was called with "+X(t.length,"argument")+".")}function x(e,t,n,r){if(t.length<n||t.length>r)throw new I(E.INVALID_ARGUMENT,"Function "+e+"() requires between "+n+" and "+r+" arguments, but was called with "+X(t.length,"argument")+".")}function F(e,t,n,r){K(e,t,J(n)+" argument",r)}function q(e,t,n,r){void 0!==r&&F(e,t,n,r)}function V(e,t,n,r){K(e,t,n+" option",r)}function B(e,t,n,r){void 0!==r&&V(e,t,n,r)}function U(e,t,n,r,i){void 0!==r&&function(e,t,n,r,i){if(!(r instanceof Array))throw new I(E.INVALID_ARGUMENT,"Function "+e+"() requires its "+t+" option to be an array, but it was: "+G(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new I(E.INVALID_ARGUMENT,"Function "+e+"() requires all "+t+" elements to be "+n+", but the value at index "+o+" was: "+G(r[o]))}(e,t,n,r,i)}function j(e,t,n,r,i){void 0!==r&&function(e,t,n,r){for(var i=[],o=0,a=r;o<a.length;o++){var s=a[o];if(s===n)return;i.push(G(s))}var u=G(n);throw new I(E.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+e+'() for option "'+t+'". Acceptable values: '+i.join(", "))}(e,n,r,i)}function K(e,t,n,r){if(!("object"===t?W(r):"non-empty string"===t?"string"==typeof r&&""!==r:(void 0===r?"undefined":l(r))===t)){var i=G(r);throw new I(E.INVALID_ARGUMENT,"Function "+e+"() requires its "+n+" to be of type "+t+", but it was: "+i)}}function W(e){return"object"===(void 0===e?"undefined":l(e))&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function G(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!==(void 0===e?"undefined":l(e)))return"function"==typeof e?"a function":w("Unknown wrong type: "+(void 0===e?"undefined":l(e)));if(e instanceof Array)return"an array";var t=function(e){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}(e);return t?"a custom "+t+" object":"an object"}function Q(e,t,n){if(void 0===n)throw new I(E.INVALID_ARGUMENT,"Function "+e+"() requires a valid "+J(t)+" argument, but it was undefined.")}function z(n,e,r){M(e,function(e,t){if(r.indexOf(e)<0)throw new I(E.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function H(e,t,n,r){var i=G(r);return new I(E.INVALID_ARGUMENT,"Function "+e+"() requires its "+J(n)+" argument to be a "+t+", but it was: "+i)}function Y(e,t,n){if(n<=0)throw new I(E.INVALID_ARGUMENT,'Function "'+e+'()" requires its '+J(t)+" argument to be a positive number, but it was: "+n+".")}function J(e){switch(e){case 1:return"first";case 2:return"second";case 3:return"third";default:return e+"th"}}function X(e,t){return e+" "+t+(1===e?"":"s")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $=(Z.newId=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",n=0;n<20;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return v(20===t.length,"Invalid auto ID: "+t),t},Z);function Z(){}function ee(e,t){return e<t?-1:t<e?1:0}function te(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].isEqual(t[n]))return!1;return!0}function ne(e){return e+"\0"}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function re(){if("undefined"==typeof Uint8Array)throw new I(E.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ie(){if(!b.getPlatform().base64Available)throw new I(E.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var oe=(ae.fromBase64String=function(e){L("Blob.fromBase64String",arguments,1),F("Blob.fromBase64String","string",1,e),ie();try{return new ae(b.getPlatform().atob(e))}catch(e){throw new I(E.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+e)}},ae.fromUint8Array=function(e){if(L("Blob.fromUint8Array",arguments,1),re(),!(e instanceof Uint8Array))throw H("Blob.fromUint8Array","Uint8Array",1,e);return new ae(Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join(""))},ae.prototype.toBase64=function(){return L("Blob.toBase64",arguments,0),ie(),b.getPlatform().btoa(this._binaryString)},ae.prototype.toUint8Array=function(){L("Blob.toUint8Array",arguments,0),re();for(var e=new Uint8Array(this._binaryString.length),t=0;t<this._binaryString.length;t++)e[t]=this._binaryString.charCodeAt(t);return e},ae.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},ae.prototype.isEqual=function(e){return this._binaryString===e._binaryString},ae.prototype._compareTo=function(e){return ee(this._binaryString,e._binaryString)},ae);function ae(e){ie(),this._binaryString=e}var se=D(oe,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),ue=function(e,t,n,r,i){this.databaseId=e,this.persistenceKey=t,this.host=n,this.ssl=r,this.forceLongPolling=i},ce="(default)",he=(Object.defineProperty(le.prototype,"isDefaultDatabase",{get:function(){return this.database===ce},enumerable:!0,configurable:!0}),le.prototype.isEqual=function(e){return e instanceof le&&e.projectId===this.projectId&&e.database===this.database},le.prototype.compareTo=function(e){return ee(this.projectId,e.projectId)||ee(this.database,e.database)},le);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function le(e,t){this.projectId=e,this.database=t||ce}
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fe=(de.prototype.setPreviousValue=function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue},de.prototype.next=function(){var e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e},de.INVALID=-1,de);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function de(e,t){var n=this;this.previousValue=e,t&&(t.sequenceNumberHandler=function(e){return n.setPreviousValue(e)},this.writeNewSequenceNumber=function(e){return t.writeSequenceNumber(e)})}var pe="__name__",me=(Object.defineProperty(ge.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),ge.prototype.isEqual=function(e){return 0===ge.comparator(this,e)},ge.prototype.child=function(e){var t=this.segments.slice(this.offset,this.limit());return e instanceof ge?e.forEach(function(e){t.push(e)}):t.push(e),this.construct(t)},ge.prototype.limit=function(){return this.offset+this.length},ge.prototype.popFirst=function(e){return e=void 0===e?1:e,v(this.length>=e,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+e,this.length-e)},ge.prototype.popLast=function(){return v(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},ge.prototype.firstSegment=function(){return v(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},ge.prototype.lastSegment=function(){return this.get(this.length-1)},ge.prototype.get=function(e){return v(e<this.length,"Index out of range"),this.segments[this.offset+e]},ge.prototype.isEmpty=function(){return 0===this.length},ge.prototype.isPrefixOf=function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0},ge.prototype.isImmediateParentOf=function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0},ge.prototype.forEach=function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])},ge.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},ge.comparator=function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),o=t.get(r);if(i<o)return-1;if(o<i)return 1}return e.length<t.length?-1:e.length>t.length?1:0},ge);function ge(e,t,n){void 0===t?t=0:t>e.length&&w("offset "+t+" out of range "+e.length),void 0===n?n=e.length-t:n>e.length-t&&w("length "+n+" out of range "+(e.length-t)),this.segments=e,this.offset=t,this.len=n}var ye,ve=(ye=me,m.__extends(be,ye),be.prototype.construct=function(e,t,n){return new be(e,t,n)},be.prototype.canonicalString=function(){return this.toArray().join("/")},be.prototype.toString=function(){return this.canonicalString()},be.fromString=function(e){if(0<=e.indexOf("//"))throw new I(E.INVALID_ARGUMENT,"Invalid path ("+e+"). Paths must not contain // in them.");return new be(e.split("/").filter(function(e){return 0<e.length}))},be.EMPTY_PATH=new be([]),be);function be(){return null!==ye&&ye.apply(this,arguments)||this}var we,Te=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Se=(we=me,m.__extends(_e,we),_e.prototype.construct=function(e,t,n){return new _e(e,t,n)},_e.isValidIdentifier=function(e){return Te.test(e)},_e.prototype.canonicalString=function(){return this.toArray().map(function(e){return e=e.replace("\\","\\\\").replace("`","\\`"),_e.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")},_e.prototype.toString=function(){return this.canonicalString()},_e.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===pe},_e.keyField=function(){return new _e([pe])},_e.fromServerFormat=function(e){for(var t=[],n="",r=0,i=function(){if(0===n.length)throw new I(E.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");t.push(n),n=""},o=!1;r<e.length;){var a=e[r];if("\\"===a){if(r+1===e.length)throw new I(E.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new I(E.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new I(E.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new _e(t)},_e.EMPTY_PATH=new _e([]),_e);function _e(){return null!==we&&we.apply(this,arguments)||this}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ee=(Ie.prototype.hasCollectionId=function(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e},Ie.prototype.isEqual=function(e){return null!==e&&0===ve.comparator(this.path,e.path)},Ie.prototype.toString=function(){return this.path.toString()},Ie.comparator=function(e,t){return ve.comparator(e.path,t.path)},Ie.isDocumentKey=function(e){return e.length%2==0},Ie.fromSegments=function(e){return new Ie(new ve(e.slice()))},Ie.fromPathString=function(e){return new Ie(ve.fromString(e))},Ie.EMPTY=new Ie(new ve([])),Ie);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ie(e){this.path=e,v(Ie.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}var Ce,De,Ae=function(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(De=Ce=Ce||{}).All="all",De.ListenStreamIdle="listen_stream_idle",De.ListenStreamConnectionBackoff="listen_stream_connection_backoff",De.WriteStreamIdle="write_stream_idle",De.WriteStreamConnectionBackoff="write_stream_connection_backoff",De.OnlineStateTimeout="online_state_timeout",De.ClientMetadataRefresh="client_metadata_refresh",De.LruGarbageCollection="lru_garbage_collection",De.RetryTransaction="retry_transaction";var Ne=(ke.createAndSchedule=function(e,t,n,r,i){var o=new ke(e,t,Date.now()+n,r,i);return o.start(n),o},ke.prototype.start=function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)},ke.prototype.skipDelay=function(){return this.handleDelayElapsed()},ke.prototype.cancel=function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new I(E.CANCELLED,"Operation cancelled"+(e?": "+e:""))))},ke.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},ke.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},ke);function ke(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ae,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}var Me=(Object.defineProperty(Re.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),Re.prototype.enqueueAndForget=function(e){this.enqueue(e)},Re.prototype.enqueueAndForgetEvenAfterShutdown=function(e){this.verifyNotFailed(),this.enqueueInternal(e)},Re.prototype.enqueueEvenAfterShutdown=function(e){return this.verifyNotFailed(),this.enqueueInternal(e)},Re.prototype.enqueueAndInitiateShutdown=function(t){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},Re.prototype.enqueue=function(e){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(e){}):this.enqueueInternal(e)},Re.prototype.enqueueInternal=function(e){var n=this,t=this.tail.then(function(){return n.operationInProgress=!0,e().catch(function(e){n.failure=e,n.operationInProgress=!1;var t=e.stack||e.message||"";throw c("INTERNAL UNHANDLED ERROR: ",t),t.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw e},0),e}).then(function(e){return n.operationInProgress=!1,e})});return this.tail=t},Re.prototype.enqueueAfterDelay=function(e,t,n){var r=this;this.verifyNotFailed(),v(0<=t,"Attempted to schedule an operation with a negative delay of "+t),-1<this.timerIdsToSkip.indexOf(e)&&(t=0);var i=Ne.createAndSchedule(this,e,t,n,function(e){return r.removeDelayedOperation(e)});return this.delayedOperations.push(i),i},Re.prototype.verifyNotFailed=function(){this.failure&&w("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},Re.prototype.verifyOperationInProgress=function(){v(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},Re.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},Re.prototype.containsDelayedOperation=function(e){for(var t=0,n=this.delayedOperations;t<n.length;t++)if(n[t].timerId===e)return!0;return!1},Re.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){v(r===Ce.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});for(var e=0,t=i.delayedOperations;e<t.length;e++){var n=t[e];if(n.skipDelay(),r!==Ce.All&&n.timerId===r)break}return i.drain()})},Re.prototype.skipDelaysForTimerId=function(e){this.timerIdsToSkip.push(e)},Re.prototype.removeDelayedOperation=function(e){var t=this.delayedOperations.indexOf(e);v(0<=t,"Delayed operation not found."),this.delayedOperations.splice(t,1)},Re);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Re(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}var Oe="",Le="",Pe="",xe="";function Fe(e){for(var t="",n=0;n<e.length;n++)0<t.length&&(t=Ve(t)),t=qe(e.get(n),t);return Ve(t)}function qe(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var o=e.charAt(i);switch(o){case"\0":n+=Oe+Pe;break;case Oe:n+=Oe+xe;break;default:n+=o}}return n}function Ve(e){return e+Oe+Le}function Be(e){var t=e.length;if(v(2<=t,"Invalid path "+e),2===t)return v(e.charAt(0)===Oe&&e.charAt(1)===Le,"Non-empty path "+e+" had length 2"),ve.EMPTY_PATH;for(var n=t-2,r=[],i="",o=0;o<t;){var a=e.indexOf(Oe,o);switch((a<0||n<a)&&w('Invalid encoded resource path: "'+e+'"'),e.charAt(a+1)){case Le:var s=e.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Pe:i+=e.substring(o,a),i+="\0";break;case xe:i+=e.substring(o,a+1);break;default:w('Invalid encoded resource path: "'+e+'"')}o=a+2}return new ve(r)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ue=(je.now=function(){return je.fromMillis(Date.now())},je.fromDate=function(e){return je.fromMillis(e.getTime())},je.fromMillis=function(e){var t=Math.floor(e/1e3);return new je(t,1e6*(e-1e3*t))},je.prototype.toDate=function(){return new Date(this.toMillis())},je.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},je.prototype._compareTo=function(e){return this.seconds===e.seconds?ee(this.nanoseconds,e.nanoseconds):ee(this.seconds,e.seconds)},je.prototype.isEqual=function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds},je.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},je);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new I(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new I(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new I(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new I(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}var Ke=(We.fromMicroseconds=function(e){var t=Math.floor(e/1e6);return new We(new Ue(t,e%1e6*1e3))},We.fromTimestamp=function(e){return new We(e)},We.forDeletedDoc=function(){return We.MIN},We.prototype.compareTo=function(e){return this.timestamp._compareTo(e.timestamp)},We.prototype.isEqual=function(e){return this.timestamp.isEqual(e.timestamp)},We.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},We.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},We.prototype.toTimestamp=function(){return this.timestamp},We.MIN=new We(new Ue(0,0)),We);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function We(e){this.timestamp=e}var Ge=(Qe.prototype.insert=function(e,t){return new Qe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ye.BLACK,null,null))},Qe.prototype.remove=function(e){return new Qe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ye.BLACK,null,null))},Qe.prototype.get=function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null},Qe.prototype.indexOf=function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1},Qe.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Qe.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),Qe.prototype.minKey=function(){return this.root.minKey()},Qe.prototype.maxKey=function(){return this.root.maxKey()},Qe.prototype.inorderTraversal=function(e){return this.root.inorderTraversal(e)},Qe.prototype.forEach=function(n){this.inorderTraversal(function(e,t){return n(e,t),!1})},Qe.prototype.toString=function(){var n=[];return this.inorderTraversal(function(e,t){return n.push(e+":"+t),!1}),"{"+n.join(", ")+"}"},Qe.prototype.reverseTraversal=function(e){return this.root.reverseTraversal(e)},Qe.prototype.getIterator=function(){return new ze(this.root,null,this.comparator,!1)},Qe.prototype.getIteratorFrom=function(e){return new ze(this.root,e,this.comparator,!1)},Qe.prototype.getReverseIterator=function(){return new ze(this.root,null,this.comparator,!0)},Qe.prototype.getReverseIteratorFrom=function(e){return new ze(this.root,e,this.comparator,!0)},Qe);function Qe(e,t){this.comparator=e,this.root=t||Ye.EMPTY}var ze=(He.prototype.getNext=function(){v(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t},He.prototype.hasNext=function(){return 0<this.nodeStack.length},He.prototype.peek=function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}},He);function He(e,t,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}var Ye=(Je.prototype.copy=function(e,t,n,r,i){return new Je(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Je.prototype.isEmpty=function(){return!1},Je.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},Je.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},Je.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},Je.prototype.minKey=function(){return this.min().key},Je.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Je.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()},Je.prototype.removeMin=function(){if(this.left.isEmpty())return Je.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},Je.prototype.remove=function(e,t){var n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Je.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()},Je.prototype.isRed=function(){return this.color},Je.prototype.fixUp=function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e},Je.prototype.moveRedLeft=function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e},Je.prototype.moveRedRight=function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e},Je.prototype.rotateLeft=function(){var e=this.copy(null,null,Je.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},Je.prototype.rotateRight=function(){var e=this.copy(null,null,Je.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},Je.prototype.colorFlip=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},Je.prototype.checkMaxDepth=function(){var e=this.check();return Math.pow(2,e)<=this.size+1},Je.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw w("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw w("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check();if(e!==this.right.check())throw w("Black depths differ");return e+(this.isRed()?0:1)},Je.EMPTY=null,Je.RED=!0,Je.BLACK=!1,Je);function Je(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Je.RED,this.left=null!=r?r:Je.EMPTY,this.right=null!=i?i:Je.EMPTY,this.size=this.left.size+1+this.right.size}var Xe=(Object.defineProperty($e.prototype,"key",{get:function(){throw w("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty($e.prototype,"value",{get:function(){throw w("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty($e.prototype,"color",{get:function(){throw w("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty($e.prototype,"left",{get:function(){throw w("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty($e.prototype,"right",{get:function(){throw w("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),$e.prototype.copy=function(e,t,n,r,i){return this},$e.prototype.insert=function(e,t,n){return new Ye(e,t)},$e.prototype.remove=function(e,t){return this},$e.prototype.isEmpty=function(){return!0},$e.prototype.inorderTraversal=function(e){return!1},$e.prototype.reverseTraversal=function(e){return!1},$e.prototype.minKey=function(){return null},$e.prototype.maxKey=function(){return null},$e.prototype.isRed=function(){return!1},$e.prototype.checkMaxDepth=function(){return!0},$e.prototype.check=function(){return 0},$e);function $e(){this.size=0}Ye.EMPTY=new Xe;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ze=(et.fromMapKeys=function(e){var t=new et(e.comparator);return e.forEach(function(e){t=t.add(e)}),t},et.prototype.has=function(e){return null!==this.data.get(e)},et.prototype.first=function(){return this.data.minKey()},et.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(et.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),et.prototype.indexOf=function(e){return this.data.indexOf(e)},et.prototype.forEach=function(n){this.data.inorderTraversal(function(e,t){return n(e),!1})},et.prototype.forEachInRange=function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}},et.prototype.forEachWhile=function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return},et.prototype.firstAfterOrEqual=function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null},et.prototype.getIterator=function(){return new tt(this.data.getIterator())},et.prototype.getIteratorFrom=function(e){return new tt(this.data.getIteratorFrom(e))},et.prototype.add=function(e){return this.copy(this.data.remove(e).insert(e,!0))},et.prototype.delete=function(e){return this.has(e)?this.copy(this.data.remove(e)):this},et.prototype.isEmpty=function(){return this.data.isEmpty()},et.prototype.unionWith=function(e){var t=this;return e.forEach(function(e){t=t.add(e)}),t},et.prototype.isEqual=function(e){if(!(e instanceof et))return!1;if(this.size!==e.size)return!1;for(var t=this.data.getIterator(),n=e.data.getIterator();t.hasNext();){var r=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},et.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},et.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},et.prototype.copy=function(e){var t=new et(this.comparator);return t.data=e,t},et);function et(e){this.comparator=e,this.data=new Ge(this.comparator)}var tt=(nt.prototype.getNext=function(){return this.iter.getNext().key},nt.prototype.hasNext=function(){return this.iter.hasNext()},nt);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nt(e){this.iter=e}var rt=new Ge(Ee.comparator);function it(){return rt}function ot(){return it()}var at=new Ge(Ee.comparator);function st(){return at}var ut=new Ge(Ee.comparator);function ct(){return ut}var ht=new Ze(Ee.comparator);function lt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=ht,r=0,i=e;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var ft=new Ze(ee);function dt(){return ft}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pt=(mt.prototype.applyToRemoteDocument=function(e,t,n){t&&v(t.key.isEqual(e),"applyToRemoteDocument: key "+e+" should match maybeDoc key\n        "+t.key);var r=n.mutationResults;v(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(e)){var a=r[i];t=o.applyToRemoteDocument(t,a)}}return t},mt.prototype.applyToLocalView=function(e,t){t&&v(t.key.isEqual(e),"applyToLocalDocument: key "+e+" should match maybeDoc key\n        "+t.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(e)&&(t=s.applyToLocalView(t,t,this.localWriteTime));for(var i=t,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(e)&&(t=s.applyToLocalView(t,i,this.localWriteTime))}return t},mt.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(e){var t=r.applyToLocalView(e.key,n.get(e.key));t&&(i=i.insert(e.key,t))}),i},mt.prototype.keys=function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},lt())},mt.prototype.isEqual=function(e){return this.batchId===e.batchId&&te(this.mutations,e.mutations)&&te(this.baseMutations,e.baseMutations)},mt);function mt(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,v(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var gt=(yt.from=function(e,t,n,r){v(e.mutations.length===n.length,"Mutations sent "+e.mutations.length+" must equal results received "+n.length);for(var i=ct(),o=e.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new yt(e,t,n,r,i)},yt);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yt(e,t,n,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var vt=(bt.prototype.catch=function(e){return this.next(void 0,e)},bt.prototype.next=function(r,i){var o=this;return this.callbackAttached&&w("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new bt(function(t,n){o.nextCallback=function(e){o.wrapSuccess(r,e).next(t,n)},o.catchCallback=function(e){o.wrapFailure(i,e).next(t,n)}})},bt.prototype.toPromise=function(){var n=this;return new Promise(function(e,t){n.next(e,t)})},bt.prototype.wrapUserFunction=function(e){try{var t=e();return t instanceof bt?t:bt.resolve(t)}catch(e){return bt.reject(e)}},bt.prototype.wrapSuccess=function(e,t){return e?this.wrapUserFunction(function(){return e(t)}):bt.resolve(t)},bt.prototype.wrapFailure=function(e,t){return e?this.wrapUserFunction(function(){return e(t)}):bt.reject(t)},bt.resolve=function(n){return new bt(function(e,t){e(n)})},bt.reject=function(n){return new bt(function(e,t){t(n)})},bt.waitFor=function(e){return new bt(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(e){return n(e)})}),o=!0,i===r&&t()})},bt.or=function(e){for(var n=bt.resolve(!1),t=function(t){n=n.next(function(e){return e?bt.resolve(e):t()})},r=0,i=e;r<i.length;r++)t(i[r]);return n},bt.forEach=function(e,n){var r=this,i=[];return e.forEach(function(e,t){i.push(n.call(r,e,t))}),this.waitFor(i)},bt);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bt(e){var t=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(function(e){t.isDone=!0,t.result=e,t.nextCallback&&t.nextCallback(e)},function(e){t.isDone=!0,t.error=e,t.catchCallback&&t.catchCallback(e)})}var wt="SimpleDb",Tt=(St.openOrCreate=function(o,e,a){return v(St.isAvailable(),"IndexedDB not supported in current environment."),y(wt,"Opening database:",o),new vt(function(n,r){var i=window.indexedDB.open(o,e);i.onsuccess=function(e){var t=e.target.result;n(new St(t))},i.onblocked=function(){r(new I(E.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var t=e.target.error;"VersionError"===t.name?r(new I(E.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(t)},i.onupgradeneeded=function(e){y(wt,'Database "'+o+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;a.createOrUpgrade(t,i.transaction,e.oldVersion,Wr).next(function(){y(wt,"Database upgrade to version "+Wr+" complete")})}}).toPromise()},St.delete=function(e){return y(wt,"Removing database:",e),Nt(window.indexedDB.deleteDatabase(e)).toPromise()},St.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(St.isMockPersistence())return!0;if(void 0===window.navigator)return!1;var e=d.getUA(),t=St.getIOSVersion(e),n=0<t&&t<10,r=St.getAndroidVersion(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)},St.isMockPersistence=function(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.USE_MOCK_PERSISTENCE)},St.getStore=function(e,t){return e.store(t)},St.getIOSVersion=function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)},St.getAndroidVersion=function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)},St.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},St.prototype.runTransaction=function(r,c,h){return m.__awaiter(this,void 0,void 0,function(){var o,a,s,t,u,n;return m.__generator(this,function(e){switch(e.label){case 0:o=r.startsWith("readonly"),a=r.endsWith("idempotent"),s=0,t=function(){var t,n,r,i;return m.__generator(this,function(e){switch(e.label){case 0:++s,t=It.open(u.db,o?"readonly":"readwrite",c),e.label=1;case 1:return e.trys.push([1,3,,4]),(n=h(t).catch(function(e){return t.abort(e),vt.reject(e)}).toPromise()).catch(function(){}),[4,t.completionPromise];case 2:return e.sent(),[2,{value:n}];case 3:return r=e.sent(),i=a&&"FirebaseError"!==r.name&&s<3,y(wt,"Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},u=this,e.label=1;case 1:return[5,t()];case 2:return"object"===(void 0===(n=e.sent())?"undefined":l(n))?[2,n.value]:[3,1];case 3:return[2]}})})},St.prototype.close=function(){this.db.close()},St);function St(e){this.db=e,12.2===St.getIOSVersion(d.getUA())&&c("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var _t=(Object.defineProperty(Et.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(Et.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(Et.prototype,"cursor",{set:function(e){this.dbCursor=e},enumerable:!0,configurable:!0}),Et.prototype.done=function(){this.shouldStop=!0},Et.prototype.skip=function(e){this.nextKey=e},Et.prototype.delete=function(){return Nt(this.dbCursor.delete())},Et);function Et(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}var It=(Ct.open=function(e,t,n){return new Ct(e.transaction(n,t))},Object.defineProperty(Ct.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Ct.prototype.abort=function(e){e&&this.completionDeferred.reject(e),this.aborted||(y(wt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ct.prototype.store=function(e){var t=this.transaction.objectStore(e);return v(!!t,"Object store not part of transaction: "+e),new Dt(t)},Ct);function Ct(e){var n=this;this.transaction=e,this.aborted=!1,this.completionDeferred=new Ae,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){e.error?n.completionDeferred.reject(e.error):n.completionDeferred.resolve()},this.transaction.onerror=function(e){var t=Mt(e.target.error);n.completionDeferred.reject(t)}}var Dt=(At.prototype.put=function(e,t){return Nt(void 0!==t?(y(wt,"PUT",this.store.name,e,t),this.store.put(t,e)):(y(wt,"PUT",this.store.name,"<auto-key>",e),this.store.put(e)))},At.prototype.add=function(e){return y(wt,"ADD",this.store.name,e,e),Nt(this.store.add(e))},At.prototype.get=function(t){var n=this;return Nt(this.store.get(t)).next(function(e){return void 0===e&&(e=null),y(wt,"GET",n.store.name,t,e),e})},At.prototype.delete=function(e){return y(wt,"DELETE",this.store.name,e),Nt(this.store.delete(e))},At.prototype.count=function(){return y(wt,"COUNT",this.store.name),Nt(this.store.count())},At.prototype.loadAll=function(e,t){var n=this.cursor(this.options(e,t)),r=[];return this.iterateCursor(n,function(e,t){r.push(t)}).next(function(){return r})},At.prototype.deleteAll=function(e,t){y(wt,"DELETE ALL",this.store.name);var n=this.options(e,t);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(e,t,n){return n.delete()})},At.prototype.iterate=function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.iterateCursor(r,t)},At.prototype.iterateSerial=function(i){var e=this.cursor({});return new vt(function(n,r){e.onerror=function(e){var t=Mt(e.target.error);r(t)},e.onsuccess=function(e){var t=e.target.result;t?i(t.primaryKey,t.value).next(function(e){e?t.continue():n()}):n()}})},At.prototype.iterateCursor=function(e,a){var s=[];return new vt(function(o,t){e.onerror=function(e){t(e.target.error)},e.onsuccess=function(e){var t=e.target.result;if(t){var n=new _t(t),r=a(t.primaryKey,t.value,n);if(r instanceof vt){var i=r.catch(function(e){return n.done(),vt.reject(e)});s.push(i)}n.isDone?o():null===n.skipToKey?t.continue():t.continue(n.skipToKey)}else o()}}).next(function(){return vt.waitFor(s)})},At.prototype.options=function(e,t){var n=void 0;return void 0!==e&&("string"==typeof e?n=e:(v(void 0===t,"3rd argument must not be defined if 2nd is a range."),t=e)),{index:n,range:t}},At.prototype.cursor=function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.keysOnly?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)},At);function At(e){this.store=e}function Nt(e){return new vt(function(n,r){e.onsuccess=function(e){var t=e.target.result;n(t)},e.onerror=function(e){var t=Mt(e.target.error);r(t)}})}var kt=!1;function Mt(e){var t=Tt.getIOSVersion(d.getUA());if(12.2<=t&&t<13){var n="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(n)){var r=new I("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return kt||(kt=!0,setTimeout(function(){throw r},0)),r}}return e}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rt=(Ot.forUser=function(e,t,n,r){return v(""!==e.uid,"UserID must not be an empty string."),new Ot(e.isAuthenticated()?e.uid:"",t,n,r)},Ot.prototype.checkEmpty=function(e){var r=!0,t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ft(e).iterate({index:$r.userMutationsIndex,range:t},function(e,t,n){r=!1,n.done()}).next(function(){return r})},Ot.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=xt(n),Vt(t).put(e)})},Ot.prototype.getLastStreamToken=function(e){return this.getMutationQueueMetadata(e).next(function(e){return e.lastStreamToken})},Ot.prototype.setLastStreamToken=function(t,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=xt(n),Vt(t).put(e)})},Ot.prototype.addMutationBatch=function(c,h,l,f){var d=this,p=qt(c),m=Ft(c);return m.add({}).next(function(e){v("number"==typeof e,"Auto-generated key is not a number");for(var t=new pt(e,h,l,f),n=d.serializer.toDbMutationBatch(d.userId,t),r=[],i=new Ze(function(e,t){return ee(e.canonicalString(),t.canonicalString())}),o=0,a=f;o<a.length;o++){var s=a[o],u=ei.key(d.userId,s.key.path,e);i=i.add(s.key.path.popLast()),r.push(m.put(n)),r.push(p.put(u,ei.PLACEHOLDER))}return i.forEach(function(e){r.push(d.indexManager.addToCollectionParentIndex(c,e))}),c.addOnCommittedListener(function(){d.documentKeysByBatchId[e]=t.keys()}),vt.waitFor(r).next(function(){return t})})},Ot.prototype.lookupMutationBatch=function(e,t){var n=this;return Ft(e).get(t).next(function(e){return e?(v(e.userId===n.userId,"Unexpected user '"+e.userId+"' for mutation batch "+t),n.serializer.fromDbMutationBatch(e)):null})},Ot.prototype.lookupMutationKeys=function(e,n){var r=this;return this.documentKeysByBatchId[n]?vt.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(e,n).next(function(e){if(e){var t=e.keys();return r.documentKeysByBatchId[n]=t}return null})},Ot.prototype.getNextMutationBatchAfterBatchId=function(e,t){var r=this,i=t+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Ft(e).iterate({index:$r.userMutationsIndex,range:n},function(e,t,n){t.userId===r.userId&&(v(t.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(t)),n.done()}).next(function(){return o})},Ot.prototype.getHighestUnacknowledgedBatchId=function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Ft(e).iterate({index:$r.userMutationsIndex,range:t,reverse:!0},function(e,t,n){r=t.batchId,n.done()}).next(function(){return r})},Ot.prototype.getAllMutationBatches=function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ft(e).loadAll($r.userMutationsIndex,n).next(function(e){return e.map(function(e){return t.serializer.fromDbMutationBatch(e)})})},Ot.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,e=ei.prefixForPath(this.userId,u.path),t=IDBKeyRange.lowerBound(e),h=[];return qt(s).iterate({range:t},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Be(i);if(r===c.userId&&u.path.isEqual(a))return Ft(s).get(o).next(function(e){if(!e)throw w("Dangling document-mutation reference found: "+t+" which points to "+o);v(e.userId===c.userId,"Unexpected user '"+e.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(e))});n.done()}).next(function(){return h})},Ot.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,e){var u=this,c=new Ze(ee),i=[];return e.forEach(function(s){var e=ei.prefixForPath(u.userId,s.path),t=IDBKeyRange.lowerBound(e),n=qt(r).iterate({range:t},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=Be(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),vt.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},Ot.prototype.getAllMutationBatchesAffectingQuery=function(e,t){var s=this;v(!t.isDocumentQuery(),"Document queries shouldn't go down this path"),v(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=t.path,c=u.length+1,n=ei.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new Ze(ee);return qt(e).iterate({range:r},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=Be(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(e,h)})},Ot.prototype.lookupMutationBatches=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Ft(e).get(t).next(function(e){if(null===e)throw w("Dangling document-mutation reference found, which points to "+t);v(e.userId===n.userId,"Unexpected user '"+e.userId+"' for mutation batch "+t),r.push(n.serializer.fromDbMutationBatch(e))}))}),vt.waitFor(i).next(function(){return r})},Ot.prototype.removeMutationBatch=function(t,n){var r=this;return Pt(t.simpleDbTransaction,this.userId,n).next(function(e){return t.addOnCommittedListener(function(){r.removeCachedMutationKeys(n.batchId)}),vt.forEach(e,function(e){return r.referenceDelegate.removeMutationReference(t,e)})})},Ot.prototype.removeCachedMutationKeys=function(e){delete this.documentKeysByBatchId[e]},Ot.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(e){if(!e)return vt.resolve();var t=IDBKeyRange.lowerBound(ei.prefixForUser(o.userId)),i=[];return qt(n).iterate({range:t},function(e,t,n){if(e[0]===o.userId){var r=Be(e[1]);i.push(r)}else n.done()}).next(function(){v(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(e){return e.canonicalString()}))})})},Ot.prototype.containsKey=function(e,t){return Lt(e,this.userId,t)},Ot.prototype.getMutationQueueMetadata=function(e){var t=this;return Vt(e).get(this.userId).next(function(e){return e||new Jr(t.userId,-1,"")})},Ot);function Ot(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function Lt(e,o,t){var n=ei.prefixForPath(o,t.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return qt(e).iterate({range:r,keysOnly:!0},function(e,t,n){var r=e[0],i=e[1];e[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function Pt(e,t,n){var r=e.store($r.store),i=e.store(ei.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(e,t,n){return s++,n.delete()});o.push(u.next(function(){v(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=ei.key(t,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return vt.waitFor(o).next(function(){return c})}function xt(e){return e instanceof Uint8Array?(v(Tt.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence."),e.toString()):e}function Ft(e){return Ji.getStore(e,$r.store)}function qt(e){return Ji.getStore(e,ei.store)}function Vt(e){return Ji.getStore(e,Jr.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bt,Ut;(Ut=Bt=Bt||{})[Ut.QueryCache=0]="QueryCache",Ut[Ut.SyncEngine=1]="SyncEngine";var jt=(Kt.prototype.next=function(){var e=this.nextId;return this.nextId+=2,e},Kt.prototype.after=function(e){return this.seek(e+2),this.next()},Kt.prototype.seek=function(e){v((1&e)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=e},Kt.forTargetCache=function(){return new Kt(Bt.QueryCache,2)},Kt.forSyncEngine=function(){return new Kt(Bt.SyncEngine)},Kt);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kt(e,t){v((1&(this.generatorId=e))===e,"Generator ID "+e+" contains more than 1 reserved bits"),this.seek(void 0!==t?t:this.generatorId)}var Wt=(Gt.prototype.allocateTargetId=function(t){var n=this;return this.retrieveMetadata(t).next(function(e){return e.highestTargetId=n.targetIdGenerator.after(e.highestTargetId),n.saveMetadata(t,e).next(function(){return e.highestTargetId})})},Gt.prototype.getLastRemoteSnapshotVersion=function(e){return this.retrieveMetadata(e).next(function(e){return Ke.fromTimestamp(new Ue(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))})},Gt.prototype.getHighestSequenceNumber=function(e){return Ht(e.simpleDbTransaction)},Gt.prototype.setTargetsMetadata=function(t,n,r){var i=this;return this.retrieveMetadata(t).next(function(e){return e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),i.saveMetadata(t,e)})},Gt.prototype.addTargetData=function(t,n){var r=this;return this.saveTargetData(t,n).next(function(){return r.retrieveMetadata(t).next(function(e){return e.targetCount+=1,r.updateMetadataFromTargetData(n,e),r.saveMetadata(t,e)})})},Gt.prototype.updateTargetData=function(e,t){return this.saveTargetData(e,t)},Gt.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Qt(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return v(0<e.targetCount,"Removing from an empty target cache"),--e.targetCount,n.saveMetadata(t,e)})},Gt.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return Qt(r).iterate(function(e,t){var n=a.serializer.fromDbTarget(t);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(s++,u.push(a.removeTargetData(r,n)))}).next(function(){return vt.waitFor(u)}).next(function(){return s})},Gt.prototype.forEachTarget=function(e,r){var i=this;return Qt(e).iterate(function(e,t){var n=i.serializer.fromDbTarget(t);r(n)})},Gt.prototype.retrieveMetadata=function(e){return zt(e.simpleDbTransaction)},Gt.prototype.saveMetadata=function(e,t){return n=e,Ji.getStore(n,fi.store).put(fi.key,t);var n},Gt.prototype.saveTargetData=function(e,t){return Qt(e).put(this.serializer.toDbTarget(t))},Gt.prototype.updateMetadataFromTargetData=function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n},Gt.prototype.getTargetCount=function(e){return this.retrieveMetadata(e).next(function(e){return e.targetCount})},Gt.prototype.getTargetData=function(e,i){var o=this,t=i.canonicalId(),n=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]),a=null;return Qt(e).iterate({range:n,index:ui.queryTargetsIndexName},function(e,t,n){var r=o.serializer.fromDbTarget(t);i.isEqual(r.target)&&(a=r,n.done())}).next(function(){return a})},Gt.prototype.addMatchingKeys=function(n,e,r){var i=this,o=[],a=Yt(n);return e.forEach(function(e){var t=Fe(e.path);o.push(a.put(new hi(r,t))),o.push(i.referenceDelegate.addReference(n,e))}),vt.waitFor(o)},Gt.prototype.removeMatchingKeys=function(n,e,r){var i=this,o=Yt(n);return vt.forEach(e,function(e){var t=Fe(e.path);return vt.waitFor([o.delete([r,t]),i.referenceDelegate.removeReference(n,e)])})},Gt.prototype.removeMatchingKeysForTargetId=function(e,t){var n=Yt(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)},Gt.prototype.getMatchingKeysForTargetId=function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Yt(e),o=lt();return r.iterate({range:n,keysOnly:!0},function(e,t,n){var r=Be(e[1]),i=new Ee(r);o=o.add(i)}).next(function(){return o})},Gt.prototype.containsKey=function(e,t){var n=Fe(t.path),r=IDBKeyRange.bound([n],[ne(n)],!1,!0),i=0;return Yt(e).iterate({index:hi.documentTargetsIndex,keysOnly:!0,range:r},function(e,t,n){var r=e[0];e[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Gt.prototype.getTargetDataForTarget=function(e,t){var n=this;return Qt(e).get(t).next(function(e){return e?n.serializer.fromDbTarget(e):null})},Gt);function Gt(e,t){this.referenceDelegate=e,this.serializer=t,this.targetIdGenerator=jt.forTargetCache()}function Qt(e){return Ji.getStore(e,ui.store)}function zt(e){return Tt.getStore(e,fi.store).get(fi.key).next(function(e){return v(null!==e,"Missing metadata row."),e})}function Ht(e){return zt(e).next(function(e){return e.highestListenSequenceNumber})}function Yt(e){return Ji.getStore(e,hi.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Jt=(Xt.fromSet=function(e){return new Xt(e)},Xt.fromArray=function(e){var t=new Ze(Se.comparator);return e.forEach(function(e){return t=t.add(e)}),new Xt(t)},Xt.prototype.covers=function(t){var n=!1;return this.fields.forEach(function(e){e.isPrefixOf(t)&&(n=!0)}),n},Xt.prototype.isEqual=function(e){return this.fields.isEqual(e.fields)},Xt);function Xt(e){this.fields=e}var $t=(Zt.prototype.isEqual=function(e){return this.field.isEqual(e.field)&&this.transform.isEqual(e.transform)},Zt);function Zt(e,t){this.field=e,this.transform=t}var en,tn,nn=function(e,t){this.version=e,this.transformResults=t};(tn=en=en||{})[tn.Set=0]="Set",tn[tn.Patch=1]="Patch",tn[tn.Transform=2]="Transform",tn[tn.Delete=3]="Delete",tn[tn.Verify=4]="Verify";var rn=(on.exists=function(e){return new on(void 0,e)},on.updateTime=function(e){return new on(e)},Object.defineProperty(on.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),on.prototype.isValidFor=function(e){return void 0!==this.updateTime?e instanceof wr&&e.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===e instanceof wr:(v(this.isNone,"Precondition should be empty"),!0)},on.prototype.isEqual=function(e){return t=this.updateTime,n=e.updateTime,(null!=t?!(!n||!t.isEqual(n)):t===n)&&this.exists===e.exists;var t,n},on.NONE=new on,on);function on(e,t){this.updateTime=e,this.exists=t,v(void 0===e||void 0===t,'Precondition can specify "exists" or "updateTime" but not both')}var an=(sn.prototype.verifyKeyMatches=function(e){null!=e&&v(e.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},sn.getPostMutationVersion=function(e){return e instanceof wr?e.version:Ke.MIN},sn);function sn(){}var un,cn=(un=an,m.__extends(hn,un),hn.prototype.applyToRemoteDocument=function(e,t){this.verifyKeyMatches(e),v(null==t.transformResults,"Transform results received by SetMutation.");var n=t.version;return new wr(this.key,n,{hasCommittedMutations:!0},this.value)},hn.prototype.applyToLocalView=function(e,t,n){if(this.verifyKeyMatches(e),!this.precondition.isValidFor(e))return e;var r=an.getPostMutationVersion(e);return new wr(this.key,r,{hasLocalMutations:!0},this.value)},hn.prototype.extractBaseValue=function(e){return null},hn.prototype.isEqual=function(e){return e instanceof hn&&this.key.isEqual(e.key)&&this.value.isEqual(e.value)&&this.precondition.isEqual(e.precondition)},hn);function hn(e,t,n){var r=un.call(this)||this;return r.key=e,r.value=t,r.precondition=n,r.type=en.Set,r}var ln,fn=(ln=an,m.__extends(dn,ln),dn.prototype.applyToRemoteDocument=function(e,t){if(this.verifyKeyMatches(e),v(null==t.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(e))return new Cr(this.key,t.version);var n=this.patchDocument(e);return new wr(this.key,t.version,{hasCommittedMutations:!0},n)},dn.prototype.applyToLocalView=function(e,t,n){if(this.verifyKeyMatches(e),!this.precondition.isValidFor(e))return e;var r=an.getPostMutationVersion(e),i=this.patchDocument(e);return new wr(this.key,r,{hasLocalMutations:!0},i)},dn.prototype.extractBaseValue=function(e){return null},dn.prototype.isEqual=function(e){return e instanceof dn&&this.key.isEqual(e.key)&&this.fieldMask.isEqual(e.fieldMask)&&this.precondition.isEqual(e.precondition)},dn.prototype.patchDocument=function(e){var t;return t=e instanceof wr?e.data():fr.EMPTY,this.patchObject(t)},dn.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(e){if(!e.isEmpty()){var t=r.data.field(e);n=null!==t?n.set(e,t):n.delete(e)}}),n},dn);function dn(e,t,n,r){var i=ln.call(this)||this;return i.key=e,i.data=t,i.fieldMask=n,i.precondition=r,i.type=en.Patch,i}var pn,mn=(pn=an,m.__extends(gn,pn),gn.prototype.applyToRemoteDocument=function(e,t){if(this.verifyKeyMatches(e),v(null!=t.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(e))return new Cr(this.key,t.version);var n=this.requireDocument(e),r=this.serverTransformResults(e,t.transformResults),i=t.version,o=this.transformObject(n.data(),r);return new wr(this.key,i,{hasCommittedMutations:!0},o)},gn.prototype.applyToLocalView=function(e,t,n){if(this.verifyKeyMatches(e),!this.precondition.isValidFor(e))return e;var r=this.requireDocument(e),i=this.localTransformResults(n,e,t),o=this.transformObject(r.data(),i);return new wr(this.key,r.version,{hasLocalMutations:!0},o)},gn.prototype.extractBaseValue=function(e){for(var t=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=e instanceof wr?e.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(t=null==t?fr.EMPTY.set(i.field,a):t.set(i.field,a))}return t},gn.prototype.isEqual=function(e){return e instanceof gn&&this.key.isEqual(e.key)&&te(this.fieldTransforms,e.fieldTransforms)&&this.precondition.isEqual(e.precondition)},gn.prototype.requireDocument=function(e){return v(e instanceof wr,"Unknown MaybeDocument type "+e),v(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},gn.prototype.serverTransformResults=function(e,t){var n=[];v(this.fieldTransforms.length===t.length,"server transform result count ("+t.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<t.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;e instanceof wr&&(a=e.field(i.field)),n.push(o.applyToRemoteDocument(a,t[r]))}return n},gn.prototype.localTransformResults=function(e,t,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;t instanceof wr&&(u=t.field(a.field)),null===u&&n instanceof wr&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,e))}return r},gn.prototype.transformObject=function(e,t){v(t.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;e=e.set(r,t[n])}return e},gn);function gn(e,t){var n=pn.call(this)||this;return n.key=e,n.fieldTransforms=t,n.type=en.Transform,n.precondition=rn.exists(!0),n}var yn,vn=(yn=an,m.__extends(bn,yn),bn.prototype.applyToRemoteDocument=function(e,t){return this.verifyKeyMatches(e),v(null==t.transformResults,"Transform results received by DeleteMutation."),new _r(this.key,t.version,{hasCommittedMutations:!0})},bn.prototype.applyToLocalView=function(e,t,n){return this.verifyKeyMatches(e),this.precondition.isValidFor(e)?(e&&v(e.key.isEqual(this.key),"Can only apply mutation to document with same key"),new _r(this.key,Ke.forDeletedDoc())):e},bn.prototype.extractBaseValue=function(e){return null},bn.prototype.isEqual=function(e){return e instanceof bn&&this.key.isEqual(e.key)&&this.precondition.isEqual(e.precondition)},bn);function bn(e,t){var n=yn.call(this)||this;return n.key=e,n.precondition=t,n.type=en.Delete,n}var wn,Tn,Sn,_n,En,In=(wn=an,m.__extends(Cn,wn),Cn.prototype.applyToRemoteDocument=function(e,t){w("VerifyMutation should only be used in Transactions.")},Cn.prototype.applyToLocalView=function(e,t,n){w("VerifyMutation should only be used in Transactions.")},Cn.prototype.extractBaseValue=function(e){w("VerifyMutation should only be used in Transactions.")},Cn.prototype.isEqual=function(e){return e instanceof Cn&&this.key.isEqual(e.key)&&this.precondition.isEqual(e.precondition)},Cn);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cn(e,t){var n=wn.call(this)||this;return n.key=e,n.precondition=t,n.type=en.Verify,n}(Sn=Tn=Tn||{})[Sn.NullValue=0]="NullValue",Sn[Sn.BooleanValue=1]="BooleanValue",Sn[Sn.NumberValue=2]="NumberValue",Sn[Sn.TimestampValue=3]="TimestampValue",Sn[Sn.StringValue=4]="StringValue",Sn[Sn.BlobValue=5]="BlobValue",Sn[Sn.RefValue=6]="RefValue",Sn[Sn.GeoPointValue=7]="GeoPointValue",Sn[Sn.ArrayValue=8]="ArrayValue",Sn[Sn.ObjectValue=9]="ObjectValue",(En=_n=_n||{})[En.Default=0]="Default",En[En.Estimate=1]="Estimate",En[En.Previous=2]="Previous";var Dn=(An.fromSnapshotOptions=function(e,t){switch(e.serverTimestamps){case"estimate":return new An(_n.Estimate,t);case"previous":return new An(_n.Previous,t);case"none":case void 0:return new An(_n.Default,t);default:return w("fromSnapshotOptions() called with invalid options.")}},An);function An(e,t){this.serverTimestampBehavior=e,this.timestampsInSnapshots=t}var Nn=(kn.prototype.toString=function(){var e=this.value();return null===e?"null":e.toString()},kn.prototype.defaultCompareTo=function(e){return v(this.typeOrder!==e.typeOrder,"Default compareTo should not be used for values of same type."),ee(this.typeOrder,e.typeOrder)},kn);function kn(){}var Mn,Rn=(Mn=Nn,m.__extends(On,Mn),On.prototype.value=function(e){return null},On.prototype.isEqual=function(e){return e instanceof On},On.prototype.compareTo=function(e){return e instanceof On?0:this.defaultCompareTo(e)},On.INSTANCE=new On,On);function On(){var e=Mn.call(this)||this;return e.typeOrder=Tn.NullValue,e.internalValue=null,e}var Ln,Pn=(Ln=Nn,m.__extends(xn,Ln),xn.prototype.value=function(e){return this.internalValue},xn.prototype.isEqual=function(e){return e instanceof xn&&this.internalValue===e.internalValue},xn.prototype.compareTo=function(e){return e instanceof xn?ee(this,e):this.defaultCompareTo(e)},xn.of=function(e){return e?xn.TRUE:xn.FALSE},xn.TRUE=new xn(!0),xn.FALSE=new xn(!1),xn);function xn(e){var t=Ln.call(this)||this;return t.internalValue=e,t.typeOrder=Tn.BooleanValue,t}var Fn,qn=(Fn=Nn,m.__extends(Vn,Fn),Vn.prototype.value=function(e){return this.internalValue},Vn.prototype.compareTo=function(e){return e instanceof Vn?(t=this.internalValue,n=e.internalValue,t<n?-1:n<t?1:t===n?0:isNaN(t)?isNaN(n)?0:-1:1):this.defaultCompareTo(e);var t,n},Vn);function Vn(e){var t=Fn.call(this)||this;return t.internalValue=e,t.typeOrder=Tn.NumberValue,t}function Bn(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}var Un,jn=(Un=qn,m.__extends(Kn,Un),Kn.prototype.isEqual=function(e){return e instanceof Kn&&Bn(this.internalValue,e.internalValue)},Kn);function Kn(){return null!==Un&&Un.apply(this,arguments)||this}var Wn,Gn=(Wn=qn,m.__extends(Qn,Wn),Qn.prototype.isEqual=function(e){return e instanceof Qn&&Bn(this.internalValue,e.internalValue)},Qn.NAN=new Qn(NaN),Qn.POSITIVE_INFINITY=new Qn(1/0),Qn.NEGATIVE_INFINITY=new Qn(-1/0),Qn);function Qn(){return null!==Wn&&Wn.apply(this,arguments)||this}var zn,Hn=(zn=Nn,m.__extends(Yn,zn),Yn.prototype.value=function(e){return this.internalValue},Yn.prototype.isEqual=function(e){return e instanceof Yn&&this.internalValue===e.internalValue},Yn.prototype.compareTo=function(e){return e instanceof Yn?ee(this.internalValue,e.internalValue):this.defaultCompareTo(e)},Yn);function Yn(e){var t=zn.call(this)||this;return t.internalValue=e,t.typeOrder=Tn.StringValue,t}var Jn,Xn=(Jn=Nn,m.__extends($n,Jn),$n.prototype.value=function(e){return!e||e.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},$n.prototype.isEqual=function(e){return e instanceof $n&&this.internalValue.isEqual(e.internalValue)},$n.prototype.compareTo=function(e){return e instanceof $n?this.internalValue._compareTo(e.internalValue):e instanceof er?-1:this.defaultCompareTo(e)},$n);function $n(e){var t=Jn.call(this)||this;return t.internalValue=e,t.typeOrder=Tn.TimestampValue,t}var Zn,er=(Zn=Nn,m.__extends(tr,Zn),tr.prototype.value=function(e){return e&&e.serverTimestampBehavior===_n.Estimate?new Xn(this.localWriteTime).value(e):e&&e.serverTimestampBehavior===_n.Previous&&this.previousValue?this.previousValue.value(e):null},tr.prototype.isEqual=function(e){return e instanceof tr&&this.localWriteTime.isEqual(e.localWriteTime)},tr.prototype.compareTo=function(e){return e instanceof tr?this.localWriteTime._compareTo(e.localWriteTime):e instanceof Xn?1:this.defaultCompareTo(e)},tr.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},tr);function tr(e,t){var n=Zn.call(this)||this;return n.localWriteTime=e,n.previousValue=t,n.typeOrder=Tn.TimestampValue,n}var nr,rr=(nr=Nn,m.__extends(ir,nr),ir.prototype.value=function(e){return this.internalValue},ir.prototype.isEqual=function(e){return e instanceof ir&&this.internalValue.isEqual(e.internalValue)},ir.prototype.compareTo=function(e){return e instanceof ir?this.internalValue._compareTo(e.internalValue):this.defaultCompareTo(e)},ir);function ir(e){var t=nr.call(this)||this;return t.internalValue=e,t.typeOrder=Tn.BlobValue,t}var or,ar=(or=Nn,m.__extends(sr,or),sr.prototype.value=function(e){return this.key},sr.prototype.isEqual=function(e){return e instanceof sr&&this.key.isEqual(e.key)&&this.databaseId.isEqual(e.databaseId)},sr.prototype.compareTo=function(e){if(e instanceof sr){var t=this.databaseId.compareTo(e.databaseId);return 0!==t?t:Ee.comparator(this.key,e.key)}return this.defaultCompareTo(e)},sr);function sr(e,t){var n=or.call(this)||this;return n.databaseId=e,n.key=t,n.typeOrder=Tn.RefValue,n}var ur,cr=(ur=Nn,m.__extends(hr,ur),hr.prototype.value=function(e){return this.internalValue},hr.prototype.isEqual=function(e){return e instanceof hr&&this.internalValue.isEqual(e.internalValue)},hr.prototype.compareTo=function(e){return e instanceof hr?this.internalValue._compareTo(e.internalValue):this.defaultCompareTo(e)},hr);function hr(e){var t=ur.call(this)||this;return t.internalValue=e,t.typeOrder=Tn.GeoPointValue,t}var lr,fr=(lr=Nn,m.__extends(dr,lr),dr.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(e,t){r[e]=t.value(n)}),r},dr.prototype.forEach=function(e){this.internalValue.inorderTraversal(e)},dr.prototype.isEqual=function(e){if(e instanceof dr){for(var t=this.internalValue.getIterator(),n=e.internalValue.getIterator();t.hasNext()&&n.hasNext();){var r=t.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!t.hasNext()&&!n.hasNext()}return!1},dr.prototype.compareTo=function(e){if(e instanceof dr){for(var t=this.internalValue.getIterator(),n=e.internalValue.getIterator();t.hasNext()&&n.hasNext();){var r=t.getNext(),i=n.getNext(),o=ee(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return ee(t.hasNext(),n.hasNext())}return this.defaultCompareTo(e)},dr.prototype.set=function(e,t){if(v(!e.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===e.length)return this.setChild(e.firstSegment(),t);var n=this.child(e.firstSegment());n instanceof dr||(n=dr.EMPTY);var r=n.set(e.popFirst(),t);return this.setChild(e.firstSegment(),r)},dr.prototype.delete=function(e){if(v(!e.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===e.length)return new dr(this.internalValue.remove(e.firstSegment()));var t=this.child(e.firstSegment());if(t instanceof dr){var n=t.delete(e.popFirst());return new dr(this.internalValue.insert(e.firstSegment(),n))}return this},dr.prototype.contains=function(e){return null!==this.field(e)},dr.prototype.field=function(e){v(!e.isEmpty(),"Can't get field of empty path");var t=this;return e.forEach(function(e){t=t instanceof dr?t.internalValue.get(e):null}),t},dr.prototype.fieldMask=function(){var i=new Ze(Se.comparator);return this.internalValue.forEach(function(e,t){var n=new Se([e]);if(t instanceof dr){var r=t.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(e){i=i.add(n.child(e))})}else i=i.add(n)}),Jt.fromSet(i)},dr.prototype.toString=function(){return this.internalValue.toString()},dr.prototype.child=function(e){return this.internalValue.get(e)||void 0},dr.prototype.setChild=function(e,t){return new dr(this.internalValue.insert(e,t))},dr.EMPTY=new dr(new Ge(ee)),dr);function dr(e){var t=lr.call(this)||this;return t.internalValue=e,t.typeOrder=Tn.ObjectValue,t}var pr,mr=(pr=Nn,m.__extends(gr,pr),gr.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},gr.prototype.contains=function(e){for(var t=0,n=this.internalValue;t<n.length;t++)if(n[t].isEqual(e))return!0;return!1},gr.prototype.forEach=function(e){this.internalValue.forEach(e)},gr.prototype.isEqual=function(e){if(e instanceof gr){if(this.internalValue.length!==e.internalValue.length)return!1;for(var t=0;t<this.internalValue.length;t++)if(!this.internalValue[t].isEqual(e.internalValue[t]))return!1;return!0}return!1},gr.prototype.compareTo=function(e){if(e instanceof gr){for(var t=Math.min(this.internalValue.length,e.internalValue.length),n=0;n<t;n++){var r=this.internalValue[n].compareTo(e.internalValue[n]);if(r)return r}return ee(this.internalValue.length,e.internalValue.length)}return this.defaultCompareTo(e)},gr.prototype.toString=function(){return"["+this.internalValue.map(function(e){return e.toString()}).join(",")+"]"},gr);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gr(e){var t=pr.call(this)||this;return t.internalValue=e,t.typeOrder=Tn.ArrayValue,t}var yr=(vr.compareByKey=function(e,t){return Ee.comparator(e.key,t.key)},vr);function vr(e,t){this.key=e,this.version=t}var br,wr=(br=yr,m.__extends(Tr,br),Tr.prototype.field=function(e){if(this.objectValue)return this.objectValue.field(e);this.fieldValueCache||(this.fieldValueCache=new Map);var t=e.canonicalString(),n=this.fieldValueCache.get(t);if(void 0===n){var r=this.getProtoField(e);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(t,n)}return n},Tr.prototype.data=function(){var n=this;if(!this.objectValue){var r=fr.EMPTY;M(this.proto.fields||{},function(e,t){r=r.set(new Se([e]),n.converter(t))}),this.objectValue=r,this.fieldValueCache=void 0}return this.objectValue},Tr.prototype.value=function(){return this.data().value()},Tr.prototype.isEqual=function(e){return e instanceof Tr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.hasLocalMutations===e.hasLocalMutations&&this.hasCommittedMutations===e.hasCommittedMutations&&this.data().isEqual(e.data())},Tr.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Tr.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Tr.prototype.getProtoField=function(e){v(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var t=this.proto.fields?this.proto.fields[e.firstSegment()]:void 0,n=1;n<e.length;++n){if(!t||!t.mapValue||!t.mapValue.fields)return;t=t.mapValue.fields[e.get(n)]}return t},Tr.compareByField=function(e,t,n){var r=t.field(e),i=n.field(e);return null!==r&&null!==i?r.compareTo(i):w("Trying to compare documents on fields that don't exist")},Tr);function Tr(e,t,n,r,i,o){var a=br.call(this,e,t)||this;return a.objectValue=r,a.proto=i,a.converter=o,v(void 0!==a.objectValue||void 0!==a.proto&&void 0!==a.converter,"If objectValue is not defined, proto and converter need to be set."),a.hasLocalMutations=!!n.hasLocalMutations,a.hasCommittedMutations=!!n.hasCommittedMutations,a}var Sr,_r=(Sr=yr,m.__extends(Er,Sr),Er.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Er.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Er.prototype.isEqual=function(e){return e instanceof Er&&e.hasCommittedMutations===this.hasCommittedMutations&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},Er);function Er(e,t,n){var r=Sr.call(this,e,t)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var Ir,Cr=(Ir=yr,m.__extends(Dr,Ir),Dr.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Dr.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Dr.prototype.isEqual=function(e){return e instanceof Dr&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},Dr);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dr(){return null!==Ir&&Ir.apply(this,arguments)||this}var Ar=(Nr.prototype.get=function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(e))return s}},Nr.prototype.has=function(e){return void 0!==this.get(e)},Nr.prototype.set=function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]},Nr.prototype.delete=function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1},Nr.prototype.forEach=function(s){M(this.inner,function(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},Nr.prototype.isEmpty=function(){return R(this.inner)},Nr);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nr(e){this.mapKeyFn=e,this.inner={}}var kr=(Object.defineProperty(Mr.prototype,"readTime",{get:function(){return v(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(e){v(void 0===this._readTime||this._readTime.isEqual(e),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=e},enumerable:!0,configurable:!0}),Mr.prototype.addEntry=function(e,t){this.assertNotApplied(),this.readTime=t,this.changes.set(e.key,e)},Mr.prototype.removeEntry=function(e,t){this.assertNotApplied(),t&&(this.readTime=t),this.changes.set(e,null)},Mr.prototype.getEntry=function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?vt.resolve(n):this.getFromCache(e,t)},Mr.prototype.getEntries=function(e,t){return this.getAllFromCache(e,t)},Mr.prototype.apply=function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)},Mr.prototype.assertNotApplied=function(){v(!this.changesApplied,"Changes have already been applied.")},Mr);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mr(){this.changes=new Ar(function(e){return e.toString()}),this.changesApplied=!1}var Rr,Or=(Lr.prototype.addEntry=function(e,t,n){return Fr(e).put(qr(t),n)},Lr.prototype.removeEntry=function(e,t){var n=Fr(e),r=qr(t);return n.delete(r)},Lr.prototype.updateMetadata=function(t,n){var r=this;return this.getMetadata(t).next(function(e){return e.byteSize+=n,r.setMetadata(t,e)})},Lr.prototype.getEntry=function(e,t){var n=this;return Fr(e).get(qr(t)).next(function(e){return n.maybeDecodeDocument(e)})},Lr.prototype.getSizedEntry=function(e,t){var n=this;return Fr(e).get(qr(t)).next(function(e){var t=n.maybeDecodeDocument(e);return t?{maybeDocument:t,size:Vr(e)}:null})},Lr.prototype.getEntries=function(e,t){var r=this,i=ot();return this.forEachDbEntry(e,t,function(e,t){var n=r.maybeDecodeDocument(t);i=i.insert(e,n)}).next(function(){return i})},Lr.prototype.getSizedEntries=function(e,t){var r=this,i=ot(),o=new Ge(Ee.comparator);return this.forEachDbEntry(e,t,function(e,t){var n=r.maybeDecodeDocument(t);o=n?(i=i.insert(e,n),o.insert(e,Vr(t))):(i=i.insert(e,null),o.insert(e,0))}).next(function(){return{maybeDocuments:i,sizeMap:o}})},Lr.prototype.forEachDbEntry=function(e,t,i){if(t.isEmpty())return vt.resolve();var n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),o=t.getIterator(),a=o.getNext();return Fr(e).iterate({range:n},function(e,t,n){for(var r=Ee.fromSegments(e);a&&Ee.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,t),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},Lr.prototype.getDocumentsMatchingQuery=function(e,i,t){var o=this;v(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=st(),s=i.path.length+1,n={};if(t.isEqual(Ke.MIN)){var r=i.path.toArray();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.toArray(),c=this.serializer.toDbTimestampKey(t);n.range=IDBKeyRange.lowerBound([u,c],!0),n.index=ii.collectionReadTimeIndex}return Fr(e).iterate(n,function(e,t,n){if(e.length===s){var r=o.serializer.fromDbRemoteDocument(t);i.path.isPrefixOf(r.key.path)?r instanceof wr&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},Lr.prototype.getNewDocumentChanges=function(e,t){var r=this,i=it(),o=this.serializer.toDbTimestampKey(t),n=Fr(e),a=IDBKeyRange.lowerBound(o,!0);return n.iterate({index:ii.readTimeIndex,range:a},function(e,t){var n=r.serializer.fromDbRemoteDocument(t);i=i.insert(n.key,n),o=t.readTime}).next(function(){return{changedDocs:i,readTime:r.serializer.fromDbTimestampKey(o)}})},Lr.prototype.getLastDocumentChange=function(e){var r,i=this,t=Fr(e),o=Ke.MIN;return t.iterate({index:ii.readTimeIndex,reverse:!0},function(e,t,n){r=i.serializer.fromDbRemoteDocument(t),t.readTime&&(o=i.serializer.fromDbTimestampKey(t.readTime)),n.done()}).next(function(){return{changedDoc:r,readTime:o}})},Lr.prototype.newChangeBuffer=function(e){return new Lr.RemoteDocumentChangeBuffer(this,!!e&&e.trackRemovals)},Lr.prototype.getSize=function(e){return this.getMetadata(e).next(function(e){return e.byteSize})},Lr.prototype.getMetadata=function(e){return xr(e).get(ai.key).next(function(e){return v(!!e,"Missing document cache metadata"),e})},Lr.prototype.setMetadata=function(e,t){return xr(e).put(ai.key,t)},Lr.prototype.maybeDecodeDocument=function(e){if(e){var t=this.serializer.fromDbRemoteDocument(e);return t instanceof _r&&t.version.isEqual(Ke.forDeletedDoc())?null:t}return null},Lr.RemoteDocumentChangeBuffer=(Rr=kr,m.__extends(Pr,Rr),Pr.prototype.applyChanges=function(a){var s=this,u=[],c=0,h=new Ze(function(e,t){return ee(e.canonicalString(),t.canonicalString())});return this.changes.forEach(function(e,t){var n=s.documentSizes.get(e);if(v(void 0!==n,"Cannot modify a document that wasn't read (for "+e+")"),t){v(!s.readTime.isEqual(Ke.MIN),"Cannot add a document with a read time of zero");var r=s.documentCache.serializer.toDbRemoteDocument(t,s.readTime);h=h.add(e.path.popLast());var i=Vr(r);c+=i-n,u.push(s.documentCache.addEntry(a,e,r))}else if(c-=n,s.trackRemovals){var o=s.documentCache.serializer.toDbRemoteDocument(new _r(e,Ke.forDeletedDoc()),s.readTime);u.push(s.documentCache.addEntry(a,e,o))}else u.push(s.documentCache.removeEntry(a,e))}),h.forEach(function(e){u.push(s.documentCache.indexManager.addToCollectionParentIndex(a,e))}),u.push(this.documentCache.updateMetadata(a,c)),vt.waitFor(u)},Pr.prototype.getFromCache=function(e,t){var n=this;return this.documentCache.getSizedEntry(e,t).next(function(e){return null===e?(n.documentSizes.set(t,0),null):(n.documentSizes.set(t,e.size),e.maybeDocument)})},Pr.prototype.getAllFromCache=function(e,t){var n=this;return this.documentCache.getSizedEntries(e,t).next(function(e){var t=e.maybeDocuments;return e.sizeMap.forEach(function(e,t){n.documentSizes.set(e,t)}),t})},Pr),Lr);function Lr(e,t){this.serializer=e,this.indexManager=t}function Pr(e,t){var n=Rr.call(this)||this;return n.documentCache=e,n.trackRemovals=t,n.documentSizes=new Ar(function(e){return e.toString()}),n}function xr(e){return Ji.getStore(e,ai.store)}function Fr(e){return Ji.getStore(e,ii.store)}function qr(e){return e.path.toArray()}function Vr(e){var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw w("Unknown remote document type");t=e.noDocument}return JSON.stringify(t).length}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Br=(Ur.prototype.addToCollectionParentIndex=function(e,t){return this.collectionParentIndex.add(t),vt.resolve()},Ur.prototype.getCollectionParents=function(e,t){return vt.resolve(this.collectionParentIndex.getEntries(t))},Ur);function Ur(){this.collectionParentIndex=new jr}var jr=(Kr.prototype.add=function(e){v(e.length%2==1,"Expected a collection path.");var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Ze(ve.comparator),i=!r.has(n);return this.index[t]=r.add(n),i},Kr.prototype.has=function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)},Kr.prototype.getEntries=function(e){return(this.index[e]||new Ze(ve.comparator)).toArray()},Kr);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kr(){this.index={}}var Wr=9,Gr=(Qr.prototype.createOrUpgrade=function(n,r,e,t){var i=this;v(e<t&&0<=e&&t<=Wr,"Unexpected schema upgrade from v"+e+" to v{toVersion}.");var o,a=new It(r);e<1&&1<=t&&(n.createObjectStore(Hr.store),(o=n).createObjectStore(Jr.store,{keyPath:Jr.keyPath}),o.createObjectStore($r.store,{keyPath:$r.keyPath,autoIncrement:!0}).createIndex($r.userMutationsIndex,$r.userMutationsKeyPath,{unique:!0}),o.createObjectStore(ei.store),gi(n),n.createObjectStore(ii.store));var s,u=vt.resolve();return e<3&&3<=t&&(0!==e&&((s=n).deleteObjectStore(hi.store),s.deleteObjectStore(ui.store),s.deleteObjectStore(fi.store),gi(n)),u=u.next(function(){return e=a.store(fi.store),t=new fi(0,0,Ke.MIN.toTimestamp(),0),e.put(fi.key,t);var e,t})),e<4&&4<=t&&(0!==e&&(u=u.next(function(){return r=n,(i=a).store($r.store).loadAll().next(function(e){r.deleteObjectStore($r.store),r.createObjectStore($r.store,{keyPath:$r.keyPath,autoIncrement:!0}).createIndex($r.userMutationsIndex,$r.userMutationsKeyPath,{unique:!0});var t=i.store($r.store),n=e.map(function(e){return t.put(e)});return vt.waitFor(n)});var r,i})),u=u.next(function(){n.createObjectStore(yi.store,{keyPath:yi.keyPath})})),e<5&&5<=t&&(u=u.next(function(){return i.removeAcknowledgedMutations(a)})),e<6&&6<=t&&(u=u.next(function(){return n.createObjectStore(ai.store),i.addDocumentGlobal(a)})),e<7&&7<=t&&(u=u.next(function(){return i.ensureSequenceNumbers(a)})),e<8&&8<=t&&(u=u.next(function(){return i.createCollectionParentIndex(n,a)})),e<9&&9<=t&&(u=u.next(function(){var e,t;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(ii.store)).createIndex(ii.readTimeIndex,ii.readTimeIndexPath,{unique:!1}),t.createIndex(ii.collectionReadTimeIndex,ii.collectionReadTimeIndexPath,{unique:!1})})),u},Qr.prototype.addDocumentGlobal=function(t){var n=0;return t.store(ii.store).iterate(function(e,t){n+=Vr(t)}).next(function(){var e=new ai(n);return t.store(ai.store).put(ai.key,e)})},Qr.prototype.removeAcknowledgedMutations=function(r){var i=this,e=r.store(Jr.store),t=r.store($r.store);return e.loadAll().next(function(e){return vt.forEach(e,function(n){var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.loadAll($r.userMutationsIndex,e).next(function(e){return vt.forEach(e,function(e){v(e.userId===n.userId,"Cannot process batch "+e.batchId+" from unexpected user");var t=i.serializer.fromDbMutationBatch(e);return Pt(r,n.userId,t).next(function(){})})})})})},Qr.prototype.ensureSequenceNumbers=function(e){var a=e.store(hi.store),t=e.store(ii.store);return Ht(e).next(function(i){var o=[];return t.iterate(function(e,t){var n=new ve(e),r=[0,Fe(n)];o.push(a.get(r).next(function(e){return e?vt.resolve():(t=n,a.put(new hi(0,Fe(t),i)));var t}))}).next(function(){return vt.waitFor(o)})})},Qr.prototype.createCollectionParentIndex=function(e,t){function i(e){if(o.add(e)){var t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:Fe(n)})}}e.createObjectStore(pi.store,{keyPath:pi.keyPath});var r=t.store(pi.store),o=new jr;return t.store(ii.store).iterate({keysOnly:!0},function(e,t){var n=new ve(e);return i(n.popLast())}).next(function(){return t.store(ei.store).iterate({keysOnly:!0},function(e,t){e[0];var n=e[1],r=(e[2],Be(n));return i(r.popLast())})})},Qr);function Qr(e){this.serializer=e}var zr=function(e,t){this.seconds=e,this.nanoseconds=t},Hr=(Yr.store="owner",Yr.key="owner",Yr);function Yr(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}var Jr=(Xr.store="mutationQueues",Xr.keyPath="userId",Xr);function Xr(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}var $r=(Zr.store="mutations",Zr.keyPath="batchId",Zr.userMutationsIndex="userMutationsIndex",Zr.userMutationsKeyPath=["userId","batchId"],Zr);function Zr(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var ei=(ti.prefixForUser=function(e){return[e]},ti.prefixForPath=function(e,t){return[e,Fe(t)]},ti.key=function(e,t,n){return[e,Fe(t),n]},ti.store="documentMutations",ti.PLACEHOLDER=new ti,ti);function ti(){}var ni=function(e,t){this.path=e,this.readTime=t},ri=function(e,t){this.path=e,this.version=t},ii=(oi.store="remoteDocuments",oi.readTimeIndex="readTimeIndex",oi.readTimeIndexPath="readTime",oi.collectionReadTimeIndex="collectionReadTimeIndex",oi.collectionReadTimeIndexPath=["parentPath","readTime"],oi);function oi(e,t,n,r,i,o){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var ai=(si.store="remoteDocumentGlobal",si.key="remoteDocumentGlobalKey",si);function si(e){this.byteSize=e}var ui=(ci.store="targets",ci.keyPath="targetId",ci.queryTargetsIndexName="queryTargetsIndex",ci.queryTargetsKeyPath=["canonicalId","targetId"],ci);function ci(e,t,n,r,i,o,a){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}var hi=(li.store="targetDocuments",li.keyPath=["targetId","path"],li.documentTargetsIndex="documentTargetsIndex",li.documentTargetsKeyPath=["path","targetId"],li);function li(e,t,n){this.targetId=e,this.path=t,v(0===e==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var fi=(di.key="targetGlobalKey",di.store="targetGlobal",di);function di(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var pi=(mi.store="collectionParents",mi.keyPath=["collectionId","parent"],mi);function mi(e,t){this.collectionId=e,this.parent=t}function gi(e){e.createObjectStore(hi.store,{keyPath:hi.keyPath}).createIndex(hi.documentTargetsIndex,hi.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(ui.store,{keyPath:ui.keyPath}).createIndex(ui.queryTargetsIndexName,ui.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(fi.store)}var yi=(vi.store="clientMetadata",vi.keyPath="clientId",vi);function vi(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}var bi,wi,Ti=[Jr.store,$r.store,ei.store,ii.store,ui.store,Hr.store,fi.store,hi.store],Si=m.__spreadArrays(Ti,[yi.store]),_i=m.__spreadArrays(Si,[ai.store]),Ei=m.__spreadArrays(_i,[pi.store]),Ii=(Ci.prototype.addToCollectionParentIndex=function(e,t){var n=this;if(v(t.length%2==1,"Expected a collection path."),this.collectionParentsCache.has(t))return vt.resolve();var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(function(){n.collectionParentsCache.add(t)});var o={collectionId:r,parent:Fe(i)};return Di(e).put(o)},Ci.prototype.getCollectionParents=function(e,i){var o=[],t=IDBKeyRange.bound([i,""],[ne(i),""],!1,!0);return Di(e).loadAll(t).next(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(r.collectionId!==i)break;o.push(Be(r.parent))}return o})},Ci);function Ci(){this.collectionParentsCache=new jr}function Di(e){return Ji.getStore(e,pi.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(wi=bi=bi||{})[wi.Listen=0]="Listen",wi[wi.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",wi[wi.LimboResolution=2]="LimboResolution";var Ai=(Ni.prototype.withSequenceNumber=function(e){return new Ni(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Ni.prototype.withResumeToken=function(e,t){return new Ni(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)},Ni.prototype.withLastLimboFreeSnapshotVersion=function(e){return new Ni(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},Ni.prototype.isEqual=function(e){return this.targetId===e.targetId&&this.purpose===e.purpose&&this.sequenceNumber===e.sequenceNumber&&this.snapshotVersion.isEqual(e.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(e.lastLimboFreeSnapshotVersion)&&this.resumeToken===e.resumeToken&&this.target.isEqual(e.target)},Ni);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ni(e,t,n,r,i,o,a){void 0===i&&(i=Ke.MIN),void 0===o&&(o=Ke.MIN),void 0===a&&(a=S()),this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var ki=(Mi.prototype.fromDbRemoteDocument=function(e){if(e.document)return this.remoteSerializer.fromDocument(e.document,!!e.hasCommittedMutations);if(e.noDocument){var t=Ee.fromSegments(e.noDocument.path),n=this.fromDbTimestamp(e.noDocument.readTime);return new _r(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}return e.unknownDocument?(t=Ee.fromSegments(e.unknownDocument.path),n=this.fromDbTimestamp(e.unknownDocument.version),new Cr(t,n)):w("Unexpected DbRemoteDocument")},Mi.prototype.toDbRemoteDocument=function(e,t){var n=this.toDbTimestampKey(t),r=e.key.path.popLast().toArray();if(e instanceof wr){var i=e.proto?e.proto:this.remoteSerializer.toDocument(e),o=e.hasCommittedMutations;return new ii(null,null,i,o,n,r)}if(e instanceof _r){var a=e.key.path.toArray(),s=this.toDbTimestamp(e.version);return o=e.hasCommittedMutations,new ii(null,new ni(a,s),null,o,n,r)}if(e instanceof Cr){a=e.key.path.toArray();var u=this.toDbTimestamp(e.version);return new ii(new ri(a,u),null,null,!0,n,r)}return w("Unexpected MaybeDocument")},Mi.prototype.toDbTimestampKey=function(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]},Mi.prototype.fromDbTimestampKey=function(e){var t=new Ue(e[0],e[1]);return Ke.fromTimestamp(t)},Mi.prototype.toDbTimestamp=function(e){var t=e.toTimestamp();return new zr(t.seconds,t.nanoseconds)},Mi.prototype.fromDbTimestamp=function(e){var t=new Ue(e.seconds,e.nanoseconds);return Ke.fromTimestamp(t)},Mi.prototype.toDbMutationBatch=function(e,t){var n=this,r=t.baseMutations.map(function(e){return n.remoteSerializer.toMutation(e)}),i=t.mutations.map(function(e){return n.remoteSerializer.toMutation(e)});return new $r(e,t.batchId,t.localWriteTime.toMillis(),r,i)},Mi.prototype.fromDbMutationBatch=function(e){var t=this,n=(e.baseMutations||[]).map(function(e){return t.remoteSerializer.fromMutation(e)}),r=e.mutations.map(function(e){return t.remoteSerializer.fromMutation(e)}),i=Ue.fromMillis(e.localWriteTimeMs);return new pt(e.batchId,i,n,r)},Mi.prototype.toDbResourcePaths=function(e){var t=[];return e.forEach(function(e){t.push(Fe(e.path))}),t},Mi.prototype.fromDbResourcePaths=function(e){for(var t=lt(),n=0,r=e;n<r.length;n++){var i=r[n];t=t.add(new Ee(Be(i)))}return t},Mi.prototype.fromDbTarget=function(e){var t,n=this.fromDbTimestamp(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(e.lastLimboFreeSnapshotVersion):Ke.MIN,i=e.resumeToken;return t=void 0!==e.query.documents?this.remoteSerializer.fromDocumentsTarget(e.query):this.remoteSerializer.fromQueryTarget(e.query),new Ai(t,e.targetId,bi.Listen,e.lastListenSequenceNumber,n,r,i)},Mi.prototype.toDbTarget=function(e){v(bi.Listen===e.purpose,"Only queries with purpose "+bi.Listen+" may be stored, got "+e.purpose);var t,n,r=this.toDbTimestamp(e.snapshotVersion),i=this.toDbTimestamp(e.lastLimboFreeSnapshotVersion);return t=e.target.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(e.target):this.remoteSerializer.toQueryTarget(e.target),n=e.resumeToken instanceof Uint8Array?(v(Tt.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence ."),e.resumeToken.toString()):e.resumeToken,new ui(e.targetId,e.target.canonicalId(),r,n,e.sequenceNumber,i,t)},Mi);function Mi(e){this.remoteSerializer=e}
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ri(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],a=ee(n,i);return 0===a?ee(r,o):a}var Oi=(Li.prototype.nextIndex=function(){return++this.previousIndex},Li.prototype.addElement=function(e){var t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();Ri(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}},Object.defineProperty(Li.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Li);function Li(e){this.maxElements=e,this.buffer=new Ze(Ri),this.previousIndex=0}var Pi={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},xi=(Fi.withCacheSize=function(e){return new Fi(e,Fi.DEFAULT_COLLECTION_PERCENTILE,Fi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},Fi.COLLECTION_DISABLED=-1,Fi.MINIMUM_CACHE_SIZE_BYTES=1048576,Fi.DEFAULT=new Fi(Fi.DEFAULT_CACHE_SIZE_BYTES=41943040,Fi.DEFAULT_COLLECTION_PERCENTILE=10,Fi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),Fi.DISABLED=new Fi(Fi.COLLECTION_DISABLED,0,0),Fi);function Fi(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}var qi=(Vi.prototype.start=function(){v(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==xi.COLLECTION_DISABLED&&this.scheduleGC()},Vi.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(Vi.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),Vi.prototype.scheduleGC=function(){var e=this;v(null===this.gcTask,"Cannot schedule GC while a task is pending");var t=this.hasRun?3e5:6e4;y("LruGarbageCollector","Garbage collection scheduled in "+t+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Ce.LruGarbageCollection,t,function(){return e.gcTask=null,e.hasRun=!0,e.localStore.collectGarbage(e.garbageCollector).then(function(){return e.scheduleGC()}).catch($i)})},Vi);function Vi(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.hasRun=!1,this.gcTask=null}var Bi=(Ui.prototype.calculateTargetCount=function(e,t){return this.delegate.getSequenceNumberCount(e).next(function(e){return Math.floor(t/100*e)})},Ui.prototype.nthSequenceNumber=function(e,t){var n=this;if(0===t)return vt.resolve(fe.INVALID);var r=new Oi(t);return this.delegate.forEachTarget(e,function(e){return r.addElement(e.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(e,function(e){return r.addElement(e)})}).next(function(){return r.maxValue})},Ui.prototype.removeTargets=function(e,t,n){return this.delegate.removeTargets(e,t,n)},Ui.prototype.removeOrphanedDocuments=function(e,t){return this.delegate.removeOrphanedDocuments(e,t)},Ui.prototype.collect=function(t,n){var r=this;return this.params.cacheSizeCollectionThreshold===xi.COLLECTION_DISABLED?(y("LruGarbageCollector","Garbage collection skipped; disabled"),vt.resolve(Pi)):this.getCacheSize(t).next(function(e){return e<r.params.cacheSizeCollectionThreshold?(y("LruGarbageCollector","Garbage collection skipped; Cache size "+e+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Pi):r.runGarbageCollection(t,n)})},Ui.prototype.getCacheSize=function(e){return this.delegate.getCacheSize(e)},Ui.prototype.runGarbageCollection=function(t,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return i=e>h.params.maximumSequenceNumbersToCollect?(y("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),h.params.maximumSequenceNumbersToCollect):e,a=Date.now(),h.nthSequenceNumber(t,i)}).next(function(e){return r=e,s=Date.now(),h.removeTargets(t,r,n)}).next(function(e){return o=e,u=Date.now(),h.removeOrphanedDocuments(t,r)}).next(function(e){return c=Date.now(),g()<=f.DEBUG&&y("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+e+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),vt.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:e})})},Ui);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ui(e,t){this.delegate=e,this.params=t}var ji=(Ki.prototype.addOnCommittedListener=function(e){this.onCommittedListeners.push(e)},Ki.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(e){return e()})},Ki);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ki(){this.onCommittedListeners=[]}var Wi,Gi="IndexedDbPersistence",Qi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",zi="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Hi=(Wi=ji,m.__extends(Yi,Wi),Yi);function Yi(e,t){var n=Wi.call(this)||this;return n.simpleDbTransaction=e,n.currentSequenceNumber=t,n}var Ji=(Xi.getStore=function(e,t){if(e instanceof Hi)return Tt.getStore(e.simpleDbTransaction,t);throw w("IndexedDbPersistence must use instances of IndexedDbTransaction")},Xi.createIndexedDbPersistence=function(n){return m.__awaiter(this,void 0,void 0,function(){var t;return m.__generator(this,function(e){switch(e.label){case 0:if(!Xi.isAvailable())throw new I(E.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(t=new Xi(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.lruParams,n.queue,n.serializer,n.sequenceNumberSyncer)).start()];case 1:return e.sent(),[2,t]}})})},Xi.prototype.start=function(){var t=this;return v(!this.started,"IndexedDbPersistence double-started!"),v(null!==this.window,"Expected 'window' to be defined"),Tt.openOrCreate(this.dbName,Wr,new Gr(this.serializer)).then(function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.simpleDb.runTransaction("readonly-idempotent",[fi.store],function(e){return Ht(e)})}).then(function(e){t.listenSequence=new fe(e,t.sequenceNumberSyncer)}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},Xi.prototype.setPrimaryStateListener=function(n){var e=this;return this.primaryStateListener=function(t){return m.__awaiter(e,void 0,void 0,function(){return m.__generator(this,function(e){return this.started?[2,n(t)]:[2]})})},n(this.isPrimary)},Xi.prototype.setDatabaseDeletedListener=function(n){var e=this;this.simpleDb.setVersionChangeListener(function(t){return m.__awaiter(e,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return null!==t.newVersion?[3,2]:[4,n()];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},Xi.prototype.setNetworkEnabled=function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(function(){return m.__awaiter(t,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})}))},Xi.prototype.updateClientMetadataAndTryBecomePrimary=function(){var n=this;return this.simpleDb.runTransaction("readwrite-idempotent",Ei,function(t){return eo(t).put(new yi(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.verifyPrimaryLease(t).next(function(e){e||(n.isPrimary=!1,n.queue.enqueueAndForget(function(){return n.primaryStateListener(!1)}))})}).next(function(){return n.canActAsPrimary(t)}).next(function(e){return n.isPrimary&&!e?n.releasePrimaryLeaseIfHeld(t).next(function(){return!1}):!!e&&n.acquireOrExtendPrimaryLease(t).next(function(){return!0})})}).catch(function(e){if(!n.allowTabSynchronization)throw e;return y(Gi,"Releasing owner lease after error during lease refresh",e),!1}).then(function(e){n.isPrimary!==e&&n.queue.enqueueAndForget(function(){return n.primaryStateListener(e)}),n.isPrimary=e})},Xi.prototype.verifyPrimaryLease=function(e){var t=this;return Zi(e).get(Hr.key).next(function(e){return vt.resolve(t.isLocalClient(e))})},Xi.prototype.removeClientMetadata=function(e){return eo(e).delete(this.clientId)},Xi.prototype.maybeGarbageCollectMultiClientState=function(){return m.__awaiter(this,void 0,void 0,function(){var i=this;return m.__generator(this,function(e){switch(e.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(e){var r=Xi.getStore(e,yi.store);return r.loadAll().next(function(e){var t=i.filterActiveClients(e,18e5),n=e.filter(function(e){return-1===t.indexOf(e)});return vt.forEach(n,function(e){return r.delete(e.clientId)}).next(function(){return n})})})]);case 1:e.sent().forEach(function(e){i.window.localStorage.removeItem(i.zombiedClientLocalStorageKey(e.clientId))}),e.label=2;case 2:return[2]}})})},Xi.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var e=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Ce.ClientMetadataRefresh,4e3,function(){return e.updateClientMetadataAndTryBecomePrimary().then(function(){return e.maybeGarbageCollectMultiClientState()}).then(function(){return e.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},Xi.prototype.isLocalClient=function(e){return!!e&&e.ownerId===this.clientId},Xi.prototype.canActAsPrimary=function(t){var i=this;return Zi(t).get(Hr.key).next(function(e){if(null!==e&&i.isWithinAge(e.leaseTimestampMs,5e3)&&!i.isClientZombied(e.ownerId)){if(i.isLocalClient(e)&&i.networkEnabled)return!0;if(!i.isLocalClient(e)){if(!e.allowTabSynchronization)throw new I(E.FAILED_PRECONDITION,zi);return!1}}return!(!i.networkEnabled||!i.inForeground)||eo(t).loadAll().next(function(e){return void 0===i.filterActiveClients(e,5e3).find(function(e){if(i.clientId!==e.clientId){var t=!i.networkEnabled&&e.networkEnabled,n=!i.inForeground&&e.inForeground,r=i.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1})})}).next(function(e){return i.isPrimary!==e&&y(Gi,"Client "+(e?"is":"is not")+" eligible for a primary lease."),e})},Xi.prototype.shutdown=function(){return m.__awaiter(this,void 0,void 0,function(){var t=this;return m.__generator(this,function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite-idempotent",[Hr.store,yi.store],function(e){return t.releasePrimaryLeaseIfHeld(e).next(function(){return t.removeClientMetadata(e)})})];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},Xi.prototype.filterActiveClients=function(e,t){var n=this;return e.filter(function(e){return n.isWithinAge(e.updateTimeMs,t)&&!n.isClientZombied(e.clientId)})},Xi.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly-idempotent",[yi.store],function(e){return eo(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(e){return e.clientId})})})},Xi.clearPersistence=function(n){return m.__awaiter(this,void 0,void 0,function(){var t;return m.__generator(this,function(e){switch(e.label){case 0:return Xi.isAvailable()?(t=n+Xi.MAIN_DATABASE,[4,Tt.delete(t)]):[2,Promise.resolve()];case 1:return e.sent(),[2]}})})},Object.defineProperty(Xi.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Xi.prototype.getMutationQueue=function(e){return v(this.started,"Cannot initialize MutationQueue before persistence is started."),Rt.forUser(e,this.serializer,this.indexManager,this.referenceDelegate)},Xi.prototype.getTargetCache=function(){return v(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},Xi.prototype.getRemoteDocumentCache=function(){return v(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},Xi.prototype.getIndexManager=function(){return v(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},Xi.prototype.runTransaction=function(n,e,r){var i=this;y(Gi,"Starting transaction:",n);var o,t=e.endsWith("idempotent"),a=e.startsWith("readonly")?t?"readonly-idempotent":"readonly":t?"readwrite-idempotent":"readwrite";return this.simpleDb.runTransaction(a,Ei,function(t){return o=new Hi(t,i.listenSequence.next()),"readwrite-primary"===e||"readwrite-primary-idempotent"===e?i.verifyPrimaryLease(t).next(function(e){return!!e||i.canActAsPrimary(t)}).next(function(e){if(!e)throw c("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new I(E.FAILED_PRECONDITION,Qi);return r(o)}).next(function(e){return i.acquireOrExtendPrimaryLease(t).next(function(){return e})}):i.verifyAllowTabSynchronization(t).next(function(){return r(o)})}).then(function(e){return o.raiseOnCommittedEvent(),e})},Xi.prototype.verifyAllowTabSynchronization=function(e){var t=this;return Zi(e).get(Hr.key).next(function(e){if(null!==e&&t.isWithinAge(e.leaseTimestampMs,5e3)&&!t.isClientZombied(e.ownerId)&&!t.isLocalClient(e)&&!e.allowTabSynchronization)throw new I(E.FAILED_PRECONDITION,zi)})},Xi.prototype.acquireOrExtendPrimaryLease=function(e){var t=new Hr(this.clientId,this.allowTabSynchronization,Date.now());return Zi(e).put(Hr.key,t)},Xi.isAvailable=function(){return Tt.isAvailable()},Xi.buildStoragePrefix=function(e){var t=e.databaseId.projectId;return e.databaseId.isDefaultDatabase||(t+="."+e.databaseId.database),"firestore/"+e.persistenceKey+"/"+t+"/"},Xi.prototype.releasePrimaryLeaseIfHeld=function(e){var t=this,n=Zi(e);return n.get(Hr.key).next(function(e){return t.isLocalClient(e)?(y(Gi,"Releasing primary lease."),n.delete(Hr.key)):vt.resolve()})},Xi.prototype.isWithinAge=function(e,t){var n=Date.now();return!(e<n-t||n<e&&(c("Detected an update time that is in the future: "+e+" > "+n),1))},Xi.prototype.attachVisibilityHandler=function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){e.queue.enqueueAndForget(function(){return e.inForeground="visible"===e.document.visibilityState,e.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},Xi.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(v(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},Xi.prototype.attachWindowUnloadHook=function(){var e=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){e.markClientZombied(),e.queue.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},Xi.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(v("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},Xi.prototype.isClientZombied=function(e){try{var t=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(e));return y(Gi,"Client '"+e+"' "+(t?"is":"is not")+" zombied in LocalStorage"),t}catch(e){return c(Gi,"Failed to get zombied client id.",e),!1}},Xi.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){c("Failed to set zombie client id.",e)}},Xi.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}},Xi.prototype.zombiedClientLocalStorageKey=function(e){return"firestore_zombie_"+this.persistenceKey+"_"+e},Xi.MAIN_DATABASE="main",Xi);function Xi(e,t,n,r,i,o,a,s){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.queue=o,this.sequenceNumberSyncer=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(e){return Promise.resolve()},this.referenceDelegate=new to(this,i),this.dbName=t+Xi.MAIN_DATABASE,this.serializer=new ki(a),this.document=r.document,this.targetCache=new Wt(this.referenceDelegate,this.serializer),this.indexManager=new Ii,this.remoteDocumentCache=new Or(this.serializer,this.indexManager),!r.window||!r.window.localStorage)throw new I(E.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}function $i(n){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){if((t=n).code!==E.FAILED_PRECONDITION||t.message!==Qi)throw n;var t;return y(Gi,"Unexpectedly lost primary lease"),[2]})})}function Zi(e){return e.store(Hr.store)}function eo(e){return e.store(yi.store)}var to=(no.prototype.getSequenceNumberCount=function(e){var n=this.orphanedDocmentCount(e);return this.db.getTargetCache().getTargetCount(e).next(function(t){return n.next(function(e){return t+e})})},no.prototype.orphanedDocmentCount=function(e){var t=0;return this.forEachOrphanedDocumentSequenceNumber(e,function(e){t++}).next(function(){return t})},no.prototype.forEachTarget=function(e,t){return this.db.getTargetCache().forEachTarget(e,t)},no.prototype.forEachOrphanedDocumentSequenceNumber=function(e,n){return this.forEachOrphanedDocument(e,function(e,t){return n(t)})},no.prototype.setInMemoryPins=function(e){this.inMemoryPins=e},no.prototype.addReference=function(e,t){return ro(e,t)},no.prototype.removeReference=function(e,t){return ro(e,t)},no.prototype.removeTargets=function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)},no.prototype.removeMutationReference=function(e,t){return ro(e,t)},no.prototype.isPinned=function(e,t){return this.inMemoryPins.containsKey(t)?vt.resolve(!0):(r=t,i=!1,Vt(n=e).iterateSerial(function(e){return Lt(n,e,r).next(function(e){return e&&(i=!0),vt.resolve(!e)})}).next(function(){return i}));var n,r,i},no.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],u=0;return this.forEachOrphanedDocument(r,function(t,e){if(e<=i){var n=o.isPinned(r,t).next(function(e){if(!e)return u++,a.getEntry(r,t).next(function(){return a.removeEntry(t),Yt(r).delete([0,Fe(t.path)])})});s.push(n)}}).next(function(){return vt.waitFor(s)}).next(function(){return a.apply(r)}).next(function(){return u})},no.prototype.removeTarget=function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)},no.prototype.updateLimboDocument=function(e,t){return ro(e,t)},no.prototype.forEachOrphanedDocument=function(e,o){var a,t=Yt(e),s=fe.INVALID;return t.iterate({index:hi.documentTargetsIndex},function(e,t){var n=e[0],r=(e[1],t.path),i=t.sequenceNumber;0===n?(s!==fe.INVALID&&o(new Ee(Be(a)),s),s=i,a=r):s=fe.INVALID}).next(function(){s!==fe.INVALID&&o(new Ee(Be(a)),s)})},no.prototype.getCacheSize=function(e){return this.db.getRemoteDocumentCache().getSize(e)},no);function no(e,t){this.db=e,this.inMemoryPins=null,this.garbageCollector=new Bi(this,t)}function ro(e,t){return Yt(e).put((n=t,r=e.currentSequenceNumber,new hi(0,Fe(n.path),r)));var n,r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var io=Number,oo=io.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),ao=io.MAX_SAFE_INTEGER||Math.pow(2,53)-1,so=io.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function uo(e){return null==e}function co(e){return so(e)&&e<=ao&&oo<=e}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ho,lo,fo=(po.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var e=this.path.canonicalString();null!==this.collectionGroup&&(e+="|cg:"+this.collectionGroup),e+="|f:";for(var t=0,n=this.filters;t<n.length;t++)e+=n[t].canonicalId(),e+=",";e+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)e+=i[r].canonicalId(),e+=",";uo(this.limit)||(e+="|l:",e+=this.limit),this.startAt&&(e+="|lb:",e+=this.startAt.canonicalId()),this.endAt&&(e+="|ub:",e+=this.endAt.canonicalId()),this.memoizedCanonicalId=e}return this.memoizedCanonicalId},po.prototype.toString=function(){var e=this.path.canonicalString();return null!==this.collectionGroup&&(e+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(e+=", filters: ["+this.filters.join(", ")+"]"),uo(this.limit)||(e+=", limit: "+this.limit),0<this.orderBy.length&&(e+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(e+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(e+=", endAt: "+this.endAt.canonicalId()),"Target("+e+")"},po.prototype.isEqual=function(e){if(this.limit!==e.limit)return!1;if(this.orderBy.length!==e.orderBy.length)return!1;for(var t=0;t<this.orderBy.length;t++)if(!this.orderBy[t].isEqual(e.orderBy[t]))return!1;if(this.filters.length!==e.filters.length)return!1;for(t=0;t<this.filters.length;t++)if(!this.filters[t].isEqual(e.filters[t]))return!1;return this.collectionGroup===e.collectionGroup&&!!this.path.isEqual(e.path)&&!(null!==this.startAt?!this.startAt.isEqual(e.startAt):null!==e.startAt)&&(null!==this.endAt?this.endAt.isEqual(e.endAt):null===e.endAt)},po.prototype.isDocumentQuery=function(){return Ee.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},po);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function po(e,t,n,r,i,o,a){void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}(lo=ho=ho||{}).First="F",lo.Last="L";var mo=(go.atPath=function(e){return new go(e)},Object.defineProperty(go.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var e=this.getInequalityFilterField(),t=this.getFirstOrderByField();if(null!==e&&null===t)e.isKeyField()?this.memoizedOrderBy=[Wo]:this.memoizedOrderBy=[new jo(e),Wo];else{v(null===e||null!==t&&e.isEqual(t),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:qo.ASCENDING;this.memoizedOrderBy.push(a===qo.ASCENDING?Wo:Go)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),go.prototype.addFilter=function(e){v(null==this.getInequalityFilterField()||!(e instanceof To)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),v(!this.isDocumentQuery(),"No filtering allowed for document query");var t=this.filters.concat([e]);return new go(this.path,this.collectionGroup,this.explicitOrderBy.slice(),t,this.limit,this.limitType,this.startAt,this.endAt)},go.prototype.addOrderBy=function(e){v(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var t=this.explicitOrderBy.concat([e]);return new go(this.path,this.collectionGroup,t,this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},go.prototype.withLimitToFirst=function(e){return new go(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,ho.First,this.startAt,this.endAt)},go.prototype.withLimitToLast=function(e){return new go(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,ho.Last,this.startAt,this.endAt)},go.prototype.withStartAt=function(e){return new go(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,e,this.endAt)},go.prototype.withEndAt=function(e){return new go(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,e)},go.prototype.asCollectionQueryAtPath=function(e){return new go(e,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},go.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},go.prototype.canonicalId=function(){return this.toTarget().canonicalId()+"|lt:"+this.limitType},go.prototype.toString=function(){return"Query(target="+this.toTarget().toString()+"; limitType="+this.limitType+")"},go.prototype.isEqual=function(e){return this.toTarget().isEqual(e.toTarget())&&this.limitType===e.limitType},go.prototype.docComparator=function(e,t){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(e,t);if(0!==a)return a;n=n||o.field.isKeyField()}return v(n,"orderBy used that doesn't compare on key field"),0},go.prototype.matches=function(e){return this.matchesPathAndCollectionGroup(e)&&this.matchesOrderBy(e)&&this.matchesFilters(e)&&this.matchesBounds(e)},go.prototype.hasLimitToFirst=function(){return!uo(this.limit)&&this.limitType===ho.First},go.prototype.hasLimitToLast=function(){return!uo(this.limit)&&this.limitType===ho.Last},go.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},go.prototype.getInequalityFilterField=function(){for(var e=0,t=this.filters;e<t.length;e++){var n=t[e];if(n instanceof To&&n.isInequality())return n.field}return null},go.prototype.findFilterOperator=function(e){for(var t=0,n=this.filters;t<n.length;t++){var r=n[t];if(r instanceof To&&0<=e.indexOf(r.op))return r.op}return null},go.prototype.isDocumentQuery=function(){return this.toTarget().isDocumentQuery()},go.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},go.prototype.toTarget=function(){if(!this.memoizedTarget)if(this.limitType===ho.First)this.memoizedTarget=new fo(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var e=[],t=0,n=this.orderBy;t<n.length;t++){var r=n[t],i=r.dir===qo.DESCENDING?qo.ASCENDING:qo.DESCENDING;e.push(new jo(r.field,i))}var o=this.endAt?new Bo(this.endAt.position,!this.endAt.before):null,a=this.startAt?new Bo(this.startAt.position,!this.startAt.before):null;this.memoizedTarget=new fo(this.path,this.collectionGroup,e,this.filters,this.limit,o,a)}return this.memoizedTarget},go.prototype.matchesPathAndCollectionGroup=function(e){var t=e.key.path;return null!==this.collectionGroup?e.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(t):Ee.isDocumentKey(this.path)?this.path.isEqual(t):this.path.isImmediateParentOf(t)},go.prototype.matchesOrderBy=function(e){for(var t=0,n=this.explicitOrderBy;t<n.length;t++){var r=n[t];if(!r.field.isKeyField()&&null===e.field(r.field))return!1}return!0},go.prototype.matchesFilters=function(e){for(var t=0,n=this.filters;t<n.length;t++)if(!n[t].matches(e))return!1;return!0},go.prototype.matchesBounds=function(e){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,e)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,e))},go.prototype.assertValidBound=function(e){v(e.position.length<=this.orderBy.length,"Bound is longer than orderBy")},go);function go(e,t,n,r,i,o,a,s){void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=ho.First),void 0===a&&(a=null),void 0===s&&(s=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}function yo(){}var vo=(bo.fromString=function(e){switch(e){case"<":return bo.LESS_THAN;case"<=":return bo.LESS_THAN_OR_EQUAL;case"==":return bo.EQUAL;case">=":return bo.GREATER_THAN_OR_EQUAL;case">":return bo.GREATER_THAN;case"array-contains":return bo.ARRAY_CONTAINS;case"in":return bo.IN;case"array-contains-any":return bo.ARRAY_CONTAINS_ANY;default:return w("Unknown FieldFilter operator: "+e)}},bo.prototype.toString=function(){return this.name},bo.prototype.isEqual=function(e){return this.name===e.name},bo.LESS_THAN=new bo("<"),bo.LESS_THAN_OR_EQUAL=new bo("<="),bo.EQUAL=new bo("=="),bo.GREATER_THAN=new bo(">"),bo.GREATER_THAN_OR_EQUAL=new bo(">="),bo.ARRAY_CONTAINS=new bo("array-contains"),bo.IN=new bo("in"),bo.ARRAY_CONTAINS_ANY=new bo("array-contains-any"),bo);function bo(e){this.name=e}var wo,To=(wo=yo,m.__extends(So,wo),So.create=function(e,t,n){if(e.isKeyField())return t===vo.IN?(v(n instanceof mr,"Comparing on key with IN, but filter value not an ArrayValue"),v(n.internalValue.every(function(e){return e instanceof ar}),"Comparing on key with IN, but an array value was not a RefValue"),new Do(e,n)):(v(n instanceof ar,"Comparing on key, but filter value not a RefValue"),v(t!==vo.ARRAY_CONTAINS&&t!==vo.ARRAY_CONTAINS_ANY,"'"+t.toString()+"' queries don't make sense on document keys."),new Eo(e,t,n));if(n.isEqual(Rn.INSTANCE)){if(t!==vo.EQUAL)throw new I(E.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new So(e,t,n)}if(n.isEqual(Gn.NAN)){if(t!==vo.EQUAL)throw new I(E.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new So(e,t,n)}return t===vo.ARRAY_CONTAINS?new ko(e,n):t===vo.IN?(v(n instanceof mr,"IN filter has invalid value: "+n.toString()),new Oo(e,n)):t===vo.ARRAY_CONTAINS_ANY?(v(n instanceof mr,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new xo(e,n)):new So(e,t,n)},So.prototype.matches=function(e){var t=e.field(this.field);return null!==t&&this.value.typeOrder===t.typeOrder&&this.matchesComparison(t.compareTo(this.value))},So.prototype.matchesComparison=function(e){switch(this.op){case vo.LESS_THAN:return e<0;case vo.LESS_THAN_OR_EQUAL:return e<=0;case vo.EQUAL:return 0===e;case vo.GREATER_THAN:return 0<e;case vo.GREATER_THAN_OR_EQUAL:return 0<=e;default:return w("Unknown FieldFilter operator: "+this.op)}},So.prototype.isInequality=function(){return 0<=[vo.LESS_THAN,vo.LESS_THAN_OR_EQUAL,vo.GREATER_THAN,vo.GREATER_THAN_OR_EQUAL].indexOf(this.op)},So.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},So.prototype.isEqual=function(e){return e instanceof So&&this.op.isEqual(e.op)&&this.field.isEqual(e.field)&&this.value.isEqual(e.value)},So.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},So);function So(e,t,n){var r=wo.call(this)||this;return r.field=e,r.op=t,r.value=n,r}var _o,Eo=(_o=To,m.__extends(Io,_o),Io.prototype.matches=function(e){var t=this.value,n=Ee.comparator(e.key,t.key);return this.matchesComparison(n)},Io);function Io(){return null!==_o&&_o.apply(this,arguments)||this}var Co,Do=(Co=To,m.__extends(Ao,Co),Ao.prototype.matches=function(t){return this.value.internalValue.some(function(e){return t.key.isEqual(e.key)})},Ao);function Ao(e,t){var n=Co.call(this,e,vo.IN,t)||this;return n.value=t,n}var No,ko=(No=To,m.__extends(Mo,No),Mo.prototype.matches=function(e){var t=e.field(this.field);return t instanceof mr&&t.contains(this.value)},Mo);function Mo(e,t){return No.call(this,e,vo.ARRAY_CONTAINS,t)||this}var Ro,Oo=(Ro=To,m.__extends(Lo,Ro),Lo.prototype.matches=function(e){var t=this.value,n=e.field(this.field);return null!==n&&t.contains(n)},Lo);function Lo(e,t){var n=Ro.call(this,e,vo.IN,t)||this;return n.value=t,n}var Po,xo=(Po=To,m.__extends(Fo,Po),Fo.prototype.matches=function(e){var t=this,n=e.field(this.field);return n instanceof mr&&n.internalValue.some(function(e){return t.value.contains(e)})},Fo);function Fo(e,t){var n=Po.call(this,e,vo.ARRAY_CONTAINS_ANY,t)||this;return n.value=t,n}var qo=(Vo.prototype.toString=function(){return this.name},Vo.ASCENDING=new Vo("asc"),Vo.DESCENDING=new Vo("desc"),Vo);function Vo(e){this.name=e}var Bo=(Uo.prototype.canonicalId=function(){for(var e=this.before?"b:":"a:",t=0,n=this.position;t<n.length;t++)e+=n[t].toString();return e},Uo.prototype.sortsBeforeDocument=function(e,t){v(this.position.length<=e.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=e[r],o=this.position[r];if(i.field.isKeyField())v(o instanceof ar,"Bound has a non-key value where the key path is being used."),n=Ee.comparator(o.key,t.key);else{var a=t.field(i.field);v(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===qo.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Uo.prototype.isEqual=function(e){if(null===e)return!1;if(this.before!==e.before||this.position.length!==e.position.length)return!1;for(var t=0;t<this.position.length;t++){var n=this.position[t],r=e.position[t];if(!n.isEqual(r))return!1}return!0},Uo);function Uo(e,t){this.position=e,this.before=t}var jo=(Ko.prototype.compare=function(e,t){var n=this.isKeyOrderBy?wr.compareByKey(e,t):wr.compareByField(this.field,e,t);switch(this.dir){case qo.ASCENDING:return n;case qo.DESCENDING:return-1*n;default:return w("Unknown direction: "+this.dir)}},Ko.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},Ko.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},Ko.prototype.isEqual=function(e){return this.dir===e.dir&&this.field.isEqual(e.field)},Ko);function Ko(e,t){this.field=e,void 0===t&&(t=qo.ASCENDING),this.dir=t,this.isKeyOrderBy=e.isKeyField()}var Wo=new jo(Se.keyField(),qo.ASCENDING),Go=new jo(Se.keyField(),qo.DESCENDING),Qo=(zo.prototype.setLocalDocumentsView=function(e){this.localDocumentsView=e},zo.prototype.getDocumentsMatchingQuery=function(t,r,i,o){var a=this;return v(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),r.matchesAllDocuments()||i.isEqual(Ke.MIN)?this.executeFullCollectionScan(t,r):this.localDocumentsView.getDocuments(t,o).next(function(e){var n=a.applyQuery(r,e);return(r.hasLimitToFirst()||r.hasLimitToLast())&&a.needsRefill(r.limitType,n,o,i)?a.executeFullCollectionScan(t,r):(g()<=f.DEBUG&&y("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),a.localDocumentsView.getDocumentsMatchingQuery(t,r,i).next(function(t){return n.forEach(function(e){t=t.insert(e.key,e)}),t}))})},zo.prototype.applyQuery=function(n,e){var r=new Ze(function(e,t){return n.docComparator(e,t)});return e.forEach(function(e,t){t instanceof wr&&n.matches(t)&&(r=r.add(t))}),r},zo.prototype.needsRefill=function(e,t,n,r){if(n.size!==t.size)return!0;var i=e===ho.First?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))},zo.prototype.executeFullCollectionScan=function(e,t){return g()<=f.DEBUG&&y("IndexFreeQueryEngine","Using full collection scan to execute query: %s",t.toString()),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Ke.MIN)},zo);function zo(){}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ho=(Yo.prototype.getDocument=function(t,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,n).next(function(e){return r.getDocumentInternal(t,n,e)})},Yo.prototype.getDocumentInternal=function(e,r,i){return this.remoteDocumentCache.getEntry(e,r).next(function(e){for(var t=0,n=i;t<n.length;t++)e=n[t].applyToLocalView(r,e);return e})},Yo.prototype.applyLocalMutationsToDocuments=function(e,t,i){var o=ot();return t.forEach(function(e,t){for(var n=0,r=i;n<r.length;n++)t=r[n].applyToLocalView(e,t);o=o.insert(e,t)}),o},Yo.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},Yo.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(e){var t=o.applyLocalMutationsToDocuments(r,i,e),n=it();return t.forEach(function(e,t){t=t||new _r(e,Ke.forDeletedDoc()),n=n.insert(e,t)}),n})},Yo.prototype.getDocumentsMatchingQuery=function(e,t,n){return t.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(e,t.path):t.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)},Yo.prototype.getDocumentsMatchingDocumentQuery=function(e,t){return this.getDocument(e,new Ee(t)).next(function(e){var t=st();return e instanceof wr&&(t=t.insert(e.key,e)),t})},Yo.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r,i){var o=this;v(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var a=r.collectionGroup,s=st();return this.indexManager.getCollectionParents(n,a).next(function(e){return vt.forEach(e,function(e){var t=r.asCollectionQueryAtPath(e.child(a));return o.getDocumentsMatchingCollectionQuery(n,t,i).next(function(e){e.forEach(function(e,t){s=s.insert(e,t)})})}).next(function(){return s})})},Yo.prototype.getDocumentsMatchingCollectionQuery=function(t,n,e){var h,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,n,e).next(function(e){return h=e,r.mutationQueue.getAllMutationBatchesAffectingQuery(t,n)}).next(function(e){return l=e,r.addMissingBaseDocuments(t,l,h).next(function(e){h=e;for(var t=0,n=l;t<n.length;t++)for(var r=n[t],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=h.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);h=c instanceof wr?h.insert(s,c):h.remove(s)}})}).next(function(){return h.forEach(function(e,t){n.matches(t)||(h=h.remove(e))}),h})},Yo.prototype.addMissingBaseDocuments=function(e,t,n){for(var r=lt(),i=0,o=t;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof fn&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(e,r).next(function(e){return e.forEach(function(e,t){null!==t&&t instanceof wr&&(c=c.insert(e,t))}),c})},Yo);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yo(e,t,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.indexManager=n}var Jo=(Xo.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},Xo.prototype.addReference=function(e,t){var n=new $o(e,t);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},Xo.prototype.addReferences=function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})},Xo.prototype.removeReference=function(e,t){this.removeRef(new $o(e,t))},Xo.prototype.removeReferences=function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})},Xo.prototype.removeReferencesForId=function(e){var t=this,n=Ee.EMPTY,r=new $o(n,e),i=new $o(n,e+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(e){t.removeRef(e),o.push(e.key)}),o},Xo.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},Xo.prototype.removeRef=function(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)},Xo.prototype.referencesForId=function(e){var t=Ee.EMPTY,n=new $o(t,e),r=new $o(t,e+1),i=lt();return this.refsByTarget.forEachInRange([n,r],function(e){i=i.add(e.key)}),i},Xo.prototype.containsKey=function(e){var t=new $o(e,0),n=this.refsByKey.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)},Xo);function Xo(){this.refsByKey=new Ze($o.compareByKey),this.refsByTarget=new Ze($o.compareByTargetId)}var $o=(Zo.compareByKey=function(e,t){return Ee.comparator(e.key,t.key)||ee(e.targetOrBatchId,t.targetOrBatchId)},Zo.compareByTargetId=function(e,t){return ee(e.targetOrBatchId,t.targetOrBatchId)||Ee.comparator(e.key,t.key)},Zo);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zo(e,t){this.key=e,this.targetOrBatchId=t}var ea=(ta.prototype.start=function(){return this.synchronizeLastDocumentChangeReadTime()},ta.prototype.handleUserChange=function(i){return m.__awaiter(this,void 0,void 0,function(){var t,g,n,r=this;return m.__generator(this,function(e){switch(e.label){case 0:return t=this.mutationQueue,g=this.localDocuments,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(p){var m;return r.mutationQueue.getAllMutationBatches(p).next(function(e){return m=e,t=r.persistence.getMutationQueue(i),g=new Ho(r.remoteDocuments,t,r.persistence.getIndexManager()),t.getAllMutationBatches(p)}).next(function(e){for(var t=[],n=[],r=lt(),i=0,o=m;i<o.length;i++){var a=o[i];t.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=e;h<l.length;h++){a=l[h],n.push(a.batchId);for(var f=0,d=a.mutations;f<d.length;f++)c=d[f],r=r.add(c.key)}return g.getDocuments(p,r).next(function(e){return{affectedDocuments:e,removedBatchIds:t,addedBatchIds:n}})})})];case 1:return n=e.sent(),this.mutationQueue=t,this.localDocuments=g,this.queryEngine.setLocalDocumentsView(this.localDocuments),[2,n]}})})},ta.prototype.localWrite=function(s){var u,c=this,h=Ue.now(),e=s.reduce(function(e,t){return e.add(t.key)},lt());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(a){return c.localDocuments.getDocuments(a,e).next(function(e){u=e;for(var t=[],n=0,r=s;n<r.length;n++){var i=r[n],o=i.extractBaseValue(u.get(i.key));null!=o&&t.push(new fn(i.key,o,o.fieldMask(),rn.exists(!0)))}return c.mutationQueue.addMutationBatch(a,h,t,s)})}).then(function(e){var t=e.applyToLocalDocumentSet(u);return{batchId:e.batchId,changes:t}})},ta.prototype.lookupMutationDocuments=function(e){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(t){return n.mutationQueue.lookupMutationKeys(t,e).next(function(e){return e?n.localDocuments.getDocuments(t,e):vt.resolve(null)})})},ta.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(e){var t=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer({trackRemovals:!0});return i.mutationQueue.acknowledgeBatch(e,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(e,r,n)}).next(function(){return n.apply(e)}).next(function(){return i.mutationQueue.performConsistencyCheck(e)}).next(function(){return i.localDocuments.getDocuments(e,t)})})},ta.prototype.rejectBatch=function(e){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(t){var n;return r.mutationQueue.lookupMutationBatch(t,e).next(function(e){return v(null!==e,"Attempt to reject nonexistent batch!"),n=e.keys(),r.mutationQueue.removeMutationBatch(t,e)}).next(function(){return r.mutationQueue.performConsistencyCheck(t)}).next(function(){return r.localDocuments.getDocuments(t,n)})})},ta.prototype.getHighestUnacknowledgedBatchId=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)})},ta.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(e){return t.mutationQueue.getLastStreamToken(e)})},ta.prototype.setLastStreamToken=function(t){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(e){return n.mutationQueue.setLastStreamToken(e,t)})},ta.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(e){return t.targetCache.getLastRemoteSnapshotVersion(e)})},ta.prototype.applyRemoteEvent=function(u){var c=this,h=u.snapshotVersion,l=this.targetDataByTarget;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});l=c.targetDataByTarget;var a=[];k(u.targetChanges,function(e,t){var n=l.get(e);if(n){a.push(c.targetCache.removeMatchingKeys(o,t.removedDocuments,e).next(function(){return c.targetCache.addMatchingKeys(o,t.addedDocuments,e)}));var r=t.resumeToken;if(0<r.length){var i=n.withResumeToken(r,h).withSequenceNumber(o.currentSequenceNumber);l=l.insert(e,i),ta.shouldPersistTargetData(n,i,t)&&a.push(c.targetCache.updateTargetData(o,i))}}});var s=it(),n=lt();if(u.documentUpdates.forEach(function(e,t){n=n.add(e)}),a.push(i.getEntries(o,n).next(function(r){u.documentUpdates.forEach(function(e,t){var n=r.get(e);t instanceof _r&&t.version.isEqual(Ke.MIN)?(i.removeEntry(e,h),s=s.insert(e,t)):null==n||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(v(!Ke.MIN.isEqual(h),"Cannot add a document when the remote version is zero"),i.addEntry(t,h),s=s.insert(e,t)):y("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version),u.resolvedLimboDocuments.has(e)&&a.push(c.persistence.referenceDelegate.updateLimboDocument(o,e))})})),!h.isEqual(Ke.MIN)){var e=c.targetCache.getLastRemoteSnapshotVersion(o).next(function(e){return v(0<=h.compareTo(e),"Watch stream reverted to previous snapshot?? "+h+" < "+e),c.targetCache.setTargetsMetadata(o,o.currentSequenceNumber,h)});a.push(e)}return vt.waitFor(a).next(function(){return i.apply(o)}).next(function(){return c.localDocuments.getLocalViewOfDocuments(o,s)})}).then(function(e){return c.targetDataByTarget=l,e})},ta.shouldPersistTargetData=function(e,t,n){return v(0<t.resumeToken.length,"Attempted to persist target data with no resume token"),0===e.resumeToken.length||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},ta.prototype.notifyLocalViewChanges=function(e){for(var n=this,t=0,r=e;t<r.length;t++){var i=r[t],o=i.targetId;if(this.localViewReferences.addReferences(i.addedKeys,o),this.localViewReferences.removeReferences(i.removedKeys,o),!i.fromCache){var a=this.targetDataByTarget.get(o);v(null!==a,"Can't set limbo-free snapshot version for unknown target: "+o);var s=a.snapshotVersion,u=a.withLastLimboFreeSnapshotVersion(s);this.targetDataByTarget=this.targetDataByTarget.insert(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(t){return vt.forEach(e,function(e){return vt.forEach(e.removedKeys,function(e){return n.persistence.referenceDelegate.removeReference(t,e)})})})},ta.prototype.nextMutationBatch=function(t){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)})},ta.prototype.readDocument=function(t){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(e){return n.localDocuments.getDocument(e,t)})},ta.prototype.allocateTarget=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(t){var n;return i.targetCache.getTargetData(t,r).next(function(e){return e?(n=e,vt.resolve(n)):i.targetCache.allocateTargetId(t).next(function(e){return n=new Ai(r,e,bi.Listen,t.currentSequenceNumber),i.targetCache.addTargetData(t,n).next(function(){return n})})})}).then(function(e){return null===i.targetDataByTarget.get(e.targetId)&&(i.targetDataByTarget=i.targetDataByTarget.insert(e.targetId,e),i.targetIdByTarget.set(r,e.targetId)),e})},ta.prototype.getTargetData=function(e,t){var n=this.targetIdByTarget.get(t);return void 0!==n?vt.resolve(this.targetDataByTarget.get(n)):this.targetCache.getTargetData(e,t)},ta.prototype.releaseTarget=function(n,r){var i=this,o=this.targetDataByTarget.get(n);v(null!==o,"Tried to release nonexistent target: "+n);var e=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",e,function(t){var e=i.localViewReferences.removeReferencesForId(n);return r?vt.resolve():vt.forEach(e,function(e){return i.persistence.referenceDelegate.removeReference(t,e)}).next(function(){i.persistence.referenceDelegate.removeTarget(t,o)})}).then(function(){i.targetDataByTarget=i.targetDataByTarget.remove(n),i.targetIdByTarget.delete(o.target)})},ta.prototype.executeQuery=function(e,n){var r=this,i=Ke.MIN,o=lt();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(t){return r.getTargetData(t,e.toTarget()).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(t,e.targetId).next(function(e){o=e})}).next(function(){return r.queryEngine.getDocumentsMatchingQuery(t,e,n?i:Ke.MIN,n?o:lt())}).next(function(e){return{documents:e,remoteKeys:o}})})},ta.prototype.remoteDocumentKeys=function(t){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(e){return n.targetCache.getMatchingKeysForTargetId(e,t)})},ta.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},ta.prototype.removeCachedMutationBatchMetadata=function(e){this.mutationQueue.removeCachedMutationKeys(e)},ta.prototype.setNetworkEnabled=function(e){this.persistence.setNetworkEnabled(e)},ta.prototype.applyWriteToRemoteDocuments=function(e,i,o){var t=this,a=i.batch,n=a.keys(),s=vt.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(e,r)}).next(function(e){var t=e,n=i.docVersions.get(r);v(null!==n,"ackVersions should contain every doc in the write."),(!t||t.version.compareTo(n)<0)&&((t=a.applyToRemoteDocument(r,t,i))?o.addEntry(t,i.commitVersion):v(!e,"Mutation batch "+a+" applied to document "+e+" resulted in null"))})}),s.next(function(){return t.mutationQueue.removeMutationBatch(e,a)})},ta.prototype.collectGarbage=function(t){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(e){return t.collect(e,n.targetDataByTarget)})},ta.prototype.getTarget=function(t){var n=this,e=this.targetDataByTarget.get(t);return e?Promise.resolve(e.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(e){return n.targetCache.getTargetDataForTarget(e,t).next(function(e){return e?e.target:null})})},ta.prototype.getNewDocumentChanges=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(e){return r.remoteDocuments.getNewDocumentChanges(e,r.lastDocumentChangeReadTime)}).then(function(e){var t=e.changedDocs,n=e.readTime;return r.lastDocumentChangeReadTime=n,t})},ta.prototype.synchronizeLastDocumentChangeReadTime=function(){return m.__awaiter(this,void 0,void 0,function(){var t,n=this;return m.__generator(this,function(e){return this.remoteDocuments instanceof Or?(t=this.remoteDocuments,[2,this.persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(e){return t.getLastDocumentChange(e)}).then(function(e){var t=e.readTime;n.lastDocumentChangeReadTime=t})]):[2]})})},ta.RESUME_TOKEN_MAX_AGE_MICROS=3e8,ta);function ta(e,t,n){this.persistence=e,this.queryEngine=t,this.localViewReferences=new Jo,this.targetDataByTarget=new Ge(ee),this.targetIdByTarget=new Ar(function(e){return e.canonicalId()}),this.lastDocumentChangeReadTime=Ke.MIN,v(e.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=e.getMutationQueue(n),this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.localDocuments=new Ho(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var na=(ra.prototype.checkEmpty=function(e){return vt.resolve(0===this.mutationQueue.length)},ra.prototype.acknowledgeBatch=function(e,t,n){var r=t.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");v(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return v(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,vt.resolve()},ra.prototype.getLastStreamToken=function(e){return vt.resolve(this.lastStreamToken)},ra.prototype.setLastStreamToken=function(e,t){return this.lastStreamToken=t,vt.resolve()},ra.prototype.addMutationBatch=function(e,t,n,r){v(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&v(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new pt(i,t,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new $o(u.key,i)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast())}return vt.resolve(o)},ra.prototype.lookupMutationBatch=function(e,t){return vt.resolve(this.findMutationBatch(t))},ra.prototype.lookupMutationKeys=function(e,t){var n=this.findMutationBatch(t);return v(null!=n,"Failed to find local mutation batch."),vt.resolve(n.keys())},ra.prototype.getNextMutationBatchAfterBatchId=function(e,t){var n=t+1,r=this.indexOfBatchId(n),i=r<0?0:r;return vt.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},ra.prototype.getHighestUnacknowledgedBatchId=function(){return vt.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},ra.prototype.getAllMutationBatches=function(e){return vt.resolve(this.mutationQueue.slice())},ra.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,n){var r=this,t=new $o(n,0),i=new $o(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([t,i],function(e){v(n.isEqual(e.key),"Should only iterate over a single key's batches");var t=r.findMutationBatch(e.targetOrBatchId);v(null!==t,"Batches in the index must exist in the main table"),o.push(t)}),vt.resolve(o)},ra.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var r=this,i=new Ze(ee);return t.forEach(function(t){var e=new $o(t,0),n=new $o(t,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([e,n],function(e){v(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),i=i.add(e.targetOrBatchId)})}),vt.resolve(this.findMutationBatches(i))},ra.prototype.getAllMutationBatchesAffectingQuery=function(e,t){v(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=t.path,r=n.length+1,i=n;Ee.isDocumentKey(i)||(i=i.child(""));var o=new $o(new Ee(i),0),a=new Ze(ee);return this.batchesByDocumentKey.forEachWhile(function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.targetOrBatchId)),!0)},o),vt.resolve(this.findMutationBatches(a))},ra.prototype.findMutationBatches=function(e){var n=this,r=[];return e.forEach(function(e){var t=n.findMutationBatch(e);null!==t&&r.push(t)}),r},ra.prototype.removeMutationBatch=function(n,r){var i=this;v(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return vt.forEach(r.mutations,function(e){var t=new $o(e.key,r.batchId);return o=o.delete(t),i.referenceDelegate.removeMutationReference(n,e.key)}).next(function(){i.batchesByDocumentKey=o})},ra.prototype.removeCachedMutationKeys=function(e){},ra.prototype.containsKey=function(e,t){var n=new $o(t,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return vt.resolve(t.isEqual(r&&r.key))},ra.prototype.performConsistencyCheck=function(e){return 0===this.mutationQueue.length&&v(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),vt.resolve()},ra.prototype.indexOfExistingBatchId=function(e,t){var n=this.indexOfBatchId(e);return v(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+t),n},ra.prototype.indexOfBatchId=function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId},ra.prototype.findMutationBatch=function(e){var t=this.indexOfBatchId(e);if(t<0||t>=this.mutationQueue.length)return null;var n=this.mutationQueue[t];return v(n.batchId===e,"If found batch must match"),n},ra);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ra(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=S(),this.batchesByDocumentKey=new Ze($o.compareByKey)}var ia,oa=(aa.prototype.addEntry=function(e,t,n){v(!n.isEqual(Ke.MIN),"Cannot add a document with a read time of zero");var r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(t);return this.docs=this.docs.insert(r,{maybeDocument:t,size:a,readTime:n}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())},aa.prototype.removeEntry=function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)},aa.prototype.getEntry=function(e,t){var n=this.docs.get(t);return vt.resolve(n?n.maybeDocument:null)},aa.prototype.getEntries=function(e,t){var n=this,r=ot();return t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.maybeDocument:null)}),vt.resolve(r)},aa.prototype.getDocumentsMatchingQuery=function(e,t,n){v(!t.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=st(),i=new Ee(t.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.key,u=a.value,c=u.maybeDocument,h=u.readTime;if(!t.path.isPrefixOf(s.path))break;h.compareTo(n)<=0||c instanceof wr&&t.matches(c)&&(r=r.insert(c.key,c))}return vt.resolve(r)},aa.prototype.forEachDocumentKey=function(e,t){return vt.forEach(this.docs,function(e){return t(e)})},aa.prototype.getNewDocumentChanges=function(e,t){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},aa.prototype.newChangeBuffer=function(e){return new aa.RemoteDocumentChangeBuffer(this)},aa.prototype.getSize=function(e){return vt.resolve(this.size)},aa.RemoteDocumentChangeBuffer=(ia=kr,m.__extends(sa,ia),sa.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(e,t){t?i.push(r.documentCache.addEntry(n,t,r.readTime)):r.documentCache.removeEntry(e)}),vt.waitFor(i)},sa.prototype.getFromCache=function(e,t){return this.documentCache.getEntry(e,t)},sa.prototype.getAllFromCache=function(e,t){return this.documentCache.getEntries(e,t)},sa),aa);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aa(e,t){this.indexManager=e,this.sizer=t,this.docs=new Ge(Ee.comparator),this.size=0}function sa(e){var t=ia.call(this)||this;return t.documentCache=e,t}var ua=(ca.prototype.forEachTarget=function(e,n){return this.targets.forEach(function(e,t){return n(t)}),vt.resolve()},ca.prototype.getLastRemoteSnapshotVersion=function(e){return vt.resolve(this.lastRemoteSnapshotVersion)},ca.prototype.getHighestSequenceNumber=function(e){return vt.resolve(this.highestSequenceNumber)},ca.prototype.allocateTargetId=function(e){var t=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=t,vt.resolve(t)},ca.prototype.setTargetsMetadata=function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),vt.resolve()},ca.prototype.saveTargetData=function(e){this.targets.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)},ca.prototype.addTargetData=function(e,t){return v(!this.targets.has(t.target),"Adding a target that already exists"),this.saveTargetData(t),this.targetCount+=1,vt.resolve()},ca.prototype.updateTargetData=function(e,t){return v(this.targets.has(t.target),"Updating a non-existent target"),this.saveTargetData(t),vt.resolve()},ca.prototype.removeTargetData=function(e,t){return v(0<this.targetCount,"Removing a target from an empty cache"),v(this.targets.has(t.target),"Removing a non-existent target from the cache"),this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),--this.targetCount,vt.resolve()},ca.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.targets.forEach(function(e,t){t.sequenceNumber<=r&&null===i.get(t.targetId)&&(o.targets.delete(e),s.push(o.removeMatchingKeysForTargetId(n,t.targetId)),a++)}),vt.waitFor(s).next(function(){return a})},ca.prototype.getTargetCount=function(e){return vt.resolve(this.targetCount)},ca.prototype.getTargetData=function(e,t){var n=this.targets.get(t)||null;return vt.resolve(n)},ca.prototype.getTargetDataForTarget=function(e,t){return w("Not yet implemented.")},ca.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),vt.waitFor(i)},ca.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),vt.waitFor(i)},ca.prototype.removeMatchingKeysForTargetId=function(e,t){return this.references.removeReferencesForId(t),vt.resolve()},ca.prototype.getMatchingKeysForTargetId=function(e,t){var n=this.references.referencesForId(t);return vt.resolve(n)},ca.prototype.containsKey=function(e,t){return vt.resolve(this.references.containsKey(t))},ca);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ca(e){this.persistence=e,this.targets=new Ar(function(e){return e.canonicalId()}),this.lastRemoteSnapshotVersion=Ke.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Jo,this.targetCount=0,this.targetIdGenerator=jt.forTargetCache()}var ha=(la.createLruPersistence=function(e,t,n){return new la(e,function(e){return new ya(e,new ki(t),n)})},la.createEagerPersistence=function(e){return new la(e,function(e){return new ma(e)})},la.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(la.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),la.prototype.getActiveClients=function(){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){return[2,[this.clientId]]})})},la.prototype.setPrimaryStateListener=function(e){return e(!0)},la.prototype.setDatabaseDeletedListener=function(){},la.prototype.setNetworkEnabled=function(e){},la.prototype.getIndexManager=function(){return this.indexManager},la.prototype.getMutationQueue=function(e){var t=this.mutationQueues[e.toKey()];return t||(t=new na(this.indexManager,this.referenceDelegate),this.mutationQueues[e.toKey()]=t),t},la.prototype.getTargetCache=function(){return this.targetCache},la.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},la.prototype.runTransaction=function(e,t,n){var r=this;y("MemoryPersistence","Starting transaction:",e);var i=new da(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(e){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return e})}).toPromise().then(function(e){return i.raiseOnCommittedEvent(),e})},la.prototype.mutationQueuesContainKey=function(t,n){return vt.or((e=this.mutationQueues,r=[],M(e,function(e,t){return r.push(t)}),r.map(function(e){return function(){return e.containsKey(t,n)}})));var e,r},la);function la(e,t){var n=this;this.clientId=e,this.mutationQueues={},this.listenSequence=new fe(0),this._started=!1,this._started=!0,this.referenceDelegate=t(this),this.targetCache=new ua(this);this.indexManager=new Br,this.remoteDocumentCache=new oa(this.indexManager,function(e){return n.referenceDelegate.documentSize(e)})}var fa,da=(fa=ji,m.__extends(pa,fa),pa);function pa(e){var t=fa.call(this)||this;return t.currentSequenceNumber=e,t}var ma=(Object.defineProperty(ga.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw w("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),ga.prototype.setInMemoryPins=function(e){this.inMemoryPins=e},ga.prototype.addReference=function(e,t){return this.orphanedDocuments.delete(t),vt.resolve()},ga.prototype.removeReference=function(e,t){return this.orphanedDocuments.add(t),vt.resolve()},ga.prototype.removeMutationReference=function(e,t){return this.orphanedDocuments.add(t),vt.resolve()},ga.prototype.removeTarget=function(e,t){var n=this,r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.orphanedDocuments.add(e)})}).next(function(){return r.removeTargetData(e,t)})},ga.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},ga.prototype.onTransactionCommitted=function(e){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return vt.forEach(this.orphanedDocuments,function(t){return n.isReferenced(e,t).next(function(e){e||r.removeEntry(t)})}).next(function(){return n._orphanedDocuments=null,r.apply(e)})},ga.prototype.updateLimboDocument=function(e,t){var n=this;return this.isReferenced(e,t).next(function(e){e?n.orphanedDocuments.delete(t):n.orphanedDocuments.add(t)})},ga.prototype.documentSize=function(e){return 0},ga.prototype.isReferenced=function(e,t){var n=this;return vt.or([function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.mutationQueuesContainKey(e,t)},function(){return vt.resolve(n.inMemoryPins.containsKey(t))}])},ga);function ga(e){this.persistence=e,this.inMemoryPins=null,this._orphanedDocuments=null}var ya=(va.prototype.onTransactionStarted=function(){},va.prototype.onTransactionCommitted=function(e){return vt.resolve()},va.prototype.forEachTarget=function(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)},va.prototype.getSequenceNumberCount=function(e){var n=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(function(t){return n.next(function(e){return t+e})})},va.prototype.orphanedDocumentCount=function(e){var t=0;return this.forEachOrphanedDocumentSequenceNumber(e,function(e){t++}).next(function(){return t})},va.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return vt.forEach(this.orphanedSequenceNumbers,function(e,t){return i.isPinned(n,e,t).next(function(e){return e?vt.resolve():r(t)})})},va.prototype.setInMemoryPins=function(e){this.inMemoryPins=e},va.prototype.removeTargets=function(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)},va.prototype.removeOrphanedDocuments=function(e,n){var r=this,i=0,t=this.persistence.getRemoteDocumentCache(),o=t.newChangeBuffer();return t.forEachDocumentKey(e,function(t){return r.isPinned(e,t,n).next(function(e){e||(i++,o.removeEntry(t))})}).next(function(){return o.apply(e)}).next(function(){return i})},va.prototype.removeMutationReference=function(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),vt.resolve()},va.prototype.removeTarget=function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)},va.prototype.addReference=function(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),vt.resolve()},va.prototype.removeReference=function(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),vt.resolve()},va.prototype.updateLimboDocument=function(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),vt.resolve()},va.prototype.documentSize=function(e){var t,n=this.serializer.toDbRemoteDocument(e,e.version);if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw w("Unknown remote document type");t=n.noDocument}return JSON.stringify(t).length},va.prototype.isPinned=function(e,t,n){var r=this;return vt.or([function(){return r.persistence.mutationQueuesContainKey(e,t)},function(){return vt.resolve(r.inMemoryPins.containsKey(t))},function(){return r.persistence.getTargetCache().containsKey(e,t)},function(){var e=r.orphanedSequenceNumbers.get(t);return vt.resolve(void 0!==e&&n<e)}])},va.prototype.getCacheSize=function(e){return this.persistence.getRemoteDocumentCache().getSize(e)},va);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function va(e,t,n){this.persistence=e,this.serializer=t,this.inMemoryPins=null,this.orphanedSequenceNumbers=new Ar(function(e){return Fe(e.path)}),this.garbageCollector=new Bi(this,n)}var ba=(wa.prototype.reset=function(){this.currentBaseMs=0},wa.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},wa.prototype.backoffAndRun=function(e){var t=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&y("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return t.lastAttemptTime=Date.now(),e()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},wa.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},wa.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},wa);function wa(e,t,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=e,this.timerId=t,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ta,Sa,_a="PersistentStream";(Sa=Ta=Ta||{})[Sa.Initial=0]="Initial",Sa[Sa.Starting=1]="Starting",Sa[Sa.Open=2]="Open",Sa[Sa.Error=3]="Error",Sa[Sa.Backoff=4]="Backoff";var Ea=(Ia.prototype.isStarted=function(){return this.state===Ta.Starting||this.state===Ta.Open||this.state===Ta.Backoff},Ia.prototype.isOpen=function(){return this.state===Ta.Open},Ia.prototype.start=function(){this.state!==Ta.Error?(v(this.state===Ta.Initial,"Already started"),this.auth()):this.performBackoff()},Ia.prototype.stop=function(){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return this.isStarted()?[4,this.close(Ta.Initial)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Ia.prototype.inhibitBackoff=function(){v(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=Ta.Initial,this.backoff.reset()},Ia.prototype.markIdle=function(){var e=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return e.handleIdleCloseTimer()}))},Ia.prototype.sendRequest=function(e){this.cancelIdleCheck(),this.stream.send(e)},Ia.prototype.handleIdleCloseTimer=function(){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){return this.isOpen()?[2,this.close(Ta.Initial)]:[2]})})},Ia.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},Ia.prototype.close=function(t,n){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return v(this.isStarted(),"Only started streams should be closed."),v(t===Ta.Error||uo(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==Ta.Error?this.backoff.reset():n&&n.code===E.RESOURCE_EXHAUSTED?(c(n.toString()),c("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===E.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(n)];case 1:return e.sent(),[2]}})})},Ia.prototype.tearDown=function(){},Ia.prototype.auth=function(){var n=this;v(this.state===Ta.Initial,"Must be in initial state to auth"),this.state=Ta.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;this.credentialsProvider.getToken().then(function(e){n.closeCount===t&&n.startStream(e)},function(t){e(function(){var e=new I(E.UNKNOWN,"Fetching auth token failed: "+t.message);return n.handleStreamClose(e)})})},Ia.prototype.startStream=function(e){var t=this;v(this.state===Ta.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e),this.stream.onOpen(function(){n(function(){return v(t.state===Ta.Starting,"Expected stream to be in state Starting, but was "+t.state),t.state=Ta.Open,t.listener.onOpen()})}),this.stream.onClose(function(e){n(function(){return t.handleStreamClose(e)})}),this.stream.onMessage(function(e){n(function(){return t.onMessage(e)})})},Ia.prototype.performBackoff=function(){var e=this;v(this.state===Ta.Error,"Should only perform backoff when in Error state"),this.state=Ta.Backoff,this.backoff.backoffAndRun(function(){return m.__awaiter(e,void 0,void 0,function(){return m.__generator(this,function(e){return v(this.state===Ta.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=Ta.Initial,this.start(),v(this.isStarted(),"PersistentStream should have started"),[2]})})})},Ia.prototype.handleStreamClose=function(e){return v(this.isStarted(),"Can't handle server close on non-started stream"),y(_a,"close with error: "+e),this.stream=null,this.close(Ta.Error,e)},Ia.prototype.getCloseGuardedDispatcher=function(t){var n=this;return function(e){n.queue.enqueueAndForget(function(){return n.closeCount===t?e():(y(_a,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Ia);function Ia(e,t,n,r,i,o){this.queue=e,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=Ta.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new ba(e,t)}var Ca,Da=(Ca=Ea,m.__extends(Aa,Ca),Aa.prototype.startRpc=function(e){return this.connection.openStream("Listen",e)},Aa.prototype.onMessage=function(e){this.backoff.reset();var t=this.serializer.fromWatchChange(e),n=this.serializer.versionFromListenResponse(e);return this.listener.onWatchChange(t,n)},Aa.prototype.watch=function(e){var t={};t.database=this.serializer.encodedDatabaseId,t.addTarget=this.serializer.toTarget(e);var n=this.serializer.toListenRequestLabels(e);n&&(t.labels=n),this.sendRequest(t)},Aa.prototype.unwatch=function(e){var t={};t.database=this.serializer.encodedDatabaseId,t.removeTarget=e,this.sendRequest(t)},Aa);function Aa(e,t,n,r,i){var o=Ca.call(this,e,Ce.ListenStreamConnectionBackoff,Ce.ListenStreamIdle,t,n,i)||this;return o.serializer=r,o}var Na,ka=(Na=Ea,m.__extends(Ma,Na),Object.defineProperty(Ma.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),Ma.prototype.start=function(){this.handshakeComplete_=!1,Na.prototype.start.call(this)},Ma.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},Ma.prototype.startRpc=function(e){return this.connection.openStream("Write",e)},Ma.prototype.onMessage=function(e){if(v(!!e.streamToken,"Got a write response without a stream token"),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();var t=this.serializer.fromWriteResults(e.writeResults,e.commitTime),n=this.serializer.fromVersion(e.commitTime);return this.listener.onMutationResult(n,t)}return v(!e.writeResults||0===e.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},Ma.prototype.writeHandshake=function(){v(this.isOpen(),"Writing handshake requires an opened stream"),v(!this.handshakeComplete_,"Handshake already completed");var e={};e.database=this.serializer.encodedDatabaseId,this.sendRequest(e)},Ma.prototype.writeMutations=function(e){var t=this;v(this.isOpen(),"Writing mutations requires an opened stream"),v(this.handshakeComplete_,"Handshake must be complete before writing mutations"),v(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:e.map(function(e){return t.serializer.toMutation(e)})};this.sendRequest(n)},Ma);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ma(e,t,n,r,i){var o=Na.call(this,e,Ce.WriteStreamConnectionBackoff,Ce.WriteStreamIdle,t,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=S(),o}var Ra=(Oa.prototype.newPersistentWriteStream=function(e){return new ka(this.queue,this.connection,this.credentials,this.serializer,e)},Oa.prototype.newPersistentWatchStream=function(e){return new Da(this.queue,this.connection,this.credentials,this.serializer,e)},Oa.prototype.commit=function(e){var t=this,n={database:this.serializer.encodedDatabaseId,writes:e.map(function(e){return t.serializer.toMutation(e)})};return this.invokeRPC("Commit",n).then(function(e){return t.serializer.fromWriteResults(e.writeResults,e.commitTime)})},Oa.prototype.lookup=function(t){var i=this,e={database:this.serializer.encodedDatabaseId,documents:t.map(function(e){return i.serializer.toName(e)})};return this.invokeStreamingRPC("BatchGetDocuments",e).then(function(e){var n=it();e.forEach(function(e){var t=i.serializer.fromMaybeDocument(e);n=n.insert(t.key,t)});var r=[];return t.forEach(function(e){var t=n.get(e);v(!!t,"Missing entity in write response for "+e),r.push(t)}),r})},Oa.prototype.invokeRPC=function(t,n){var r=this;return this.credentials.getToken().then(function(e){return r.connection.invokeRPC(t,n,e)}).catch(function(e){throw e.code===E.UNAUTHENTICATED&&r.credentials.invalidateToken(),e})},Oa.prototype.invokeStreamingRPC=function(t,n){var r=this;return this.credentials.getToken().then(function(e){return r.connection.invokeStreamingRPC(t,n,e)}).catch(function(e){throw e.code===E.UNAUTHENTICATED&&r.credentials.invalidateToken(),e})},Oa);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oa(e,t,n,r){this.queue=e,this.connection=t,this.credentials=n,this.serializer=r}var La,Pa,xa,Fa,qa=(Va.prototype.lookup=function(r){return m.__awaiter(this,void 0,void 0,function(){var t,n=this;return m.__generator(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new I(E.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(r)];case 1:return(t=e.sent()).forEach(function(e){e instanceof _r||e instanceof wr?n.recordVersion(e):w("Document in a transaction was a "+e.constructor.name)}),[2,t]}})})},Va.prototype.set=function(e,t){this.write(t.toMutations(e,this.precondition(e))),this.writtenDocs.add(e)},Va.prototype.update=function(e,t){try{this.write(t.toMutations(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e)},Va.prototype.delete=function(e){this.write([new vn(e,this.precondition(e))]),this.writtenDocs.add(e)},Va.prototype.commit=function(){return m.__awaiter(this,void 0,void 0,function(){var t,n=this;return m.__generator(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t=t.remove(e.key)}),t.forEach(function(e,t){n.mutations.push(new In(e,n.precondition(e)))}),[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}})})},Va.prototype.recordVersion=function(e){var t;if(e instanceof wr)t=e.version;else{if(!(e instanceof _r))throw w("Document in a transaction was a "+e.constructor.name);t=Ke.forDeletedDoc()}var n=this.readVersions.get(e.key);if(null!==n){if(!t.isEqual(n))throw new I(E.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(e.key,t)},Va.prototype.precondition=function(e){var t=this.readVersions.get(e);return!this.writtenDocs.has(e)&&t?rn.updateTime(t):rn.NONE},Va.prototype.preconditionForUpdate=function(e){var t=this.readVersions.get(e);if(this.writtenDocs.has(e)||!t)return rn.exists(!0);if(t.isEqual(Ke.forDeletedDoc()))throw new I(E.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rn.updateTime(t)},Va.prototype.write=function(e){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(e)},Va.prototype.ensureCommitNotCalled=function(){v(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},Va);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Va(e){this.datastore=e,this.readVersions=ct(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(Pa=La=La||{})[Pa.Unknown=0]="Unknown",Pa[Pa.Online=1]="Online",Pa[Pa.Offline=2]="Offline",(Fa=xa=xa||{})[Fa.RemoteStore=0]="RemoteStore",Fa[Fa.SharedClientState=1]="SharedClientState";
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ba,Ua,ja=(Ka.prototype.handleWatchStreamStart=function(){var e=this;0===this.watchStreamFailures&&(this.setAndBroadcast(La.Unknown),v(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Ce.OnlineStateTimeout,1e4,function(){return e.onlineStateTimer=null,v(e.state===La.Unknown,"Timer should be canceled if we transitioned to a different state."),e.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),e.setAndBroadcast(La.Offline),Promise.resolve()}))},Ka.prototype.handleWatchStreamFailure=function(e){this.state===La.Online?(this.setAndBroadcast(La.Unknown),v(0===this.watchStreamFailures,"watchStreamFailures must be 0"),v(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+e.toString()),this.setAndBroadcast(La.Offline)))},Ka.prototype.set=function(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e===La.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)},Ka.prototype.setAndBroadcast=function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))},Ka.prototype.logClientOfflineWarningIfNecessary=function(e){var t="Could not reach Cloud Firestore backend. "+e+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(c(t),this.shouldWarnClientIsOffline=!1):y("OnlineStateTracker",t)},Ka.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},Ka);function Ka(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state=La.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function Wa(e){switch(e){case E.OK:return w("Treated status OK as error");case E.CANCELLED:case E.UNKNOWN:case E.DEADLINE_EXCEEDED:case E.RESOURCE_EXHAUSTED:case E.INTERNAL:case E.UNAVAILABLE:case E.UNAUTHENTICATED:return!1;case E.INVALID_ARGUMENT:case E.NOT_FOUND:case E.ALREADY_EXISTS:case E.PERMISSION_DENIED:case E.FAILED_PRECONDITION:case E.ABORTED:case E.OUT_OF_RANGE:case E.UNIMPLEMENTED:case E.DATA_LOSS:return!0;default:return w("Unknown status code: "+e)}}function Ga(e){if(void 0===e)return c("GRPC error has no .code"),E.UNKNOWN;switch(e){case Ba.OK:return E.OK;case Ba.CANCELLED:return E.CANCELLED;case Ba.UNKNOWN:return E.UNKNOWN;case Ba.DEADLINE_EXCEEDED:return E.DEADLINE_EXCEEDED;case Ba.RESOURCE_EXHAUSTED:return E.RESOURCE_EXHAUSTED;case Ba.INTERNAL:return E.INTERNAL;case Ba.UNAVAILABLE:return E.UNAVAILABLE;case Ba.UNAUTHENTICATED:return E.UNAUTHENTICATED;case Ba.INVALID_ARGUMENT:return E.INVALID_ARGUMENT;case Ba.NOT_FOUND:return E.NOT_FOUND;case Ba.ALREADY_EXISTS:return E.ALREADY_EXISTS;case Ba.PERMISSION_DENIED:return E.PERMISSION_DENIED;case Ba.FAILED_PRECONDITION:return E.FAILED_PRECONDITION;case Ba.ABORTED:return E.ABORTED;case Ba.OUT_OF_RANGE:return E.OUT_OF_RANGE;case Ba.UNIMPLEMENTED:return E.UNIMPLEMENTED;case Ba.DATA_LOSS:return E.DATA_LOSS;default:return w("Unknown status code: "+e)}}(Ua=Ba=Ba||{})[Ua.OK=0]="OK",Ua[Ua.CANCELLED=1]="CANCELLED",Ua[Ua.UNKNOWN=2]="UNKNOWN",Ua[Ua.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ua[Ua.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ua[Ua.NOT_FOUND=5]="NOT_FOUND",Ua[Ua.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ua[Ua.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ua[Ua.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ua[Ua.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ua[Ua.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ua[Ua.ABORTED=10]="ABORTED",Ua[Ua.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ua[Ua.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ua[Ua.INTERNAL=13]="INTERNAL",Ua[Ua.UNAVAILABLE=14]="UNAVAILABLE",Ua[Ua.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qa,za,Ha,Ya,Ja=(Xa.emptySet=function(e){return new Xa(e.comparator)},Xa.prototype.has=function(e){return null!=this.keyedMap.get(e)},Xa.prototype.get=function(e){return this.keyedMap.get(e)},Xa.prototype.first=function(){return this.sortedSet.minKey()},Xa.prototype.last=function(){return this.sortedSet.maxKey()},Xa.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},Xa.prototype.indexOf=function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1},Object.defineProperty(Xa.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),Xa.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(e,t){return n(e),!1})},Xa.prototype.add=function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))},Xa.prototype.delete=function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this},Xa.prototype.isEqual=function(e){if(!(e instanceof Xa))return!1;if(this.size!==e.size)return!1;for(var t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();t.hasNext();){var r=t.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},Xa.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},Xa.prototype.copy=function(e,t){var n=new Xa;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n},Xa);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xa(n){this.comparator=n?function(e,t){return n(e,t)||Ee.comparator(e.key,t.key)}:function(e,t){return Ee.comparator(e.key,t.key)},this.keyedMap=st(),this.sortedSet=new Ge(this.comparator)}(za=Qa=Qa||{})[za.Added=0]="Added",za[za.Removed=1]="Removed",za[za.Modified=2]="Modified",za[za.Metadata=3]="Metadata",(Ya=Ha=Ha||{})[Ya.Local=0]="Local",Ya[Ya.Synced=1]="Synced";var $a=(Za.prototype.track=function(e){var t=e.doc.key,n=this.changeMap.get(t);!n||e.type!==Qa.Added&&n.type===Qa.Metadata?this.changeMap=this.changeMap.insert(t,e):e.type===Qa.Metadata&&n.type!==Qa.Removed?this.changeMap=this.changeMap.insert(t,{type:n.type,doc:e.doc}):e.type===Qa.Modified&&n.type===Qa.Modified?this.changeMap=this.changeMap.insert(t,{type:Qa.Modified,doc:e.doc}):e.type===Qa.Modified&&n.type===Qa.Added?this.changeMap=this.changeMap.insert(t,{type:Qa.Added,doc:e.doc}):e.type===Qa.Removed&&n.type===Qa.Added?this.changeMap=this.changeMap.remove(t):e.type===Qa.Removed&&n.type===Qa.Modified?this.changeMap=this.changeMap.insert(t,{type:Qa.Removed,doc:n.doc}):e.type===Qa.Added&&n.type===Qa.Removed?this.changeMap=this.changeMap.insert(t,{type:Qa.Modified,doc:e.doc}):w("unsupported combination of changes: "+JSON.stringify(e)+" after "+JSON.stringify(n))},Za.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(e,t){n.push(t)}),n},Za);function Za(){this.changeMap=new Ge(Ee.comparator)}var es=(ts.fromInitialDocuments=function(e,t,n,r){var i=[];return t.forEach(function(e){i.push({type:Qa.Added,doc:e})}),new ts(e,t,Ja.emptySet(t),i,n,r,!0,!1)},Object.defineProperty(ts.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),ts.prototype.isEqual=function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&this.query.isEqual(e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0},ts);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ts(e,t,n,r,i,o,a,s){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var ns=(rs.createSynthesizedRemoteEventForCurrentChange=function(e,t){var n,r=((n={})[e]=is.createSynthesizedTargetChangeForCurrentChange(e,t),n);return new rs(Ke.MIN,r,dt(),it(),lt())},rs);function rs(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var is=(os.createSynthesizedTargetChangeForCurrentChange=function(e,t){return new os(S(),t,lt(),lt(),lt())},os);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function os(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var as,ss,us=function(e,t,n,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=n,this.newDoc=r},cs=function(e,t){this.targetId=e,this.existenceFilter=t};(ss=as=as||{})[ss.NoChange=0]="NoChange",ss[ss.Added=1]="Added",ss[ss.Removed=2]="Removed",ss[ss.Current=3]="Current",ss[ss.Reset=4]="Reset";var hs=function(e,t,n,r){void 0===n&&(n=S()),void 0===r&&(r=null),this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r},ls=(Object.defineProperty(fs.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),fs.prototype.updateResumeToken=function(e){0<e.length&&(this._hasPendingChanges=!0,this._resumeToken=e)},fs.prototype.toTargetChange=function(){var n=lt(),r=lt(),i=lt();return this.documentChanges.forEach(function(e,t){switch(t){case Qa.Added:n=n.add(e);break;case Qa.Modified:r=r.add(e);break;case Qa.Removed:i=i.add(e);break;default:w("Encountered invalid change type: "+t)}}),new is(this._resumeToken,this._current,n,r,i)},fs.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=gs()},fs.prototype.addDocumentChange=function(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)},fs.prototype.removeDocumentChange=function(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)},fs.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},fs.prototype.recordTargetResponse=function(){--this.pendingResponses},fs.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},fs);function fs(){this.pendingResponses=0,this.documentChanges=gs(),this._resumeToken=S(),this._current=!1,this._hasPendingChanges=!0}var ds=(ps.prototype.handleDocumentChange=function(e){for(var t=0,n=e.updatedTargetIds;t<n.length;t++){var r=n[t];e.newDoc instanceof wr?this.addDocumentToTarget(r,e.newDoc):e.newDoc instanceof _r&&this.removeDocumentFromTarget(r,e.key,e.newDoc)}for(var i=0,o=e.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,e.key,e.newDoc)},ps.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(e){var t=r.ensureTargetState(e);switch(n.state){case as.NoChange:r.isActiveTarget(e)&&t.updateResumeToken(n.resumeToken);break;case as.Added:t.recordTargetResponse(),t.isPending||t.clearPendingChanges(),t.updateResumeToken(n.resumeToken);break;case as.Removed:t.recordTargetResponse(),t.isPending||r.removeTarget(e),v(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case as.Current:r.isActiveTarget(e)&&(t.markCurrent(),t.updateResumeToken(n.resumeToken));break;case as.Reset:r.isActiveTarget(e)&&(r.resetTarget(e),t.updateResumeToken(n.resumeToken));break;default:w("Unknown target watch change state: "+n.state)}})},ps.prototype.forEachTarget=function(e,t){0<e.targetIds.length?e.targetIds.forEach(t):k(this.targetStates,t)},ps.prototype.handleExistenceFilter=function(e){var t=e.targetId,n=e.existenceFilter.count,r=this.targetDataForActiveTarget(t);if(r){var i=r.target;if(i.isDocumentQuery())if(0===n){var o=new Ee(i.path);this.removeDocumentFromTarget(t,o,new _r(o,Ke.forDeletedDoc()))}else v(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(t)!==n&&(this.resetTarget(t),this.pendingTargetResets=this.pendingTargetResets.add(t))}},ps.prototype.createRemoteEvent=function(i){var o=this,a={};k(this.targetStates,function(e,t){var n=o.targetDataForActiveTarget(e);if(n){if(t.current&&n.target.isDocumentQuery()){var r=new Ee(n.target.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(e,r)||o.removeDocumentFromTarget(e,r,new _r(r,i))}t.hasPendingChanges&&(a[e]=t.toTargetChange(),t.clearPendingChanges())}});var r=lt();this.pendingDocumentTargetMapping.forEach(function(e,t){var n=!0;t.forEachWhile(function(e){var t=o.targetDataForActiveTarget(e);return!t||t.purpose===bi.LimboResolution||(n=!1)}),n&&(r=r.add(e))});var e=new ns(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=it(),this.pendingDocumentTargetMapping=ms(),this.pendingTargetResets=new Ze(ee),e},ps.prototype.addDocumentToTarget=function(e,t){if(this.isActiveTarget(e)){var n=this.targetContainsDocument(e,t.key)?Qa.Modified:Qa.Added;this.ensureTargetState(e).addDocumentChange(t.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}},ps.prototype.removeDocumentFromTarget=function(e,t,n){if(this.isActiveTarget(e)){var r=this.ensureTargetState(e);this.targetContainsDocument(e,t)?r.addDocumentChange(t,Qa.Removed):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,n))}},ps.prototype.removeTarget=function(e){delete this.targetStates[e]},ps.prototype.getCurrentDocumentCountForTarget=function(e){var t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size},ps.prototype.recordPendingTargetRequest=function(e){this.ensureTargetState(e).recordPendingTargetRequest()},ps.prototype.ensureTargetState=function(e){return this.targetStates[e]||(this.targetStates[e]=new ls),this.targetStates[e]},ps.prototype.ensureDocumentTargetMapping=function(e){var t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Ze(ee),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t},ps.prototype.isActiveTarget=function(e){var t=null!==this.targetDataForActiveTarget(e);return t||y("WatchChangeAggregator","Detected inactive target",e),t},ps.prototype.targetDataForActiveTarget=function(e){var t=this.targetStates[e];return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)},ps.prototype.resetTarget=function(t){var n=this;v(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new ls,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(e){n.removeDocumentFromTarget(t,e,null)})},ps.prototype.targetContainsDocument=function(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)},ps);function ps(e){this.metadataProvider=e,this.targetStates={},this.pendingDocumentUpdates=it(),this.pendingDocumentTargetMapping=ms(),this.pendingTargetResets=new Ze(ee)}function ms(){return new Ge(Ee.comparator)}function gs(){return new Ge(Ee.comparator)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ys="RemoteStore",vs=(bs.prototype.start=function(){return this.enableNetwork()},bs.prototype.enableNetwork=function(){return m.__awaiter(this,void 0,void 0,function(){var t;return m.__generator(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(La.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},bs.prototype.disableNetwork=function(){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return e.sent(),this.onlineStateTracker.set(La.Offline),[2]}})})},bs.prototype.disableNetworkInternal=function(){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return[4,this.writeStream.stop()];case 1:return e.sent(),[4,this.watchStream.stop()];case 2:return e.sent(),0<this.writePipeline.length&&(y(ys,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},bs.prototype.shutdown=function(){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return y(ys,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return e.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(La.Unknown),[2]}})})},bs.prototype.listen=function(e){A(this.listenTargets,e.targetId)||(this.listenTargets[e.targetId]=e,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(e))},bs.prototype.unlisten=function(e){v(A(this.listenTargets,e),"unlisten called on target no currently watched: "+e),delete this.listenTargets[e],this.watchStream.isOpen()&&this.sendUnwatchRequest(e),R(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(La.Unknown))},bs.prototype.getTargetDataForTarget=function(e){return this.listenTargets[e]||null},bs.prototype.getRemoteKeysForTarget=function(e){return this.syncEngine.getRemoteKeysForTarget(e)},bs.prototype.sendWatchRequest=function(e){this.watchChangeAggregator.recordPendingTargetRequest(e.targetId),this.watchStream.watch(e)},bs.prototype.sendUnwatchRequest=function(e){this.watchChangeAggregator.recordPendingTargetRequest(e),this.watchStream.unwatch(e)},bs.prototype.startWatchStream=function(){v(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new ds(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},bs.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!R(this.listenTargets)},bs.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},bs.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},bs.prototype.onWatchStreamOpen=function(){return m.__awaiter(this,void 0,void 0,function(){var n=this;return m.__generator(this,function(e){return k(this.listenTargets,function(e,t){n.sendWatchRequest(t)}),[2]})})},bs.prototype.onWatchStreamClose=function(t){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){return void 0===t&&v(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(La.Unknown),[2]})})},bs.prototype.onWatchStreamChange=function(n,r){return m.__awaiter(this,void 0,void 0,function(){var t;return m.__generator(this,function(e){switch(e.label){case 0:return this.onlineStateTracker.set(La.Online),n instanceof hs&&n.state===as.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof us?this.watchChangeAggregator.handleDocumentChange(n):n instanceof cs?this.watchChangeAggregator.handleExistenceFilter(n):(v(n instanceof hs,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(Ke.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return t=e.sent(),0<=r.compareTo(t)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},bs.prototype.raiseWatchSnapshot=function(r){var i=this;v(!r.isEqual(Ke.MIN),"Can't raise event for unknown SnapshotVersion");var e=this.watchChangeAggregator.createRemoteEvent(r);return k(e.targetChanges,function(e,t){if(0<t.resumeToken.length){var n=i.listenTargets[e];n&&(i.listenTargets[e]=n.withResumeToken(t.resumeToken,r))}}),e.targetMismatches.forEach(function(e){var t=i.listenTargets[e];if(t){i.listenTargets[e]=t.withResumeToken(S(),t.snapshotVersion),i.sendUnwatchRequest(e);var n=new Ai(t.target,e,bi.ExistenceFilterMismatch,t.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(e)},bs.prototype.handleTargetError=function(e){var n=this;v(!!e.cause,"Handling target error without a cause");var r=e.cause,i=Promise.resolve();return e.targetIds.forEach(function(t){i=i.then(function(){return m.__awaiter(n,void 0,void 0,function(){return m.__generator(this,function(e){return A(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,r)]):[2]})})})}),i},bs.prototype.fillWritePipeline=function(){return m.__awaiter(this,void 0,void 0,function(){var t,n;return m.__generator(this,function(e){switch(e.label){case 0:return this.canAddToWritePipeline()?(t=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(n=e.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:e.sent(),e.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},bs.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},bs.prototype.outstandingWrites=function(){return this.writePipeline.length},bs.prototype.addToWritePipeline=function(e){v(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(e),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(e.mutations)},bs.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},bs.prototype.startWriteStream=function(){v(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},bs.prototype.onWriteStreamOpen=function(){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){return this.writeStream.writeHandshake(),[2]})})},bs.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,t=r.writePipeline;e<t.length;e++){var n=t[e];r.writeStream.writeMutations(n.mutations)}}).catch($i)},bs.prototype.onMutationResult=function(e,t){var n=this;v(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=gt.from(r,e,t,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},bs.prototype.onWriteStreamClose=function(n){return m.__awaiter(this,void 0,void 0,function(){var t=this;return m.__generator(this,function(e){return void 0===n&&v(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){t.shouldStartWriteStream()&&t.startWriteStream()})]:[2]})})},bs.prototype.handleHandshakeError=function(t){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){return Wa(t.code)?(y(ys,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=S(),[2,this.localStore.setLastStreamToken(S()).catch($i)]):[2]})})},bs.prototype.handleWriteError=function(i){return m.__awaiter(this,void 0,void 0,function(){var n,r=this;return m.__generator(this,function(e){return Wa(t=i.code)&&t!==E.ABORTED?(n=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(n.batchId,i).then(function(){return r.fillWritePipeline()})]):[2];var t})})},bs.prototype.createTransaction=function(){return new qa(this.datastore)},bs.prototype.restartNetwork=function(){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return e.sent(),this.onlineStateTracker.set(La.Unknown),[4,this.enableNetwork()];case 2:return e.sent(),[2]}})})},bs.prototype.handleCredentialChange=function(){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return this.canUseNetwork()?(y(ys,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},bs.prototype.applyPrimaryState=function(t){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return(this.isPrimary=t)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(La.Unknown),e.label=4;case 4:return[2]}})})},bs);function bs(e,t,n,r,i){var o=this;this.localStore=e,this.datastore=t,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(e){n.enqueueAndForget(function(){return m.__awaiter(o,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return this.canUseNetwork()?(y(ys,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new ja(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ws=(Object.defineProperty(Ts.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(Ts.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),Ts.prototype.isEqual=function(e){return this._lat===e._lat&&this._long===e._long},Ts.prototype._compareTo=function(e){return ee(this._lat,e._lat)||ee(this._long,e._long)},Ts);
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ts(e,t){if(L("GeoPoint",arguments,2),F("GeoPoint","number",1,e),F("GeoPoint","number",2,t),!isFinite(e)||e<-90||90<e)throw new I(E.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new I(E.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}var Ss=(_s.prototype.applyToLocalView=function(e,t){return new er(t,e)},_s.prototype.applyToRemoteDocument=function(e,t){return t},_s.prototype.computeBaseValue=function(e){return null},_s.prototype.isEqual=function(e){return e instanceof _s},_s.instance=new _s,_s);function _s(){}var Es=(Is.prototype.applyToLocalView=function(e,t){return this.apply(e)},Is.prototype.applyToRemoteDocument=function(e,t){return this.apply(e)},Is.prototype.apply=function(e){for(var n=ks(e),t=function(t){n.find(function(e){return e.isEqual(t)})||n.push(t)},r=0,i=this.elements;r<i.length;r++)t(i[r]);return new mr(n)},Is.prototype.computeBaseValue=function(e){return null},Is.prototype.isEqual=function(e){return e instanceof Is&&te(e.elements,this.elements)},Is);function Is(e){this.elements=e}var Cs=(Ds.prototype.applyToLocalView=function(e,t){return this.apply(e)},Ds.prototype.applyToRemoteDocument=function(e,t){return this.apply(e)},Ds.prototype.apply=function(e){for(var n=ks(e),t=function(t){n=n.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++)t(i[r]);return new mr(n)},Ds.prototype.computeBaseValue=function(e){return null},Ds.prototype.isEqual=function(e){return e instanceof Ds&&te(e.elements,this.elements)},Ds);function Ds(e){this.elements=e}var As=(Ns.prototype.applyToLocalView=function(e,t){var n=this.computeBaseValue(e);if(n instanceof jn&&this.operand instanceof jn){var r=n.internalValue+this.operand.internalValue;return new jn(r)}return r=n.internalValue+this.operand.internalValue,new Gn(r)},Ns.prototype.applyToRemoteDocument=function(e,t){return v(null!==t,"Didn't receive transformResult for NUMERIC_ADD transform"),t},Ns.prototype.computeBaseValue=function(e){return e instanceof qn?e:new jn(0)},Ns.prototype.isEqual=function(e){return e instanceof Ns&&this.operand.isEqual(e.operand)},Ns);function Ns(e){this.operand=e}function ks(e){return e instanceof mr?e.internalValue.slice():[]}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ms=(Rs.prototype.isEqual=function(e){return e&&e.count===this.count},Rs);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rs(e){this.count=e}var Os,Ls,Ps=((Os={})[qo.ASCENDING.name]="ASCENDING",Os[qo.DESCENDING.name]="DESCENDING",Os),xs=((Ls={})[vo.LESS_THAN.name]="LESS_THAN",Ls[vo.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",Ls[vo.GREATER_THAN.name]="GREATER_THAN",Ls[vo.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",Ls[vo.EQUAL.name]="EQUAL",Ls[vo.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",Ls[vo.IN.name]="IN",Ls[vo.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",Ls),Fs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qs(e,t){v(!uo(e),t+" is missing")}function Vs(e){return"number"==typeof e?e:"string"==typeof e?Number(e):w("can't parse "+e)}var Bs=(Us.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},Us.prototype.unsafeCastProtoByteString=function(e){return e},Us.prototype.fromRpcStatus=function(e){var t=void 0===e.code?E.UNKNOWN:Ga(e.code);return new I(t,e.message||"")},Us.prototype.toInt32Value=function(e){return this.options.useProto3Json||uo(e)?e:{value:e}},Us.prototype.fromInt32Value=function(e){var t;return uo(t="object"===(void 0===e?"undefined":l(e))?e.value:e)?null:t},Us.prototype.toTimestamp=function(e){return this.options.useProto3Json?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}},Us.prototype.fromTimestamp=function(e){if("string"==typeof e)return this.fromIso8601String(e);v(!!e,"Cannot deserialize null or undefined timestamp.");var t=Vs(e.seconds||"0"),n=e.nanos||0;return new Ue(t,n)},Us.prototype.fromIso8601String=function(e){var t=0,n=Fs.exec(e);if(v(!!n,"invalid timestamp: "+e),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e),o=Math.floor(i.getTime()/1e3);return new Ue(o,t)},Us.prototype.toBytes=function(e){return this.options.useProto3Json?e.toBase64():this.unsafeCastProtoByteString(e.toUint8Array())},Us.prototype.fromBlob=function(e){return"string"==typeof e?(v(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),oe.fromBase64String(e)):(v(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),oe.fromUint8Array(e))},Us.prototype.toVersion=function(e){return this.toTimestamp(e.toTimestamp())},Us.prototype.fromVersion=function(e){return v(!!e,"Trying to deserialize version that isn't set"),Ke.fromTimestamp(this.fromTimestamp(e))},Us.prototype.toResourceName=function(e,t){return this.fullyQualifiedPrefixPath(e).child("documents").child(t).canonicalString()},Us.prototype.fromResourceName=function(e){var t=ve.fromString(e);return v(this.isValidResourceName(t),"Tried to deserialize invalid key "+t.toString()),t},Us.prototype.toName=function(e){return this.toResourceName(this.databaseId,e.path)},Us.prototype.fromName=function(e){var t=this.fromResourceName(e);return v(t.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+t.get(1)+" vs "+this.databaseId.projectId),v(!t.get(3)&&!this.databaseId.database||t.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+t.get(3)+" vs "+this.databaseId.database),new Ee(this.extractLocalPathFromResourceName(t))},Us.prototype.toQueryPath=function(e){return this.toResourceName(this.databaseId,e)},Us.prototype.fromQueryPath=function(e){var t=this.fromResourceName(e);return 4===t.length?ve.EMPTY_PATH:this.extractLocalPathFromResourceName(t)},Object.defineProperty(Us.prototype,"encodedDatabaseId",{get:function(){return new ve(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),Us.prototype.fullyQualifiedPrefixPath=function(e){return new ve(["projects",e.projectId,"databases",e.database])},Us.prototype.extractLocalPathFromResourceName=function(e){return v(4<e.length&&"documents"===e.get(4),"tried to deserialize invalid key "+e.toString()),e.popFirst(5)},Us.prototype.isValidResourceName=function(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)},Us.prototype.toValue=function(e){if(e instanceof Rn)return{nullValue:"NULL_VALUE"};if(e instanceof Pn)return{booleanValue:e.value()};if(e instanceof jn)return{integerValue:""+e.value()};if(e instanceof Gn){var t=e.value();if(this.options.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:e.value()}}return e instanceof Hn?{stringValue:e.value()}:e instanceof fr?{mapValue:this.toMapValue(e)}:e instanceof mr?{arrayValue:this.toArrayValue(e)}:e instanceof Xn?{timestampValue:this.toTimestamp(e.internalValue)}:e instanceof cr?{geoPointValue:{latitude:e.value().latitude,longitude:e.value().longitude}}:e instanceof rr?{bytesValue:this.toBytes(e.value())}:e instanceof ar?{referenceValue:this.toResourceName(e.databaseId,e.key.path)}:w("Unknown FieldValue "+JSON.stringify(e))},Us.prototype.fromValue=function(e){var t=this;if("nullValue"in e)return Rn.INSTANCE;if("booleanValue"in e)return Pn.of(e.booleanValue);if("integerValue"in e)return new jn(Vs(e.integerValue));if("doubleValue"in e){if(this.options.useProto3Json){if("NaN"===e.doubleValue)return Gn.NAN;if("Infinity"===e.doubleValue)return Gn.POSITIVE_INFINITY;if("-Infinity"===e.doubleValue)return Gn.NEGATIVE_INFINITY}return new Gn(e.doubleValue)}if("stringValue"in e)return new Hn(e.stringValue);if("mapValue"in e)return this.fromFields(e.mapValue.fields||{});if("arrayValue"in e){qs(e.arrayValue,"arrayValue");var n=e.arrayValue.values||[];return new mr(n.map(function(e){return t.fromValue(e)}))}if("timestampValue"in e)return qs(e.timestampValue,"timestampValue"),new Xn(this.fromTimestamp(e.timestampValue));if("geoPointValue"in e){qs(e.geoPointValue,"geoPointValue");var r=e.geoPointValue.latitude||0,i=e.geoPointValue.longitude||0;return new cr(new ws(r,i))}if("bytesValue"in e){qs(e.bytesValue,"bytesValue");var o=this.fromBlob(e.bytesValue);return new rr(o)}if("referenceValue"in e){qs(e.referenceValue,"referenceValue");var a=this.fromResourceName(e.referenceValue),s=new he(a.get(1),a.get(3)),u=new Ee(this.extractLocalPathFromResourceName(a));return new ar(s,u)}return w("Unknown Value proto "+JSON.stringify(e))},Us.prototype.toMutationDocument=function(e,t){return{name:this.toName(e),fields:this.toFields(t)}},Us.prototype.toDocument=function(e){return v(!e.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toTimestamp(e.version.toTimestamp())}},Us.prototype.fromDocument=function(e,t){var n=this,r=this.fromName(e.name),i=this.fromVersion(e.updateTime);return new wr(r,i,{hasCommittedMutations:!!t},void 0,e,function(e){return n.fromValue(e)})},Us.prototype.toFields=function(e){var n=this,r={};return e.forEach(function(e,t){r[e]=n.toValue(t)}),r},Us.prototype.fromFields=function(e){var n=this,t=e,r=fr.EMPTY;return M(t,function(e,t){r=r.set(new Se([e]),n.fromValue(t))}),r},Us.prototype.toMapValue=function(e){return{fields:this.toFields(e)}},Us.prototype.toArrayValue=function(e){var t=this,n=[];return e.forEach(function(e){n.push(t.toValue(e))}),{values:n}},Us.prototype.fromFound=function(e){var t=this;v(!!e.found,"Tried to deserialize a found document from a missing document."),qs(e.found.name,"doc.found.name"),qs(e.found.updateTime,"doc.found.updateTime");var n=this.fromName(e.found.name),r=this.fromVersion(e.found.updateTime);return new wr(n,r,{},void 0,e.found,function(e){return t.fromValue(e)})},Us.prototype.fromMissing=function(e){v(!!e.missing,"Tried to deserialize a missing document from a found document."),v(!!e.readTime,"Tried to deserialize a missing document without a read time.");var t=this.fromName(e.missing),n=this.fromVersion(e.readTime);return new _r(t,n)},Us.prototype.fromMaybeDocument=function(e){return"found"in e?this.fromFound(e):"missing"in e?this.fromMissing(e):w("invalid batch get response: "+JSON.stringify(e))},Us.prototype.toWatchTargetChangeState=function(e){switch(e){case as.Added:return"ADD";case as.Current:return"CURRENT";case as.NoChange:return"NO_CHANGE";case as.Removed:return"REMOVE";case as.Reset:return"RESET";default:return w("Unknown WatchTargetChangeState: "+e)}},Us.prototype.toTestWatchChange=function(e){if(e instanceof cs)return{filter:{count:e.existenceFilter.count,targetId:e.targetId}};if(e instanceof us){if(e.newDoc instanceof wr){var t=e.newDoc;return{documentChange:{document:{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toVersion(t.version)},targetIds:e.updatedTargetIds,removedTargetIds:e.removedTargetIds}}}if(e.newDoc instanceof _r)return t=e.newDoc,{documentDelete:{document:this.toName(t.key),readTime:this.toVersion(t.version),removedTargetIds:e.removedTargetIds}};if(null===e.newDoc)return{documentRemove:{document:this.toName(e.key),removedTargetIds:e.removedTargetIds}}}if(e instanceof hs){var n=void 0;return e.cause&&(n={code:function(e){if(void 0===e)return Ba.OK;switch(e){case E.OK:return Ba.OK;case E.CANCELLED:return Ba.CANCELLED;case E.UNKNOWN:return Ba.UNKNOWN;case E.DEADLINE_EXCEEDED:return Ba.DEADLINE_EXCEEDED;case E.RESOURCE_EXHAUSTED:return Ba.RESOURCE_EXHAUSTED;case E.INTERNAL:return Ba.INTERNAL;case E.UNAVAILABLE:return Ba.UNAVAILABLE;case E.UNAUTHENTICATED:return Ba.UNAUTHENTICATED;case E.INVALID_ARGUMENT:return Ba.INVALID_ARGUMENT;case E.NOT_FOUND:return Ba.NOT_FOUND;case E.ALREADY_EXISTS:return Ba.ALREADY_EXISTS;case E.PERMISSION_DENIED:return Ba.PERMISSION_DENIED;case E.FAILED_PRECONDITION:return Ba.FAILED_PRECONDITION;case E.ABORTED:return Ba.ABORTED;case E.OUT_OF_RANGE:return Ba.OUT_OF_RANGE;case E.UNIMPLEMENTED:return Ba.UNIMPLEMENTED;case E.DATA_LOSS:return Ba.DATA_LOSS;default:return w("Unknown status code: "+e)}}(e.cause.code),message:e.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(e.state),targetIds:e.targetIds,resumeToken:this.unsafeCastProtoByteString(e.resumeToken),cause:n}}}return w("Unrecognized watch change: "+JSON.stringify(e))},Us.prototype.fromWatchChange=function(e){var t,n=this;if("targetChange"in e){qs(e.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=e.targetChange.resumeToken||this.emptyByteString(),a=e.targetChange.cause,s=a&&this.fromRpcStatus(a);t=new hs(r,i,o,s||null)}else if("documentChange"in e){qs(e.documentChange,"documentChange");var u=e.documentChange;qs(u.document,"documentChange.name"),qs(u.document.name,"documentChange.document.name"),qs(u.document.updateTime,"documentChange.document.updateTime");var c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new wr(c,h,{},void 0,u.document,function(e){return n.fromValue(e)}),f=u.targetIds||[],d=u.removedTargetIds||[];t=new us(f,d,l.key,l)}else if("documentDelete"in e){qs(e.documentDelete,"documentDelete");var p=e.documentDelete;qs(p.document,"documentDelete.document"),c=this.fromName(p.document),h=p.readTime?this.fromVersion(p.readTime):Ke.forDeletedDoc(),l=new _r(c,h),d=p.removedTargetIds||[],t=new us([],d,l.key,l)}else if("documentRemove"in e){qs(e.documentRemove,"documentRemove");var m=e.documentRemove;qs(m.document,"documentRemove"),c=this.fromName(m.document),d=m.removedTargetIds||[],t=new us([],d,c,null)}else{if(!("filter"in e))return w("Unknown change type "+JSON.stringify(e));qs(e.filter,"filter");var g=e.filter;qs(g.targetId,"filter.targetId");var y=g.count||0,v=new Ms(y),b=g.targetId;t=new cs(b,v)}return t},Us.prototype.fromWatchTargetChangeState=function(e){return"NO_CHANGE"===e?as.NoChange:"ADD"===e?as.Added:"REMOVE"===e?as.Removed:"CURRENT"===e?as.Current:"RESET"===e?as.Reset:w("Got unexpected TargetChange.state: "+e)},Us.prototype.versionFromListenResponse=function(e){if(!("targetChange"in e))return Ke.MIN;var t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?Ke.MIN:this.fromVersion(t.readTime)},Us.prototype.toMutation=function(e){var t,n=this;if(e instanceof cn)t={update:this.toMutationDocument(e.key,e.value)};else if(e instanceof vn)t={delete:this.toName(e.key)};else if(e instanceof fn)t={update:this.toMutationDocument(e.key,e.data),updateMask:this.toDocumentMask(e.fieldMask)};else if(e instanceof mn)t={transform:{document:this.toName(e.key),fieldTransforms:e.fieldTransforms.map(function(e){return n.toFieldTransform(e)})}};else{if(!(e instanceof In))return w("Unknown mutation type "+e.type);t={verify:this.toName(e.key)}}return e.precondition.isNone||(t.currentDocument=this.toPrecondition(e.precondition)),t},Us.prototype.fromMutation=function(e){var t=this,n=e.currentDocument?this.fromPrecondition(e.currentDocument):rn.NONE;if(e.update){qs(e.update.name,"name");var r=this.fromName(e.update.name),i=this.fromFields(e.update.fields||{});if(e.updateMask){var o=this.fromDocumentMask(e.updateMask);return new fn(r,i,o,n)}return new cn(r,i,n)}if(e.delete)return r=this.fromName(e.delete),new vn(r,n);if(e.transform){r=this.fromName(e.transform.document);var a=e.transform.fieldTransforms.map(function(e){return t.fromFieldTransform(e)});return v(!0===n.exists,'Transforms only support precondition "exists == true"'),new mn(r,a)}return e.verify?(r=this.fromName(e.verify),new In(r,n)):w("unknown mutation proto: "+JSON.stringify(e))},Us.prototype.toPrecondition=function(e){return v(!e.isNone,"Can't serialize an empty precondition"),void 0!==e.updateTime?{updateTime:this.toVersion(e.updateTime)}:void 0!==e.exists?{exists:e.exists}:w("Unknown precondition")},Us.prototype.fromPrecondition=function(e){return void 0!==e.updateTime?rn.updateTime(this.fromVersion(e.updateTime)):void 0!==e.exists?rn.exists(e.exists):rn.NONE},Us.prototype.fromWriteResult=function(e,t){var n=this,r=e.updateTime?this.fromVersion(e.updateTime):this.fromVersion(t);r.isEqual(Ke.MIN)&&(r=this.fromVersion(t));var i=null;return e.transformResults&&0<e.transformResults.length&&(i=e.transformResults.map(function(e){return n.fromValue(e)})),new nn(r,i)},Us.prototype.fromWriteResults=function(e,t){var n=this;return e&&0<e.length?(v(void 0!==t,"Received a write result without a commit time"),e.map(function(e){return n.fromWriteResult(e,t)})):[]},Us.prototype.toFieldTransform=function(e){var t=this,n=e.transform;if(n instanceof Ss)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Es)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(e){return t.toValue(e)})}};if(n instanceof Cs)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(e){return t.toValue(e)})}};if(n instanceof As)return{fieldPath:e.field.canonicalString(),increment:this.toValue(n.operand)};throw w("Unknown transform: "+e.transform)},Us.prototype.fromFieldTransform=function(e){var t=this,n=null;if("setToServerValue"in e)v("REQUEST_TIME"===e.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(e)),n=Ss.instance;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Es(r.map(function(e){return t.fromValue(e)}))}else if("removeAllFromArray"in e)r=e.removeAllFromArray.values||[],n=new Cs(r.map(function(e){return t.fromValue(e)}));else if("increment"in e){var i=this.fromValue(e.increment);v(i instanceof qn,"NUMERIC_ADD transform requires a NumberValue"),n=new As(i)}else w("Unknown transform proto: "+JSON.stringify(e));var o=Se.fromServerFormat(e.fieldPath);return new $t(o,n)},Us.prototype.toDocumentsTarget=function(e){return{documents:[this.toQueryPath(e.path)]}},Us.prototype.fromDocumentsTarget=function(e){var t=e.documents.length;v(1===t,"DocumentsTarget contained other than 1 document: "+t);var n=e.documents[0];return mo.atPath(this.fromQueryPath(n)).toTarget()},Us.prototype.toQueryTarget=function(e){var t={structuredQuery:{}},n=e.path;null!==e.collectionGroup?(v(n.length%2==0,"Collection Group queries should be within a document path or root."),t.parent=this.toQueryPath(n),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(v(n.length%2!=0,"Document queries with filters are not supported."),t.parent=this.toQueryPath(n.popLast()),t.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(e.filters);r&&(t.structuredQuery.where=r);var i=this.toOrder(e.orderBy);i&&(t.structuredQuery.orderBy=i);var o=this.toInt32Value(e.limit);return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=this.toCursor(e.startAt)),e.endAt&&(t.structuredQuery.endAt=this.toCursor(e.endAt)),t},Us.prototype.fromQueryTarget=function(e){var t=this.fromQueryPath(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){v(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:t=t.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new mo(t,i,s,a,u,ho.First,c,h).toTarget()},Us.prototype.toListenRequestLabels=function(e){var t=this.toLabel(e.purpose);return null==t?null:{"goog-listen-tags":t}},Us.prototype.toLabel=function(e){switch(e){case bi.Listen:return null;case bi.ExistenceFilterMismatch:return"existence-filter-mismatch";case bi.LimboResolution:return"limbo-document";default:return w("Unrecognized query purpose: "+e)}},Us.prototype.toTarget=function(e){var t,n=e.target;return(t=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=e.targetId,0<e.resumeToken.length&&(t.resumeToken=this.unsafeCastProtoByteString(e.resumeToken)),t},Us.prototype.toFilter=function(e){var t=this;if(0!==e.length){var n=e.map(function(e){return e instanceof To?t.toUnaryOrFieldFilter(e):w("Unrecognized filter: "+JSON.stringify(e))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Us.prototype.fromFilter=function(e){var t=this;return e?void 0!==e.unaryFilter?[this.fromUnaryFilter(e)]:void 0!==e.fieldFilter?[this.fromFieldFilter(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(e){return t.fromFilter(e)}).reduce(function(e,t){return e.concat(t)}):w("Unknown filter: "+JSON.stringify(e)):[]},Us.prototype.toOrder=function(e){var t=this;if(0!==e.length)return e.map(function(e){return t.toPropertyOrder(e)})},Us.prototype.fromOrder=function(e){var t=this;return e.map(function(e){return t.fromPropertyOrder(e)})},Us.prototype.toCursor=function(e){var t=this;return{before:e.before,values:e.position.map(function(e){return t.toValue(e)})}},Us.prototype.fromCursor=function(e){var t=this,n=!!e.before,r=e.values.map(function(e){return t.fromValue(e)});return new Bo(r,n)},Us.prototype.toDirection=function(e){return Ps[e.name]},Us.prototype.fromDirection=function(e){switch(e){case"ASCENDING":return qo.ASCENDING;case"DESCENDING":return qo.DESCENDING;default:return}},Us.prototype.toOperatorName=function(e){return xs[e.name]},Us.prototype.fromOperatorName=function(e){switch(e){case"EQUAL":return vo.EQUAL;case"GREATER_THAN":return vo.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return vo.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return vo.LESS_THAN;case"LESS_THAN_OR_EQUAL":return vo.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return vo.ARRAY_CONTAINS;case"IN":return vo.IN;case"ARRAY_CONTAINS_ANY":return vo.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return w("Unspecified operator");default:return w("Unknown operator")}},Us.prototype.toFieldPathReference=function(e){return{fieldPath:e.canonicalString()}},Us.prototype.fromFieldPathReference=function(e){return Se.fromServerFormat(e.fieldPath)},Us.prototype.toPropertyOrder=function(e){return{field:this.toFieldPathReference(e.field),direction:this.toDirection(e.dir)}},Us.prototype.fromPropertyOrder=function(e){return new jo(this.fromFieldPathReference(e.field),this.fromDirection(e.direction))},Us.prototype.fromFieldFilter=function(e){return To.create(this.fromFieldPathReference(e.fieldFilter.field),this.fromOperatorName(e.fieldFilter.op),this.fromValue(e.fieldFilter.value))},Us.prototype.toUnaryOrFieldFilter=function(e){if(e.op===vo.EQUAL){if(e.value.isEqual(Gn.NAN))return{unaryFilter:{field:this.toFieldPathReference(e.field),op:"IS_NAN"}};if(e.value.isEqual(Rn.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(e.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(e.field),op:this.toOperatorName(e.op),value:this.toValue(e.value)}}},Us.prototype.fromUnaryFilter=function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=this.fromFieldPathReference(e.unaryFilter.field);return To.create(t,vo.EQUAL,Gn.NAN);case"IS_NULL":var n=this.fromFieldPathReference(e.unaryFilter.field);return To.create(n,vo.EQUAL,Rn.INSTANCE);case"OPERATOR_UNSPECIFIED":return w("Unspecified filter");default:return w("Unknown filter")}},Us.prototype.toDocumentMask=function(e){var t=[];return e.fields.forEach(function(e){return t.push(e.canonicalString())}),{fieldPaths:t}},Us.prototype.fromDocumentMask=function(e){var t=(e.fieldPaths||[]).map(function(e){return Se.fromServerFormat(e)});return Jt.fromArray(t)},Us);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Us(e,t){this.databaseId=e,this.options=t}var js=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},Ks=(Ws.prototype.listen=function(e){var t=e.query,n=!1,r=this.queries.get(t);return r||(n=!0,r=new js,this.queries.set(t,r)),r.listeners.push(e),v(!e.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),!r.viewSnap||e.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(t).then(function(e){return r.targetId=e}):Promise.resolve(r.targetId)},Ws.prototype.unlisten=function(o){return m.__awaiter(this,void 0,void 0,function(){var t,n,r,i;return m.__generator(this,function(e){return t=o.query,n=!1,(r=this.queries.get(t))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(t),[2,this.syncEngine.unlisten(t)]):[2]})})},Ws.prototype.onWatchChange=function(e){for(var t=!1,n=0,r=e;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++)u[s].onViewSnapshot(i)&&(t=!0);a.viewSnap=i}}t&&this.raiseSnapshotsInSyncEvent()},Ws.prototype.onWatchError=function(e,t){var n=this.queries.get(e);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(t);this.queries.delete(e)},Ws.prototype.onOnlineStateChange=function(i){this.onlineState=i;var o=!1;this.queries.forEach(function(e,t){for(var n=0,r=t.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)&&(o=!0)}),o&&this.raiseSnapshotsInSyncEvent()},Ws.prototype.addSnapshotsInSyncListener=function(e){this.snapshotsInSyncListeners.add(e),e.next()},Ws.prototype.removeSnapshotsInSyncListener=function(e){this.snapshotsInSyncListeners.delete(e)},Ws.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach(function(e){e.next()})},Ws);function Ws(e){this.syncEngine=e,this.queries=new Ar(function(e){return e.canonicalId()}),this.onlineState=La.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}var Gs=(Qs.prototype.onViewSnapshot=function(e){if(v(0<e.docChanges.length||e.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var t=[],n=0,r=e.docChanges;n<r.length;n++){var i=r[n];i.type!==Qa.Metadata&&t.push(i)}e=new es(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),o=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),o=!0),this.snap=e,o},Qs.prototype.onError=function(e){this.queryObserver.error(e)},Qs.prototype.applyOnlineStateChange=function(e){this.onlineState=e;var t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t},Qs.prototype.shouldRaiseInitialEvent=function(e,t){if(v(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!e.fromCache)return!0;var n=t!==La.Offline;return this.options.waitForSyncWhenOnline&&n?(v(e.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!e.docs.isEmpty()||t===La.Offline},Qs.prototype.shouldRaiseEvent=function(e){if(0<e.docChanges.length)return!0;var t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges},Qs.prototype.raiseInitialEvent=function(e){v(!this.raisedInitialEvent,"Trying to raise initial events for second time"),e=es.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(e)},Qs);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qs(e,t,n){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=La.Unknown,this.options=n||{}}var zs=(Hs.fromSnapshot=function(e,t){for(var n=lt(),r=lt(),i=0,o=t.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case Qa.Added:n=n.add(a.doc.key);break;case Qa.Removed:r=r.add(a.doc.key)}}return new Hs(e,t.fromCache,n,r)},Hs);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hs(e,t,n,r){this.targetId=e,this.fromCache=t,this.addedKeys=n,this.removedKeys=r}var Ys=function(e){this.key=e},Js=function(e){this.key=e},Xs=(Object.defineProperty($s.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),$s.prototype.computeDocChanges=function(e,t){var s=this,u=t?t.changeSet:new $a,c=t?t.documentSet:this.documentSet,h=t?t.mutatedKeys:this.mutatedKeys,l=c,f=!1,d=this.query.hasLimitToFirst()&&c.size===this.query.limit?c.last():null,p=this.query.hasLimitToLast()&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal(function(e,t){var n=c.get(e),r=t instanceof wr?t:null;r&&(v(e.isEqual(r.key),"Mismatching keys found in document changes: "+e+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:Qa.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:Qa.Modified,doc:r}),a=!0,(d&&0<s.query.docComparator(r,d)||p&&s.query.docComparator(r,p)<0)&&(f=!0)):!n&&r?(u.track({type:Qa.Added,doc:r}),a=!0):n&&!r&&(u.track({type:Qa.Removed,doc:n}),a=!0,(d||p)&&(f=!0)),a&&(h=r?(l=l.add(r),o?h.add(e):h.delete(e)):(l=l.delete(e),h.delete(e)))}),this.query.hasLimitToFirst()||this.query.hasLimitToLast())for(;l.size>this.query.limit;){var n=this.query.hasLimitToFirst()?l.last():l.first();l=l.delete(n.key),h=h.delete(n.key),u.track({type:Qa.Removed,doc:n})}return v(!f||!t,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},$s.prototype.shouldWaitForSyncedDocument=function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations},$s.prototype.applyChanges=function(e,t,n){var o=this;v(!e.needsRefill,"Cannot apply changes that need a refill");var r=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;var i=e.changeSet.getChanges();i.sort(function(e,t){return r=e.type,i=t.type,n(r)-n(i)||o.query.docComparator(e.doc,t.doc);function n(e){switch(e){case Qa.Added:return 1;case Qa.Modified:case Qa.Metadata:return 2;case Qa.Removed:return 0;default:return w("Unknown ChangeType: "+e)}}var r,i;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}),this.applyTargetChange(n);var a=t?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?Ha.Synced:Ha.Local,u=s!==this.syncState;return this.syncState=s,0!==i.length||u?{snapshot:new es(this.query,e.documentSet,r,i,e.mutatedKeys,s===Ha.Local,u,!1),limboChanges:a}:{limboChanges:a}},$s.prototype.applyOnlineStateChange=function(e){return this.current&&e===La.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new $a,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},$s.prototype.shouldBeInLimbo=function(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations},$s.prototype.applyTargetChange=function(e){var t=this;e&&(e.addedDocuments.forEach(function(e){return t._syncedDocuments=t._syncedDocuments.add(e)}),e.modifiedDocuments.forEach(function(e){return v(t._syncedDocuments.has(e),"Modified document "+e+" not found in view.")}),e.removedDocuments.forEach(function(e){return t._syncedDocuments=t._syncedDocuments.delete(e)}),this.current=e.current)},$s.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=lt(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var r=[];return n.forEach(function(e){t.limboDocuments.has(e)||r.push(new Js(e))}),this.limboDocuments.forEach(function(e){n.has(e)||r.push(new Ys(e))}),r},$s.prototype.synchronizeWithPersistedState=function(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=lt();var t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)},$s.prototype.computeInitialSnapshot=function(){return es.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===Ha.Local)},$s);function $s(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.current=!1,this.limboDocuments=lt(),this.mutatedKeys=lt(),this.documentSet=new Ja(e.docComparator.bind(e))}var Zs=(eu.prototype.run=function(){this.runWithBackOff()},eu.prototype.runWithBackOff=function(){var e=this;this.backoff.backoffAndRun(function(){return m.__awaiter(e,void 0,void 0,function(){var t,n,r=this;return m.__generator(this,function(e){return t=this.remoteStore.createTransaction(),(n=this.tryRunUpdateFunction(t))&&n.then(function(e){r.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){r.deferred.resolve(e)}).catch(function(e){r.handleTransactionError(e)})})}).catch(function(e){r.handleTransactionError(e)}),[2]})})})},eu.prototype.tryRunUpdateFunction=function(e){try{var t=this.updateFunction(e);return!uo(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}},eu.prototype.handleTransactionError=function(e){var t=this;0<this.retries&&this.isRetryableTransactionError(e)?(--this.retries,this.asyncQueue.enqueueAndForget(function(){return t.runWithBackOff(),Promise.resolve()})):this.deferred.reject(e)},eu.prototype.isRetryableTransactionError=function(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||!Wa(t)},eu);function eu(e,t,n,r){this.asyncQueue=e,this.remoteStore=t,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new ba(this.asyncQueue,Ce.RetryTransaction)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tu="SyncEngine",nu=function(e,t,n){this.query=e,this.targetId=t,this.view=n},ru=function(e){this.key=e,this.receivedDocument=!1},iu=(Object.defineProperty(ou.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),ou.prototype.subscribe=function(e){v(null!==e,"SyncEngine listener cannot be null"),v(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=e},ou.prototype.listen=function(a){return m.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return m.__generator(this,function(e){switch(e.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(t=r.targetId,this.sharedClientState.addLocalQueryTarget(t),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateTarget(a.toTarget())];case 2:return i=e.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),t=i.targetId,[4,this.initializeViewAndComputeSnapshot(a,t,"current"===o)];case 3:n=e.sent(),this.isPrimary&&this.remoteStore.listen(i),e.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,t]}})})},ou.prototype.initializeViewAndComputeSnapshot=function(s,u,c){return m.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a;return m.__generator(this,function(e){switch(e.label){case 0:return[4,this.localStore.executeQuery(s,!0)];case 1:return t=e.sent(),n=new Xs(s,t.remoteKeys),r=n.computeDocChanges(t.documents),i=is.createSynthesizedTargetChangeForCurrentChange(u,c&&this.onlineState!==La.Offline),v(0===(o=n.applyChanges(r,!0===this.isPrimary,i)).limboChanges.length,"View returned limbo docs before target ack from the server."),v(!!o.snapshot,"applyChanges for new view should always return a snapshot"),a=new nu(s,u,n),this.queryViewsByQuery.set(s,a),this.queriesByTarget[u]||(this.queriesByTarget[u]=[]),this.queriesByTarget[u].push(s),[2,o.snapshot]}})})},ou.prototype.synchronizeViewAndComputeSnapshot=function(r){return m.__awaiter(this,void 0,void 0,function(){var t,n;return m.__generator(this,function(e){switch(e.label){case 0:return[4,this.localStore.executeQuery(r.query,!0)];case 1:return t=e.sent(),n=r.view.synchronizeWithPersistedState(t),this.isPrimary&&this.updateTrackedLimbos(r.targetId,n.limboChanges),[2,n]}})})},ou.prototype.unlisten=function(i){return m.__awaiter(this,void 0,void 0,function(){var t,n,r=this;return m.__generator(this,function(e){switch(e.label){case 0:return this.assertSubscribed("unlisten()"),v(!!(t=this.queryViewsByQuery.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.queriesByTarget[t.targetId]).length?(this.queriesByTarget[t.targetId]=n.filter(function(e){return!e.isEqual(i)}),this.queryViewsByQuery.delete(i),[2]):this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.sharedClientState.isActiveQueryTarget(t.targetId)?[3,2]:[4,this.localStore.releaseTarget(t.targetId,!1).then(function(){r.sharedClientState.clearQueryState(t.targetId),r.remoteStore.unlisten(t.targetId),r.removeAndCleanupTarget(t.targetId)}).catch($i)]):[3,3];case 1:e.sent(),e.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupTarget(t.targetId),[4,this.localStore.releaseTarget(t.targetId,!0)];case 4:e.sent(),e.label=5;case 5:return[2]}})})},ou.prototype.write=function(n,r){return m.__awaiter(this,void 0,void 0,function(){var t;return m.__generator(this,function(e){switch(e.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(n)];case 1:return t=e.sent(),this.sharedClientState.addPendingMutation(t.batchId),this.addMutationCallback(t.batchId,r),[4,this.emitNewSnapsAndNotifyLocalStore(t.changes)];case 2:return e.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return e.sent(),[2]}})})},ou.prototype.runTransaction=function(e,t,n){new Zs(e,this.remoteStore,t,n).run()},ou.prototype.applyRemoteEvent=function(n){return m.__awaiter(this,void 0,void 0,function(){var t,r=this;return m.__generator(this,function(e){switch(e.label){case 0:this.assertSubscribed("applyRemoteEvent()"),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(n)];case 2:return t=e.sent(),M(n.targetChanges,function(e,t){var n=r.limboResolutionsByTarget[Number(e)];n&&(v(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<t.addedDocuments.size?n.receivedDocument=!0:0<t.modifiedDocuments.size?v(n.receivedDocument,"Received change for limbo target document without add."):0<t.removedDocuments.size&&(v(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(t,n)];case 3:return e.sent(),[3,6];case 4:return[4,$i(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})},ou.prototype.applyOnlineStateChange=function(r,e){if(this.isPrimary&&e===xa.RemoteStore||!this.isPrimary&&e===xa.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var i=[];this.queryViewsByQuery.forEach(function(e,t){var n=t.view.applyOnlineStateChange(r);v(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},ou.prototype.rejectListen=function(s,u){return m.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return m.__generator(this,function(e){switch(e.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(s,"rejected",u),t=this.limboResolutionsByTarget[s],(n=t&&t.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[s],r=(r=new Ge(Ee.comparator)).insert(n,new _r(n,Ke.forDeletedDoc())),i=lt().add(n),o=new ns(Ke.MIN,{},new Ze(ee),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return[4,this.localStore.releaseTarget(s,!1).then(function(){return a.removeAndCleanupTarget(s,u)}).catch($i)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},ou.prototype.applyBatchState=function(n,r,i){return m.__awaiter(this,void 0,void 0,function(){var t;return m.__generator(this,function(e){switch(e.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(t=e.sent())?(y(tu,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return e.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):w("Unknown batchState: "+r),e.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(t)];case 5:return e.sent(),[2]}})})},ou.prototype.applySuccessfulWrite=function(r){return m.__awaiter(this,void 0,void 0,function(){var t,n;return m.__generator(this,function(e){switch(e.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),t=r.batch.batchId,this.processUserCallback(t,null),this.triggerPendingWritesCallbacks(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(r)];case 2:return n=e.sent(),this.sharedClientState.updateMutationState(t,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return e.sent(),[3,6];case 4:return[4,$i(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})},ou.prototype.rejectFailedWrite=function(n,r){return m.__awaiter(this,void 0,void 0,function(){var t;return m.__generator(this,function(e){switch(e.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(n,r),this.triggerPendingWritesCallbacks(n),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(n)];case 2:return t=e.sent(),this.sharedClientState.updateMutationState(n,"rejected",r),[4,this.emitNewSnapsAndNotifyLocalStore(t)];case 3:return e.sent(),[3,6];case 4:return[4,$i(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})},ou.prototype.registerPendingWritesCallback=function(r){return m.__awaiter(this,void 0,void 0,function(){var t,n;return m.__generator(this,function(e){switch(e.label){case 0:return this.remoteStore.canUseNetwork()||y(tu,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(t=e.sent())?r.resolve():((n=this.pendingWritesCallbacks.get(t)||[]).push(r),this.pendingWritesCallbacks.set(t,n)),[2]}})})},ou.prototype.triggerPendingWritesCallbacks=function(e){(this.pendingWritesCallbacks.get(e)||[]).forEach(function(e){e.resolve()}),this.pendingWritesCallbacks.delete(e)},ou.prototype.rejectOutstandingPendingWritesCallbacks=function(t){this.pendingWritesCallbacks.forEach(function(e){e.forEach(function(e){e.reject(new I(E.CANCELLED,t))})}),this.pendingWritesCallbacks.clear()},ou.prototype.addMutationCallback=function(e,t){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new Ge(ee)).insert(e,t),this.mutationUserCallbacks[this.currentUser.toKey()]=n},ou.prototype.processUserCallback=function(e,t){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(e);r&&(v(e===n.minKey(),"Mutation callbacks processed out-of-order?"),t?r.reject(t):r.resolve(),n=n.remove(e)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},ou.prototype.removeAndCleanupTarget=function(e,t){var n=this;void 0===t&&(t=null),this.sharedClientState.removeLocalQueryTarget(e),v(this.queriesByTarget[e]&&0!==this.queriesByTarget[e].length,"There are no queries mapped to target id "+e);for(var r=0,i=this.queriesByTarget[e];r<i.length;r++){var o=i[r];this.queryViewsByQuery.delete(o),t&&this.syncEngineListener.onWatchError(o,t)}if(delete this.queriesByTarget[e],this.isPrimary){var a=this.limboDocumentRefs.referencesForId(e);this.limboDocumentRefs.removeReferencesForId(e),a.forEach(function(e){n.limboDocumentRefs.containsKey(e)||n.removeLimboTarget(e)})}},ou.prototype.removeLimboTarget=function(e){var t=this.limboTargetsByKey.get(e);null!==t&&(this.remoteStore.unlisten(t),this.limboTargetsByKey=this.limboTargetsByKey.remove(e),delete this.limboResolutionsByTarget[t])},ou.prototype.updateTrackedLimbos=function(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n];i instanceof Ys?(this.limboDocumentRefs.addReference(i.key,e),this.trackLimboChange(i)):i instanceof Js?(y(tu,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,e),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):w("Unknown limbo change: "+JSON.stringify(i))}},ou.prototype.trackLimboChange=function(e){var t=e.key;if(!this.limboTargetsByKey.get(t)){y(tu,"New document in limbo: "+t);var n=this.limboTargetIdGenerator.next(),r=mo.atPath(t.path);this.limboResolutionsByTarget[n]=new ru(t),this.remoteStore.listen(new Ai(r.toTarget(),n,bi.LimboResolution,fe.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(t,n)}},ou.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},ou.prototype.emitNewSnapsAndNotifyLocalStore=function(r,u){return m.__awaiter(this,void 0,void 0,function(){var o,a,t,s=this;return m.__generator(this,function(e){switch(e.label){case 0:return o=[],a=[],t=[],this.queryViewsByQuery.forEach(function(e,i){t.push(Promise.resolve().then(function(){var n=i.view.computeDocChanges(r);return n.needsRefill?s.localStore.executeQuery(i.query,!1).then(function(e){var t=e.documents;return i.view.computeDocChanges(t,n)}):n}).then(function(e){var t=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(e,!0===s.isPrimary,t);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=zs.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(t)];case 1:return e.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return e.sent(),[2]}})})},ou.prototype.assertSubscribed=function(e){v(null!==this.syncEngineListener,"Trying to call "+e+" before calling subscribe().")},ou.prototype.handleCredentialChange=function(r){return m.__awaiter(this,void 0,void 0,function(){var t,n;return m.__generator(this,function(e){switch(e.label){case 0:return t=!this.currentUser.isEqual(r),this.currentUser=r,t?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(r)]):[3,3];case 1:return n=e.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:e.sent(),e.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return e.sent(),[2]}})})},ou.prototype.applyPrimaryState=function(c){return m.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u=this;return m.__generator(this,function(e){switch(e.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return e.sent(),t=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(t.toArray())];case 2:for(n=e.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),k(this.queriesByTarget,function(e,t){u.sharedClientState.isLocalQueryTarget(e)?a.push(e):s=s.then(function(){return u.removeAndCleanupTarget(e),u.localStore.releaseTarget(e,!0)}),u.remoteStore.unlisten(e)}),[4,s]);case 4:return e.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return e.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:e.sent(),e.label=7;case 7:return[2]}})})},ou.prototype.resetLimboDocuments=function(){var t=this;k(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Ge(Ee.comparator)},ou.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(p){return m.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,h,l,f,d;return m.__generator(this,function(e){switch(e.label){case 0:t=[],n=[],r=0,i=p,e.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queriesByTarget[o])&&0!==s.length?[4,this.localStore.releaseTarget(o,!0)]:[3,8]):[3,14];case 2:return e.sent(),[4,this.localStore.allocateTarget(s[0].toTarget())];case 3:a=e.sent(),u=0,c=s,e.label=4;case 4:return u<c.length?(h=c[u],v(!!(l=this.queryViewsByQuery.get(h)),"No query view found for "+h),[4,this.synchronizeViewAndComputeSnapshot(l)]):[3,7];case 5:(f=e.sent()).snapshot&&n.push(f.snapshot),e.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return v(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.localStore.getTarget(o)];case 9:return v(!!(d=e.sent()),"Target for id "+o+" not found"),[4,this.localStore.allocateTarget(d)];case 10:return a=e.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(d),o,!1)];case 11:e.sent(),e.label=12;case 12:t.push(a),e.label=13;case 13:return r++,[3,1];case 14:return this.syncEngineListener.onWatchChange(n),[2,t]}})})},ou.prototype.synthesizeTargetToQuery=function(e){return new mo(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,ho.First,e.startAt,e.endAt)},ou.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},ou.prototype.applyTargetState=function(r,i,o){return m.__awaiter(this,void 0,void 0,function(){var t,n;return m.__generator(this,function(e){switch(e.label){case 0:if(this.isPrimary)return y(tu,"Ignoring unexpected query state notification."),[2];if(!this.queriesByTarget[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return t=e.sent(),n=ns.createSynthesizedRemoteEventForCurrentChange(r,"current"===i),[4,this.emitNewSnapsAndNotifyLocalStore(t,n)];case 3:return e.sent(),[3,7];case 4:return[4,this.localStore.releaseTarget(r,!0)];case 5:return e.sent(),this.removeAndCleanupTarget(r,o),[3,7];case 6:w("Unexpected target state: "+i),e.label=7;case 7:return[2]}})})},ou.prototype.applyActiveTargetsChange=function(l,f){return m.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,h=this;return m.__generator(this,function(e){switch(e.label){case 0:if(!this.isPrimary)return[2];t=0,n=l,e.label=1;case 1:return t<n.length?(c=n[t],v(!this.queriesByTarget[c],"Trying to add an already active target"),[4,this.localStore.getTarget(c)]):[3,6];case 2:return v(!!(r=e.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateTarget(r)];case 3:return i=e.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(r),i.targetId,!1)];case 4:e.sent(),this.remoteStore.listen(i),e.label=5;case 5:return t++,[3,1];case 6:o=function(t){return m.__generator(this,function(e){switch(e.label){case 0:return a.queriesByTarget[t]?[4,a.localStore.releaseTarget(t,!1).then(function(){h.remoteStore.unlisten(t),h.removeAndCleanupTarget(t)}).catch($i)]:[2,"continue"];case 1:return e.sent(),[2]}})},a=this,s=0,u=f,e.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:e.sent(),e.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},ou.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},ou.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},ou.prototype.getRemoteKeysForTarget=function(e){var t=this.limboResolutionsByTarget[e];if(t&&t.receivedDocument)return lt().add(t.key);var n=lt(),r=this.queriesByTarget[e];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.queryViewsByQuery.get(a);v(!!s,"No query view found for "+a),n=n.unionWith(s.view.syncedDocuments)}return n},ou);function ou(e,t,n,r){this.localStore=e,this.remoteStore=t,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Ar(function(e){return e.canonicalId()}),this.queriesByTarget={},this.limboTargetsByKey=new Ge(Ee.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new Jo,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=jt.forSyncEngine(),this.isPrimary=void 0,this.onlineState=La.Unknown}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var au=(su.prototype.isAuthenticated=function(){return null!=this.uid},su.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},su.prototype.isEqual=function(e){return e.uid===this.uid},su.UNAUTHENTICATED=new su(null),su.GOOGLE_CREDENTIALS=new su("google-credentials-uid"),su.FIRST_PARTY=new su("first-party-uid"),su);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function su(e){this.uid=e}var uu="firestore_clients";function cu(e,t){return v(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),uu+"_"+e+"_"+t}var hu="firestore_mutations";function lu(e,t,n){var r=hu+"_"+e+"_"+n;return t.isAuthenticated()&&(r+="_"+t.uid),r}var fu="firestore_targets";function du(e,t){return fu+"_"+e+"_"+t}var pu="firestore_online_state";var mu="firestore_sequence_number";
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gu="SharedClientState",yu=(vu.fromWebStorageEntry=function(e,t,n){var r=JSON.parse(n),i="object"===(void 0===r?"undefined":l(r))&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"===l(r.error)),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new I(r.error.code,r.error.message)),i?new vu(e,t,r.state,o):(c(gu,"Failed to parse mutation state for ID '"+t+"': "+n),null)},vu.prototype.toWebStorageJSON=function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)},vu);function vu(e,t,n,r){this.user=e,this.batchId=t,this.state=n,v(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var bu=(wu.fromWebStorageEntry=function(e,t){var n=JSON.parse(t),r="object"===(void 0===n?"undefined":l(n))&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"===l(n.error)),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new I(n.error.code,n.error.message)),r?new wu(e,n.state,i):(c(gu,"Failed to parse target state for ID '"+e+"': "+t),null)},wu.prototype.toWebStorageJSON=function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)},wu);function wu(e,t,n){this.targetId=e,this.state=t,v(void 0!==(this.error=n)==("rejected"===t),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var Tu=(Su.fromWebStorageEntry=function(e,t){for(var n=JSON.parse(t),r="object"===(void 0===n?"undefined":l(n))&&n.activeTargetIds instanceof Array,i=dt(),o=0;r&&o<n.activeTargetIds.length;++o)r=co(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Su(e,i):(c(gu,"Failed to parse client data for instance '"+e+"': "+t),null)},Su);function Su(e,t){this.clientId=e,this.activeTargetIds=t}var _u=(Eu.fromWebStorageEntry=function(e){var t=JSON.parse(e);return"object"===(void 0===t?"undefined":l(t))&&t.onlineState in La&&"string"==typeof t.clientId?new Eu(t.clientId,La[t.onlineState]):(c(gu,"Failed to parse online state: "+e),null)},Eu);function Eu(e,t){this.clientId=e,this.onlineState=t}var Iu=(Cu.prototype.addQueryTarget=function(e){this.activeTargetIds=this.activeTargetIds.add(e)},Cu.prototype.removeQueryTarget=function(e){this.activeTargetIds=this.activeTargetIds.delete(e)},Cu.prototype.toWebStorageJSON=function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)},Cu);function Cu(){this.activeTargetIds=dt()}var Du=(Au.isAvailable=function(e){return!(!e.window||null==e.window.localStorage)},Au.prototype.start=function(){return m.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,h,l,f=this;return m.__generator(this,function(e){switch(e.label){case 0:return v(!this.started,"WebStorageSharedClientState already started"),v(null!==this.syncEngine,"syncEngine property must be set before calling start()"),v(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=e.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(cu(this.persistenceKey,i)))&&(a=Tu.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},Au.prototype.writeSequenceNumber=function(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))},Au.prototype.getAllActiveQueryTargets=function(){var n=dt();return M(this.activeClients,function(e,t){n=n.unionWith(t.activeTargetIds)}),n},Au.prototype.isActiveQueryTarget=function(e){for(var t in this.activeClients)if(this.activeClients.hasOwnProperty(t)&&this.activeClients[t].activeTargetIds.has(e))return!0;return!1},Au.prototype.addPendingMutation=function(e){this.persistMutationState(e,"pending")},Au.prototype.updateMutationState=function(e,t,n){this.persistMutationState(e,t,n),this.removeMutationState(e)},Au.prototype.addLocalQueryTarget=function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(du(this.persistenceKey,e));if(n){var r=bu.fromWebStorageEntry(e,n);r&&(t=r.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t},Au.prototype.removeLocalQueryTarget=function(e){this.localClientState.removeQueryTarget(e),this.persistClientState()},Au.prototype.isLocalQueryTarget=function(e){return this.localClientState.activeTargetIds.has(e)},Au.prototype.clearQueryState=function(e){this.removeItem(du(this.persistenceKey,e))},Au.prototype.updateQueryState=function(e,t,n){this.persistQueryTargetState(e,t,n)},Au.prototype.handleUserChange=function(e,t,n){var r=this;t.forEach(function(e){r.removeMutationState(e)}),this.currentUser=e,n.forEach(function(e){r.addPendingMutation(e)})},Au.prototype.setOnlineState=function(e){this.persistOnlineState(e)},Au.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},Au.prototype.getItem=function(e){var t=this.storage.getItem(e);return y(gu,"READ",e,t),t},Au.prototype.setItem=function(e,t){y(gu,"SET",e,t),this.storage.setItem(e,t)},Au.prototype.removeItem=function(e){y(gu,"REMOVE",e),this.storage.removeItem(e)},Au.prototype.handleWebStorageEvent=function(s){var e=this;if(s.storageArea===this.storage){if(y(gu,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void c("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return m.__awaiter(e,void 0,void 0,function(){var t,n,r,i,o,a;return m.__generator(this,function(e){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(t=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(t.clientId,t)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(v(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(e){var t=fe.INVALID;if(null!=e)try{var n=JSON.parse(e);v("number"==typeof n,"Found non-numeric sequence number"),t=n}catch(e){c(gu,"Failed to read sequence number from WebStorage",e)}return t}(s.newValue))!==fe.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(Au.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),Au.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},Au.prototype.persistMutationState=function(e,t,n){var r=new yu(this.currentUser,e,t,n),i=lu(this.persistenceKey,this.currentUser,e);this.setItem(i,r.toWebStorageJSON())},Au.prototype.removeMutationState=function(e){var t=lu(this.persistenceKey,this.currentUser,e);this.removeItem(t)},Au.prototype.persistOnlineState=function(e){var t={clientId:this.localClientId,onlineState:La[e]};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))},Au.prototype.persistQueryTargetState=function(e,t,n){var r=du(this.persistenceKey,e),i=new bu(e,t,n);this.setItem(r,i.toWebStorageJSON())},Au.prototype.fromWebStorageClientStateKey=function(e){var t=this.clientStateKeyRe.exec(e);return t?t[1]:null},Au.prototype.fromWebStorageClientState=function(e,t){var n=this.fromWebStorageClientStateKey(e);return v(null!==n,"Cannot parse client state key '"+e+"'"),Tu.fromWebStorageEntry(n,t)},Au.prototype.fromWebStorageMutationMetadata=function(e,t){var n=this.mutationBatchKeyRe.exec(e);v(null!==n,"Cannot parse mutation batch key '"+e+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return yu.fromWebStorageEntry(new au(i),r,t)},Au.prototype.fromWebStorageQueryTargetMetadata=function(e,t){var n=this.queryTargetKeyRe.exec(e);v(null!==n,"Cannot parse query target key '"+e+"'");var r=Number(n[1]);return bu.fromWebStorageEntry(r,t)},Au.prototype.fromWebStorageOnlineState=function(e){return _u.fromWebStorageEntry(e)},Au.prototype.handleMutationBatchEvent=function(t){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){return t.user.uid!==this.currentUser.uid?(y(gu,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},Au.prototype.handleQueryTargetEvent=function(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)},Au.prototype.handleClientStateEvent=function(e,t){var n=this,r=this.getAllActiveQueryTargets();t?this.activeClients[e]=t:delete this.activeClients[e];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(t){return m.__awaiter(n,void 0,void 0,function(){return m.__generator(this,function(e){return r.has(t)||o.push(t),[2]})})}),r.forEach(function(t){return m.__awaiter(n,void 0,void 0,function(){return m.__generator(this,function(e){return i.has(t)||a.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},Au.prototype.handleOnlineStateEvent=function(e){this.activeClients[e.clientId]&&this.onlineStateHandler(e.onlineState)},Au);function Au(e,t,n,r,i){if(this.queue=e,this.platform=t,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!Au.isAvailable(this.platform))throw new I(E.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o,a,s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=cu(this.persistenceKey,this.localClientId),this.sequenceNumberKey=(o=this.persistenceKey,mu+"_"+o),this.activeClients[this.localClientId]=new Iu,this.clientStateKeyRe=new RegExp("^"+uu+"_"+s+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+hu+"_"+s+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+fu+"_"+s+"_(\\d+)$"),this.onlineStateKey=(a=this.persistenceKey,pu+"_"+a),this.platform.window.addEventListener("storage",this.storageListener)}var Nu=(ku.prototype.addPendingMutation=function(e){},ku.prototype.updateMutationState=function(e,t,n){},ku.prototype.addLocalQueryTarget=function(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"},ku.prototype.updateQueryState=function(e,t,n){this.queryState[e]=t},ku.prototype.removeLocalQueryTarget=function(e){this.localState.removeQueryTarget(e)},ku.prototype.isLocalQueryTarget=function(e){return this.localState.activeTargetIds.has(e)},ku.prototype.clearQueryState=function(e){delete this.queryState[e]},ku.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},ku.prototype.isActiveQueryTarget=function(e){return this.localState.activeTargetIds.has(e)},ku.prototype.start=function(){return this.localState=new Iu,Promise.resolve()},ku.prototype.handleUserChange=function(e,t,n){},ku.prototype.setOnlineState=function(e){},ku.prototype.shutdown=function(){},ku.prototype.writeSequenceNumber=function(e){},ku);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ku(){this.localState=new Iu,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var Mu="FirestoreClient",Ru=(Ou.prototype.lruParams=function(){return xi.withCacheSize(this.cacheSizeBytes)},Ou);function Ou(e,t){this.cacheSizeBytes=e,this.synchronizeTabs=t}var Lu=function(){},Pu=(xu.prototype.start=function(e){var n=this;this.verifyNotTerminated();var r=new Ae,i=new Ae,o=!1;return this.credentials.setChangeListener(function(t){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(t)}):(o=!0,n.initializePersistence(e,i,t).then(function(e){return n.initializeRest(t,e)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},xu.prototype.enableNetwork=function(){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.syncEngine.enableNetwork()})},xu.prototype.initializePersistence=function(e,t,n){var r=this;return e instanceof Ru?this.startIndexedDbPersistence(n,e).then(function(e){return t.resolve(),e}).catch(function(e){if(t.reject(e),!r.canFallback(e))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.startMemoryPersistence()}):(t.resolve(),this.startMemoryPersistence())},xu.prototype.canFallback=function(e){return e instanceof I?e.code===E.FAILED_PRECONDITION||e.code===E.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code},xu.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new I(E.FAILED_PRECONDITION,"The client has already been terminated.")},xu.prototype.startIndexedDbPersistence=function(r,i){var e=this,o=Ji.buildStoragePrefix(this.databaseInfo),a=new Bs(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return m.__awaiter(e,void 0,void 0,function(){var t,n;return m.__generator(this,function(e){switch(e.label){case 0:if(i.synchronizeTabs&&!Du.isAvailable(this.platform))throw new I(E.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return t=i.lruParams(),this.sharedClientState=i.synchronizeTabs?new Du(this.asyncQueue,this.platform,o,this.clientId,r):new Nu,[4,Ji.createIndexedDbPersistence({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:a,lruParams:t,sequenceNumberSyncer:this.sharedClientState})];case 1:return n=e.sent(),[2,(this.persistence=n).referenceDelegate.garbageCollector]}})})})},xu.prototype.startMemoryPersistence=function(){return this.persistence=ha.createEagerPersistence(this.clientId),this.sharedClientState=new Nu,Promise.resolve(null)},xu.prototype.initializeRest=function(c,h){var e=this;return y(Mu,"Initializing. user=",c.uid),this.platform.loadConnection(this.databaseInfo).then(function(u){return m.__awaiter(e,void 0,void 0,function(){var t,n,r,i,o,a,s=this;return m.__generator(this,function(e){switch(e.label){case 0:return t=new Qo,this.localStore=new ea(this.persistence,t,c),[4,this.localStore.start()];case 1:return e.sent(),h&&(this.lruScheduler=new qi(h,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),r=this.platform.newSerializer(this.databaseInfo.databaseId),i=new Ra(this.asyncQueue,u,this.credentials,r),o=function(e){return s.syncEngine.applyOnlineStateChange(e,xa.RemoteStore)},a=function(e){return s.syncEngine.applyOnlineStateChange(e,xa.SharedClientState)},this.remoteStore=new vs(this.localStore,i,this.asyncQueue,o,n),this.syncEngine=new iu(this.localStore,this.remoteStore,this.sharedClientState,c),this.sharedClientState.onlineStateHandler=a,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new Ks(this.syncEngine),[4,this.sharedClientState.start()];case 2:return e.sent(),[4,this.remoteStore.start()];case 3:return e.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return m.__awaiter(s,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 4:return e.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return m.__awaiter(s,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return[4,this.terminate()];case 1:return e.sent(),[2]}})})})];case 5:return e.sent(),[2]}})})})},xu.prototype.handleCredentialChange=function(e){return this.asyncQueue.verifyOperationInProgress(),y(Mu,"Credential Changed. Current user: "+e.uid),this.syncEngine.handleCredentialChange(e)},xu.prototype.disableNetwork=function(){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.syncEngine.disableNetwork()})},xu.prototype.terminate=function(){var e=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return m.__awaiter(e,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return e.sent(),[4,this.sharedClientState.shutdown()];case 2:return e.sent(),[4,this.persistence.shutdown()];case 3:return e.sent(),this.credentials.removeChangeListener(),[2]}})})})},xu.prototype.waitForPendingWrites=function(){var e=this;this.verifyNotTerminated();var t=new Ae;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.registerPendingWritesCallback(t)}),t.promise},xu.prototype.listen=function(e,t,n){var r=this;this.verifyNotTerminated();var i=new Gs(e,t,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},xu.prototype.unlisten=function(e){var t=this;this.clientTerminated||this.asyncQueue.enqueueAndForget(function(){return t.eventMgr.unlisten(e)})},xu.prototype.getDocumentFromLocalCache=function(e){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.localStore.readDocument(e)}).then(function(e){if(e instanceof wr)return e;if(e instanceof _r)return null;throw new I(E.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},xu.prototype.getDocumentsFromLocalCache=function(i){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return m.__awaiter(e,void 0,void 0,function(){var t,n,r;return m.__generator(this,function(e){switch(e.label){case 0:return[4,this.localStore.executeQuery(i,!0)];case 1:return t=e.sent(),n=new Xs(i,t.remoteKeys),r=n.computeDocChanges(t.documents),[2,n.applyChanges(r,!1).snapshot]}})})})},xu.prototype.write=function(e){var t=this;this.verifyNotTerminated();var n=new Ae;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.write(e,n)}),n.promise},xu.prototype.databaseId=function(){return this.databaseInfo.databaseId},xu.prototype.addSnapshotsInSyncListener=function(e){var t=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget(function(){return t.eventMgr.addSnapshotsInSyncListener(e),Promise.resolve()})},xu.prototype.removeSnapshotsInSyncListener=function(e){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(e)},Object.defineProperty(xu.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),xu.prototype.transaction=function(e){var t=this;this.verifyNotTerminated();var n=new Ae;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.runTransaction(t.asyncQueue,e,n),Promise.resolve()}),n.promise},xu);function xu(e,t,n,r){this.platform=e,this.databaseInfo=t,this.credentials=n,this.asyncQueue=r,this.clientId=$.newId()}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fu=(qu.prototype.next=function(e){this.scheduleEvent(this.observer.next,e)},qu.prototype.error=function(e){this.scheduleEvent(this.observer.error,e)},qu.prototype.mute=function(){this.muted=!0},qu.prototype.scheduleEvent=function(e,t){var n=this;this.muted||setTimeout(function(){n.muted||e(t)},0)},qu);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qu(e){this.observer=e,this.muted=!1}var Vu=(Bu.documentId=function(){return Bu._DOCUMENT_ID},Bu.prototype.isEqual=function(e){if(!(e instanceof Bu))throw H("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},Bu._DOCUMENT_ID=new Bu(Se.keyField().canonicalString()),Bu);function Bu(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];!function(e,t,n,r){if(!(t instanceof Array)||t.length<r)throw new I(E.INVALID_ARGUMENT,"Function "+e+"() requires its "+n+" argument to be an array with at least "+X(r,"element")+".")}("FieldPath",e,"fieldNames",1);for(var n=0;n<e.length;++n)if(F("FieldPath","string",n,e[n]),0===e[n].length)throw new I(E.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Se(e)}var Uu=new RegExp("[~\\*/\\[\\]]");
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ju=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},Ku=(Wu.prototype.getToken=function(){return Promise.resolve(null)},Wu.prototype.invalidateToken=function(){},Wu.prototype.setChangeListener=function(e){v(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=e)(au.UNAUTHENTICATED)},Wu.prototype.removeChangeListener=function(){v(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},Wu);function Wu(){this.changeListener=null}var Gu=(Qu.prototype.getToken=function(){var t=this;v(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(function(e){if(t.tokenCounter!==n)throw new I(E.ABORTED,"getToken aborted due to token change.");return e?(v("string"==typeof e.accessToken,"Invalid tokenData returned from getToken():"+e),new ju(e.accessToken,t.currentUser)):null}):Promise.resolve(null)},Qu.prototype.invalidateToken=function(){this.forceRefresh=!0},Qu.prototype.setChangeListener=function(e){v(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=e,this.receivedInitialUser&&e(this.currentUser)},Qu.prototype.removeChangeListener=function(){v(null!=this.tokenListener,"removeChangeListener() called twice"),v(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},Qu.prototype.getUser=function(){var e=this.auth&&this.auth.getUid();return v(null===e||"string"==typeof e,"Received invalid UID: "+e),new au(e)},Qu);function Qu(e){var t=this;this.tokenListener=null,this.currentUser=au.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){t.tokenCounter++,t.currentUser=t.getUser(),t.receivedInitialUser=!0,t.changeListener&&t.changeListener(t.currentUser)},this.tokenCounter=0,this.auth=e.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),e.get().then(function(e){t.auth=e,t.tokenListener&&t.auth.addAuthTokenListener(t.tokenListener)},function(){}))}var zu=(Object.defineProperty(Hu.prototype,"authHeaders",{get:function(){var e={"X-Goog-AuthUser":this.sessionIndex},t=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),e},enumerable:!0,configurable:!0}),Hu);function Hu(e,t){this.gapi=e,this.sessionIndex=t,this.type="FirstParty",this.user=au.FIRST_PARTY}var Yu=(Ju.prototype.getToken=function(){return Promise.resolve(new zu(this.gapi,this.sessionIndex))},Ju.prototype.setChangeListener=function(e){e(au.FIRST_PARTY)},Ju.prototype.removeChangeListener=function(){},Ju.prototype.invalidateToken=function(){},Ju);function Ju(e,t){this.gapi=e,this.sessionIndex=t}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xu(e){return function(e,t){if("object"!==(void 0===e?"undefined":l(e))||null===e)return!1;for(var n=e,r=0,i=t;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,["next","error","complete"])}var $u=(Zu.delete=function(){return O("FieldValue.delete",arguments),tc.instance},Zu.serverTimestamp=function(){return O("FieldValue.serverTimestamp",arguments),ic.instance},Zu.arrayUnion=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return P("FieldValue.arrayUnion",arguments,1),new sc(e)},Zu.arrayRemove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return P("FieldValue.arrayRemove",arguments,1),new hc(e)},Zu.increment=function(e){return F("FieldValue.increment","number",1,e),L("FieldValue.increment",arguments,1),new dc(e)},Zu.prototype.isEqual=function(e){return this===e},Zu);function Zu(e){this._methodName=e}var ec,tc=(ec=$u,m.__extends(nc,ec),nc.instance=new nc,nc);function nc(){return ec.call(this,"FieldValue.delete")||this}var rc,ic=(rc=$u,m.__extends(oc,rc),oc.instance=new oc,oc);function oc(){return rc.call(this,"FieldValue.serverTimestamp")||this}var ac,sc=(ac=$u,m.__extends(uc,ac),uc);function uc(e){var t=ac.call(this,"FieldValue.arrayUnion")||this;return t._elements=e,t}var cc,hc=(cc=$u,m.__extends(lc,cc),lc);function lc(e){var t=cc.call(this,"FieldValue.arrayRemove")||this;return t._elements=e,t}var fc,dc=(fc=$u,m.__extends(pc,fc),pc);function pc(e){var t=fc.call(this,"FieldValue.increment")||this;return t._operand=e,t}var mc=D($u,"Use FieldValue.<field>() instead."),gc=/^__.*__$/,yc=(vc.prototype.toMutations=function(e,t){var n=[];return null!==this.fieldMask?n.push(new fn(e,this.data,this.fieldMask,t)):n.push(new cn(e,this.data,t)),0<this.fieldTransforms.length&&n.push(new mn(e,this.fieldTransforms)),n},vc);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vc(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}var bc,wc,Tc=(Sc.prototype.toMutations=function(e,t){var n=[new fn(e,this.data,this.fieldMask,t)];return 0<this.fieldTransforms.length&&n.push(new mn(e,this.fieldTransforms)),n},Sc);function Sc(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}function _c(e){switch(e){case bc.Set:case bc.MergeSet:case bc.Update:return 1;case bc.Argument:case bc.ArrayArgument:return;default:throw w("Unexpected case for UserDataSource: "+e)}}(wc=bc=bc||{})[wc.Set=0]="Set",wc[wc.Update=1]="Update",wc[wc.MergeSet=2]="MergeSet",wc[wc.Argument=3]="Argument",wc[wc.ArrayArgument=4]="ArrayArgument";var Ec=(Ic.prototype.childContextForField=function(e){var t=null==this.path?null:this.path.child(e),n=new Ic(this.dataSource,this.methodName,t,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(e),n},Ic.prototype.childContextForFieldPath=function(e){var t=null==this.path?null:this.path.child(e),n=new Ic(this.dataSource,this.methodName,t,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},Ic.prototype.childContextForArray=function(e){return new Ic(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},Ic.prototype.createError=function(e){var t=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new I(E.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+e+t)},Ic.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},Ic.prototype.validatePath=function(){if(null!==this.path)for(var e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))},Ic.prototype.validatePathSegment=function(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(_c(this.dataSource)&&gc.test(e))throw this.createError('Document fields cannot begin and end with "__"')},Ic);function Ic(e,t,n,r,i,o){this.dataSource=e,this.methodName=t,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var Cc=function(e,t){this.databaseId=e,this.key=t},Dc=(Ac.prototype.parseSetData=function(e,t){var n=new Ec(bc.Set,e,Se.EMPTY_PATH);kc("Data must be an object, but it was:",n,t);var r=this.parseData(t,n);return new yc(r,null,n.fieldTransforms)},Ac.prototype.parseMergeData=function(e,t,n){var r=new Ec(bc.MergeSet,e,Se.EMPTY_PATH);kc("Data must be an object, but it was:",r,t);var i,o,a=this.parseData(t,r);if(n){for(var s=new Ze(Se.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof Vu)l=h._internalPath;else{if("string"!=typeof h)throw w("Expected stringOrFieldPath to be a string or a FieldPath");l=Rc(e,h)}if(!r.contains(l))throw new I(E.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=Jt.fromSet(s),o=r.fieldTransforms.filter(function(e){return i.covers(e.field)})}else i=Jt.fromArray(r.fieldMask),o=r.fieldTransforms;return new yc(a,i,o)},Ac.prototype.parseUpdateData=function(o,e){var a=this,s=new Ec(bc.Update,o,Se.EMPTY_PATH);kc("Data must be an object, but it was:",s,e);var u=new Ze(Se.comparator),c=fr.EMPTY;M(e,function(e,t){var n=Rc(o,e),r=s.childContextForFieldPath(n);if((t=a.runPreConverter(t,r))instanceof tc)u=u.add(n);else{var i=a.parseData(t,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var t=Jt.fromSet(u);return new Tc(c,t,s.fieldTransforms)},Ac.prototype.parseUpdateVarargs=function(e,t,n,r){var i=new Ec(bc.Update,e,Se.EMPTY_PATH),o=[Mc(e,t)],a=[n];if(r.length%2!=0)throw new I(E.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(Mc(e,r[s])),a.push(r[s+1]);var u=new Ze(Se.comparator),c=fr.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof tc)u=u.add(h);else{var d=this.parseData(f,l);null!=d&&(u=u.add(h),c=c.set(h,d))}}var p=Jt.fromSet(u);return new Tc(c,p,i.fieldTransforms)},Ac.prototype.parseQueryValue=function(e,t,n){void 0===n&&(n=!1);var r=new Ec(n?bc.ArrayArgument:bc.Argument,e,Se.EMPTY_PATH),i=this.parseData(t,r);return v(null!=i,"Parsed data should not be null."),v(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},Ac.prototype.runPreConverter=function(e,t){try{return this.preConverter(e)}catch(e){var n=Oc(e);throw t.createError(n)}},Ac.prototype.parseData=function(e,t){if(Nc(e=this.runPreConverter(e,t)))return kc("Unsupported field value:",t,e),this.parseObject(e,t);if(e instanceof $u)return this.parseSentinelFieldValue(e,t),null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.arrayElement&&t.dataSource!==bc.ArrayArgument)throw t.createError("Nested arrays are not supported");return this.parseArray(e,t)}return this.parseScalarValue(e,t)},Ac.prototype.parseObject=function(e,r){var i=this,o=new Ge(ee);return R(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):M(e,function(e,t){var n=i.parseData(t,r.childContextForField(e));null!=n&&(o=o.insert(e,n))}),new fr(o)},Ac.prototype.parseArray=function(e,t){for(var n=[],r=0,i=0,o=e;i<o.length;i++){var a=o[i],s=this.parseData(a,t.childContextForArray(r));null==s&&(s=Rn.INSTANCE),n.push(s),r++}return new mr(n)},Ac.prototype.parseSentinelFieldValue=function(e,t){if(!_c(t.dataSource))throw t.createError(e._methodName+"() can only be used with update() and set()");if(null===t.path)throw t.createError(e._methodName+"() is not currently supported inside arrays");if(e instanceof tc){if(t.dataSource!==bc.MergeSet)throw t.dataSource===bc.Update?(v(0<t.path.length,"FieldValue.delete() at the top level should have already been handled."),t.createError("FieldValue.delete() can only appear at the top level of your update data")):t.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");t.fieldMask.push(t.path)}else if(e instanceof ic)t.fieldTransforms.push(new $t(t.path,Ss.instance));else if(e instanceof sc){var n=this.parseArrayTransformElements(e._methodName,e._elements),r=new Es(n);t.fieldTransforms.push(new $t(t.path,r))}else if(e instanceof hc){n=this.parseArrayTransformElements(e._methodName,e._elements);var i=new Cs(n);t.fieldTransforms.push(new $t(t.path,i))}else if(e instanceof dc){var o=this.parseQueryValue("FieldValue.increment",e._operand),a=new As(o);t.fieldTransforms.push(new $t(t.path,a))}else w("Unknown FieldValue type: "+e)},Ac.prototype.parseScalarValue=function(e,t){if(null===e)return Rn.INSTANCE;if("number"==typeof e)return new(co(e)?jn:Gn)(e);if("boolean"==typeof e)return Pn.of(e);if("string"==typeof e)return new Hn(e);if(e instanceof Date)return new Xn(Ue.fromDate(e));if(e instanceof Ue)return new Xn(new Ue(e.seconds,1e3*Math.floor(e.nanoseconds/1e3)));if(e instanceof ws)return new cr(e);if(e instanceof oe)return new rr(e);if(e instanceof Cc)return new ar(e.databaseId,e.key);throw t.createError("Unsupported field value: "+G(e))},Ac.prototype.parseArrayTransformElements=function(r,e){var i=this;return e.map(function(e,t){var n=new Ec(bc.Argument,r,Se.EMPTY_PATH);return i.parseData(e,n.childContextForArray(t))})},Ac);function Ac(e){this.preConverter=e}function Nc(e){return!("object"!==(void 0===e?"undefined":l(e))||null===e||e instanceof Array||e instanceof Date||e instanceof Ue||e instanceof ws||e instanceof oe||e instanceof Cc||e instanceof $u)}function kc(e,t,n){if(!Nc(n)||!W(n)){var r=G(n);throw"an object"===r?t.createError(e+" a custom object"):t.createError(e+" "+r)}}function Mc(e,t){if(t instanceof Vu)return t._internalPath;if("string"==typeof t)return Rc(e,t);throw new I(E.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Rc(t,e){try{return function(t){if(0<=t.search(Uu))throw new I(E.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Vu.bind.apply(Vu,m.__spreadArrays([void 0],t.split("."))))}catch(e){throw new I(E.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=Oc(e);throw new I(E.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Oc(e){return e instanceof Error?e.message:e.toString()}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lc=xi.COLLECTION_DISABLED,Pc=(xc.prototype.isEqual=function(e){return this.host===e.host&&this.ssl===e.ssl&&this.timestampsInSnapshots===e.timestampsInSnapshots&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.forceLongPolling===e.forceLongPolling},xc);function xc(e){if(void 0===e.host){if(void 0!==e.ssl)throw new I(E.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else V("settings","non-empty string","host",e.host),this.host=e.host,B("settings","boolean","ssl",e.ssl),this.ssl=N(e.ssl,!0);if(z("settings",e,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),B("settings","object","credentials",e.credentials),this.credentials=e.credentials,B("settings","boolean","timestampsInSnapshots",e.timestampsInSnapshots),!0===e.timestampsInSnapshots?c("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===e.timestampsInSnapshots&&c("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=N(e.timestampsInSnapshots,!0),B("settings","number","cacheSizeBytes",e.cacheSizeBytes),void 0===e.cacheSizeBytes)this.cacheSizeBytes=xi.DEFAULT_CACHE_SIZE_BYTES;else{if(e.cacheSizeBytes!==Lc&&e.cacheSizeBytes<xi.MINIMUM_CACHE_SIZE_BYTES)throw new I(E.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+xi.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=e.cacheSizeBytes}B("settings","boolean","experimentalForceLongPolling",e.experimentalForceLongPolling),this.forceLongPolling=void 0!==e.experimentalForceLongPolling&&e.experimentalForceLongPolling}var Fc=(qc.prototype.settings=function(e){if(L("Firestore.settings",arguments,1),F("Firestore.settings","object",1,e),A(e,"persistence"))throw new I(E.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var t=new Pc(e);if(this._firestoreClient&&!this._settings.isEqual(t))throw new I(E.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=t).credentials&&(this._credentials=function(e){if(!e)return new Ku;switch(e.type){case"gapi":var t=e.client;return v(!("object"!==(void 0===t?"undefined":l(t))||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new Yu(t,e.sessionIndex||"0");case"provider":return e.client;default:throw new I(E.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},qc.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},qc.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},qc.prototype.enablePersistence=function(e){if(this._firestoreClient)throw new I(E.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var t=!1;return e&&(void 0!==e.experimentalTabSynchronization&&c("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),t=N(void 0!==e.synchronizeTabs?e.synchronizeTabs:e.experimentalTabSynchronization,!1)),this.configureClient(new Ru(this._settings.cacheSizeBytes,t))},qc.prototype.clearPersistence=function(){var e=this,n=Ji.buildStoragePrefix(this.makeDatabaseInfo()),r=new Ae;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return m.__awaiter(e,void 0,void 0,function(){var t;return m.__generator(this,function(e){switch(e.label){case 0:if(e.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new I(E.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Ji.clearPersistence(n)];case 1:return e.sent(),r.resolve(),[3,3];case 2:return t=e.sent(),r.reject(t),[3,3];case 3:return[2]}})})}),r.promise},qc.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(qc.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),qc.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},qc.prototype.onSnapshotsInSync=function(e){if(this.ensureClientConfigured(),Xu(e))return this.onSnapshotsInSyncInternal(e);F("Firestore.onSnapshotsInSync","function",1,e);var t={next:e};return this.onSnapshotsInSyncInternal(t)},qc.prototype.onSnapshotsInSyncInternal=function(e){var t=this,n=new Fu({next:function(){e.next&&e.next()},error:function(){throw w("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),t._firestoreClient.removeSnapshotsInSyncListener(n)}},qc.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new Lu),this._firestoreClient},qc.prototype.makeDatabaseInfo=function(){return new ue(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},qc.prototype.configureClient=function(e){v(!!this._settings.host,"FirestoreSettings.host is not set"),v(!this._firestoreClient,"configureClient() called multiple times");var t=this.makeDatabaseInfo();return this._firestoreClient=new Pu(b.getPlatform(),t,this._credentials,this._queue),this._firestoreClient.start(e)},qc.prototype.createDataConverter=function(r){return new Dc(function(e){if(e instanceof Kc){var t=r,n=e.firestore._databaseId;if(!n.isEqual(t))throw new I(E.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+t.projectId+"/"+t.database);return new Cc(r,e._key)}return e})},qc.databaseIdFromApp=function(e){var t=e.options;if(!A(t,"projectId"))throw new I(E.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=t.projectId;if(!n||"string"!=typeof n)throw new I(E.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new he(n)},Object.defineProperty(qc.prototype,"app",{get:function(){if(!this._firebaseApp)throw new I(E.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),qc.prototype.collection=function(e){return L("Firestore.collection",arguments,1),F("Firestore.collection","non-empty string",1,e),this.ensureClientConfigured(),new rh(ve.fromString(e),this)},qc.prototype.doc=function(e){return L("Firestore.doc",arguments,1),F("Firestore.doc","non-empty string",1,e),this.ensureClientConfigured(),Kc.forPath(ve.fromString(e),this)},qc.prototype.collectionGroup=function(e){if(L("Firestore.collectionGroup",arguments,1),F("Firestore.collectionGroup","non-empty string",1,e),0<=e.indexOf("/"))throw new I(E.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new $c(new mo(ve.EMPTY_PATH,e),this)},qc.prototype.runTransaction=function(t){var n=this;return L("Firestore.runTransaction",arguments,1),F("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(e){return t(new Vc(n,e))})},qc.prototype.batch=function(){return this.ensureClientConfigured(),new Uc(this)},Object.defineProperty(qc,"logLevel",{get:function(){switch(g()){case f.DEBUG:return"debug";case f.ERROR:return"error";case f.SILENT:return"silent";default:return w("Unknown log level: "+g())}},enumerable:!0,configurable:!0}),qc.setLogLevel=function(e){switch(L("Firestore.setLogLevel",arguments,1),F("Firestore.setLogLevel","non-empty string",1,e),e){case"debug":u(f.DEBUG);break;case"error":u(f.ERROR);break;case"silent":u(f.SILENT);break;default:throw new I(E.INVALID_ARGUMENT,"Invalid log level: "+e)}},qc.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},qc);function qc(e,t){var n=this;if(this._firebaseApp=null,this._queue=new Me,this.INTERNAL={delete:function(){return m.__awaiter(n,void 0,void 0,function(){return m.__generator(this,function(e){switch(e.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return e.sent(),[2]}})})}},"object"===l(e.options)){var r=e;this._firebaseApp=r,this._databaseId=qc.databaseIdFromApp(r),this._persistenceKey=r.name,this._credentials=new Gu(t)}else{var i=e;if(!i.projectId)throw new I(E.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new he(i.projectId,i.database),this._persistenceKey="[DEFAULT]",this._credentials=new Ku}this._settings=new Pc({}),this._dataConverter=this.createDataConverter(this._databaseId)}var Vc=(Bc.prototype.get=function(e){var n=this;L("Transaction.get",arguments,1);var r=uh("Transaction.get",e,this._firestore);return this._transaction.lookup([r._key]).then(function(e){if(!e||1!==e.length)return w("Mismatch in docs returned from document lookup.");var t=e[0];if(t instanceof _r)return new zc(n._firestore,r._key,null,!1,!1,r._converter);if(t instanceof wr)return new zc(n._firestore,r._key,t,!1,!1,r._converter);throw w("BatchGetDocumentsRequest returned unexpected document type: "+t.constructor.name)})},Bc.prototype.set=function(e,t,n){x("Transaction.set",arguments,2,3);var r=uh("Transaction.set",e,this._firestore);n=oh("Transaction.set",n);var i=ch(r._converter,t,"Transaction.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._transaction.set(r._key,s),this},Bc.prototype.update=function(e,t,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof t||t instanceof Vu?(P("Transaction.update",arguments,3),r=uh("Transaction.update",e,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",t,n,o)):(L("Transaction.update",arguments,2),r=uh("Transaction.update",e,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",t)),this._transaction.update(r._key,i),this},Bc.prototype.delete=function(e){L("Transaction.delete",arguments,1);var t=uh("Transaction.delete",e,this._firestore);return this._transaction.delete(t._key),this},Bc);function Bc(e,t){this._firestore=e,this._transaction=t}var Uc=(jc.prototype.set=function(e,t,n){x("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=uh("WriteBatch.set",e,this._firestore);n=oh("WriteBatch.set",n);var i=ch(r._converter,t,"WriteBatch.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._mutations=this._mutations.concat(s.toMutations(r._key,rn.NONE)),this},jc.prototype.update=function(e,t,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof t||t instanceof Vu?(P("WriteBatch.update",arguments,3),r=uh("WriteBatch.update",e,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",t,n,o)):(L("WriteBatch.update",arguments,2),r=uh("WriteBatch.update",e,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",t)),this._mutations=this._mutations.concat(i.toMutations(r._key,rn.exists(!0))),this},jc.prototype.delete=function(e){L("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var t=uh("WriteBatch.delete",e,this._firestore);return this._mutations=this._mutations.concat(new vn(t._key,rn.NONE)),this},jc.prototype.commit=function(){return m.__awaiter(this,void 0,void 0,function(){return m.__generator(this,function(e){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},jc.prototype.verifyNotCommitted=function(){if(this._committed)throw new I(E.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},jc);function jc(e){this._firestore=e,this._mutations=[],this._committed=!1}var Kc=(Wc.forPath=function(e,t,n){if(e.length%2!=0)throw new I(E.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new Wc(new Ee(e),t,n)},Object.defineProperty(Wc.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(Wc.prototype,"parent",{get:function(){return new rh(this._key.path.popLast(),this.firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(Wc.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),Wc.prototype.collection=function(e){if(L("DocumentReference.collection",arguments,1),F("DocumentReference.collection","non-empty string",1,e),!e)throw new I(E.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var t=ve.fromString(e);return new rh(this._key.path.child(t),this.firestore)},Wc.prototype.isEqual=function(e){if(!(e instanceof Wc))throw H("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)&&this._converter===e._converter},Wc.prototype.set=function(e,t){x("DocumentReference.set",arguments,1,2),t=oh("DocumentReference.set",t);var n=ch(this._converter,e,"DocumentReference.set"),r=n[0],i=n[1],o=t.merge||t.mergeFields?this.firestore._dataConverter.parseMergeData(i,r,t.mergeFields):this.firestore._dataConverter.parseSetData(i,r);return this._firestoreClient.write(o.toMutations(this._key,rn.NONE))},Wc.prototype.update=function(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof e||e instanceof Vu?(P("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",e,t,r)):(L("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",e)),this._firestoreClient.write(n.toMutations(this._key,rn.exists(!0)))},Wc.prototype.delete=function(){return L("DocumentReference.delete",arguments,0),this._firestoreClient.write([new vn(this._key,rn.NONE)])},Wc.prototype.onSnapshot=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];x("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!==l(e[i])||Xu(e[i])||(z("DocumentReference.onSnapshot",r=e[i],["includeMetadataChanges"]),B("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=Xu(e[i])?e[i]:(F("DocumentReference.onSnapshot","function",i,e[i]),q("DocumentReference.onSnapshot","function",i+1,e[i+1]),q("DocumentReference.onSnapshot","function",i+2,e[i+2]),{next:e[i],error:e[i+1],complete:e[i+2]}),this.onSnapshotInternal(o,n)},Wc.prototype.onSnapshotInternal=function(e,n){var r=this,t=function(e){console.error("Uncaught Error in onSnapshot:",e)};n.error&&(t=n.error.bind(n));var i=new Fu({next:function(e){if(n.next){v(e.docs.size<=1,"Too many documents returned on a document query");var t=e.docs.get(r._key);n.next(new zc(r.firestore,r._key,t,e.fromCache,e.hasPendingWrites,r._converter))}},error:t}),o=this._firestoreClient.listen(mo.atPath(this._key.path),i,e);return function(){i.mute(),r._firestoreClient.unlisten(o)}},Wc.prototype.get=function(n){var r=this;return x("DocumentReference.get",arguments,0,1),sh("DocumentReference.get",n),new Promise(function(t,e){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(e){t(new zc(r.firestore,r._key,e,!0,e instanceof wr&&e.hasLocalMutations,r._converter))},e):r.getViaSnapshotListener(t,e,n)})},Wc.prototype.getViaSnapshotListener=function(t,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(e){i(),!e.exists&&e.metadata.fromCache?n(new I(E.UNAVAILABLE,"Failed to get document because the client is offline.")):e.exists&&e.metadata.fromCache&&r&&"server"===r.source?n(new I(E.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(e)},error:n})},Wc.prototype.withConverter=function(e){return new Wc(this._key,this.firestore,e)},Wc);function Wc(e,t,n){this._key=e,this.firestore=t,this._converter=n,this._firestoreClient=this.firestore.ensureClientConfigured()}var Gc=(Qc.prototype.isEqual=function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache},Qc);function Qc(e,t){this.hasPendingWrites=e,this.fromCache=t}var zc=(Hc.prototype.data=function(e){if(x("DocumentSnapshot.data",arguments,0,1),e=ah("DocumentSnapshot.data",e),this._document){if(this._converter){var t=new Jc(this._firestore,this._key,this._document,this._fromCache,this._hasPendingWrites);return this._converter.fromFirestore(t,e)}return this.toJSObject(this._document.data(),Dn.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Hc.prototype.get=function(e,t){if(x("DocumentSnapshot.get",arguments,1,2),t=ah("DocumentSnapshot.get",t),this._document){var n=this._document.data().field(Mc("DocumentSnapshot.get",e));if(null!==n)return this.toJSValue(n,Dn.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(Hc.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(Hc.prototype,"ref",{get:function(){return new Kc(this._key,this._firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(Hc.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(Hc.prototype,"metadata",{get:function(){return new Gc(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),Hc.prototype.isEqual=function(e){if(!(e instanceof Hc))throw H("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))&&this._converter===e._converter},Hc.prototype.toJSObject=function(e,n){var r=this,i={};return e.forEach(function(e,t){i[e]=r.toJSValue(t,n)}),i},Hc.prototype.toJSValue=function(e,t){if(e instanceof fr)return this.toJSObject(e,t);if(e instanceof mr)return this.toJSArray(e,t);if(e instanceof ar){var n=e.value(t),r=this._firestore.ensureClientConfigured().databaseId();return e.databaseId.isEqual(r)||c("Document "+this._key.path+" contains a document reference within a different database ("+e.databaseId.projectId+"/"+e.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Kc(n,this._firestore,this._converter)}return e.value(t)},Hc.prototype.toJSArray=function(e,t){var n=this;return e.internalValue.map(function(e){return n.toJSValue(e,t)})},Hc);function Hc(e,t,n,r,i,o){this._firestore=e,this._key=t,this._document=n,this._fromCache=r,this._hasPendingWrites=i,this._converter=o}var Yc,Jc=(Yc=zc,m.__extends(Xc,Yc),Xc.prototype.data=function(e){var t=Yc.prototype.data.call(this,e);return v(void 0!==t,"Document in a QueryDocumentSnapshot should exist"),t},Xc);function Xc(){return null!==Yc&&Yc.apply(this,arguments)||this}var $c=(Zc.prototype.where=function(e,t,n){var r;L("Query.where",arguments,3),Q("Query.where",3,n),function(e,t,n,r){if(!t.some(function(e){return e===r}))throw new I(E.INVALID_ARGUMENT,"Invalid value "+G(r)+" provided to function "+e+"() for its "+J(n)+" argument. Acceptable values: "+t.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,t);var i=Mc("Query.where",e),o=vo.fromString(t);if(i.isKeyField()){if(o===vo.ARRAY_CONTAINS||o===vo.ARRAY_CONTAINS_ANY)throw new I(E.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===vo.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new mr(a)}else r=this.parseDocumentIdValue(n)}else o!==vo.IN&&o!==vo.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n,o===vo.IN);var h=To.create(i,o,r);return this.validateNewFilter(h),new Zc(this._query.addFilter(h),this.firestore,this._converter)},Zc.prototype.orderBy=function(e,t){var n;if(x("Query.orderBy",arguments,1,2),q("Query.orderBy","non-empty string",2,t),void 0===t||"asc"===t)n=qo.ASCENDING;else{if("desc"!==t)throw new I(E.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+t+"', expected 'asc' or 'desc'.");n=qo.DESCENDING}if(null!==this._query.startAt)throw new I(E.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new I(E.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Mc("Query.orderBy",e),i=new jo(r,n);return this.validateNewOrderBy(i),new Zc(this._query.addOrderBy(i),this.firestore,this._converter)},Zc.prototype.limit=function(e){return L("Query.limit",arguments,1),F("Query.limit","number",1,e),Y("Query.limit",1,e),new Zc(this._query.withLimitToFirst(e),this.firestore,this._converter)},Zc.prototype.limitToLast=function(e){return L("Query.limitToLast",arguments,1),F("Query.limitToLast","number",1,e),Y("Query.limitToLast",1,e),new Zc(this._query.withLimitToLast(e),this.firestore,this._converter)},Zc.prototype.startAt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];P("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",e,t,!0);return new Zc(this._query.withStartAt(r),this.firestore,this._converter)},Zc.prototype.startAfter=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];P("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",e,t,!1);return new Zc(this._query.withStartAt(r),this.firestore,this._converter)},Zc.prototype.endBefore=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];P("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",e,t,!0);return new Zc(this._query.withEndAt(r),this.firestore,this._converter)},Zc.prototype.endAt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];P("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",e,t,!1);return new Zc(this._query.withEndAt(r),this.firestore,this._converter)},Zc.prototype.isEqual=function(e){if(!(e instanceof Zc))throw H("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},Zc.prototype.withConverter=function(e){return new Zc(this._query,this.firestore,e)},Zc.prototype.boundFromDocOrFields=function(e,t,n,r){if(Q(e,1,t),t instanceof zc){if(0<n.length)throw new I(E.INVALID_ARGUMENT,"Too many arguments provided to "+e+"().");var i=t;if(!i.exists)throw new I(E.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+e+"().");return this.boundFromDocument(e,i._document,r)}var o=[t].concat(n);return this.boundFromFields(e,o,r)},Zc.prototype.boundFromDocument=function(e,t,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new ar(this.firestore._databaseId,t.key));else{var s=t.field(a.field);if(s instanceof er)throw new I(E.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new I(E.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new Bo(r,n)},Zc.prototype.boundFromFields=function(e,t,n){var r=this._query.explicitOrderBy;if(t.length>r.length)throw new I(E.INVALID_ARGUMENT,"Too many arguments provided to "+e+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<t.length;o++){var a=t[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new I(E.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+e+"(), but got a "+(void 0===a?"undefined":l(a)));if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new I(E.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+e+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(ve.fromString(a));if(!Ee.isDocumentKey(s))throw new I(E.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+e+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Ee(s);i.push(new ar(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(e,a);i.push(c)}}return new Bo(i,n)},Zc.prototype.onSnapshot=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];x("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!==l(e[i])||Xu(e[i])||(z("Query.onSnapshot",r=e[i],["includeMetadataChanges"]),B("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=Xu(e[i])?e[i]:(F("Query.onSnapshot","function",i,e[i]),q("Query.onSnapshot","function",i+1,e[i+1]),q("Query.onSnapshot","function",i+2,e[i+2]),{next:e[i],error:e[i+1],complete:e[i+2]}),this.validateHasExplicitOrderByForLimitToLast(this._query),this.onSnapshotInternal(r,n)},Zc.prototype.onSnapshotInternal=function(e,t){var n=this,r=function(e){console.error("Uncaught Error in onSnapshot:",e)};t.error&&(r=t.error.bind(t));var i=new Fu({next:function(e){t.next&&t.next(new eh(n.firestore,n._query,e,n._converter))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,e);return function(){i.mute(),o.unlisten(a)}},Zc.prototype.validateHasExplicitOrderByForLimitToLast=function(e){if(e.hasLimitToLast()&&0===e.explicitOrderBy.length)throw new I(E.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},Zc.prototype.get=function(n){var r=this;return x("Query.get",arguments,0,1),sh("Query.get",n),this.validateHasExplicitOrderByForLimitToLast(this._query),new Promise(function(t,e){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(e){t(new eh(r.firestore,r._query,e,r._converter))},e):r.getViaSnapshotListener(t,e,n)})},Zc.prototype.getViaSnapshotListener=function(t,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(e){i(),e.metadata.fromCache&&r&&"server"===r.source?n(new I(E.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(e)},error:n})},Zc.prototype.parseDocumentIdValue=function(e){if("string"==typeof e){if(""===e)throw new I(E.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==e.indexOf("/"))throw new I(E.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+e+"' contains a '/' character.");var t=this._query.path.child(ve.fromString(e));if(!Ee.isDocumentKey(t))throw new I(E.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+t+"' is not because it has an odd number of segments ("+t.length+").");return new ar(this.firestore._databaseId,new Ee(t))}if(e instanceof Kc){var n=e;return new ar(this.firestore._databaseId,n._key)}throw new I(E.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+G(e)+".")},Zc.prototype.validateDisjunctiveFilterElements=function(e,t){if(!Array.isArray(e)||0===e.length)throw new I(E.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(10<e.length)throw new I(E.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=e.indexOf(null))throw new I(E.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters cannot contain 'null' in the value array.");if(0<e.filter(function(e){return Number.isNaN(e)}).length)throw new I(E.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters cannot contain 'NaN' in the value array.")},Zc.prototype.validateNewFilter=function(e){if(e instanceof To){var t=[vo.ARRAY_CONTAINS,vo.ARRAY_CONTAINS_ANY],n=[vo.IN,vo.ARRAY_CONTAINS_ANY],r=0<=t.indexOf(e.op),i=0<=n.indexOf(e.op);if(e.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(e.field))throw new I(E.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+e.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(e.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(t)),null!=s)throw s===e.op?new I(E.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new I(E.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},Zc.prototype.validateNewOrderBy=function(e){if(null===this._query.getFirstOrderByField()){var t=this._query.getInequalityFilterField();null!==t&&this.validateOrderByAndInequalityMatch(t,e.field)}},Zc.prototype.validateOrderByAndInequalityMatch=function(e,t){if(!t.isEqual(e))throw new I(E.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+t.toString()+"' instead.")},Zc);function Zc(e,t,n){this._query=e,this.firestore=t,this._converter=n}var eh=(Object.defineProperty(th.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(th.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(th.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),th.prototype.forEach=function(t,n){var r=this;x("QuerySnapshot.forEach",arguments,1,2),F("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(e){t.call(n,r.convertToDocumentImpl(e))})},Object.defineProperty(th.prototype,"query",{get:function(){return new $c(this._originalQuery,this._firestore,this._converter)},enumerable:!0,configurable:!0}),th.prototype.docChanges=function(e){e&&(z("QuerySnapshot.docChanges",e,["includeMetadataChanges"]),B("QuerySnapshot.docChanges","boolean","includeMetadataChanges",e.includeMetadataChanges));var t=!(!e||!e.includeMetadataChanges);if(t&&this._snapshot.excludesMetadataChanges)throw new I(E.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,t,o,a){if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(e){var t=new Jc(i,e.doc.key,e.doc,o.fromCache,o.mutatedKeys.has(e.doc.key),a);return v(e.type===Qa.Added,"Invalid event type for first snapshot"),v(!n||o.query.docComparator(n,e.doc)<0,"Got added events in wrong order"),n=e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:r++}})}var s=o.oldDocs;return o.docChanges.filter(function(e){return t||e.type!==Qa.Metadata}).map(function(e){var t=new Jc(i,e.doc.key,e.doc,o.fromCache,o.mutatedKeys.has(e.doc.key),a),n=-1,r=-1;return e.type!==Qa.Added&&(v(0<=(n=s.indexOf(e.doc.key)),"Index for document not found"),s=s.delete(e.doc.key)),e.type!==Qa.Removed&&(r=(s=s.add(e.doc)).indexOf(e.doc.key)),{type:function(e){switch(e){case Qa.Added:return"added";case Qa.Modified:case Qa.Metadata:return"modified";case Qa.Removed:return"removed";default:return w("Unknown change type: "+e)}}(e.type),doc:t,oldIndex:n,newIndex:r}})}(this._firestore,t,this._snapshot,this._converter),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},th.prototype.isEqual=function(e){if(!(e instanceof th))throw H("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)&&this._converter===e._converter},th.prototype.convertToDocumentImpl=function(e){return new Jc(this._firestore,e.key,e,this.metadata.fromCache,this._snapshot.mutatedKeys.has(e.key),this._converter)},th);function th(e,t,n,r){this._firestore=e,this._originalQuery=t,this._snapshot=n,this._converter=r,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new Gc(n.hasPendingWrites,n.fromCache)}m.__spreadArrays(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(e){try{Object.defineProperty(eh.prototype.docChanges,e,{get:function(){return function(){throw new I(E.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(e){}});var nh,rh=(nh=$c,m.__extends(ih,nh),Object.defineProperty(ih.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(ih.prototype,"parent",{get:function(){var e=this._query.path.popLast();return e.isEmpty()?null:new Kc(new Ee(e),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(ih.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),ih.prototype.doc=function(e){if(x("CollectionReference.doc",arguments,0,1),0===arguments.length&&(e=$.newId()),F("CollectionReference.doc","non-empty string",1,e),""===e)throw new I(E.INVALID_ARGUMENT,"Document path must be a non-empty string");var t=ve.fromString(e);return Kc.forPath(this._query.path.child(t),this.firestore,this._converter)},ih.prototype.add=function(e){L("CollectionReference.add",arguments,1),F("CollectionReference.add","object",1,e);var t=this.doc();return t.set(e).then(function(){return t})},ih.prototype.withConverter=function(e){return new ih(this._path,this.firestore,e)},ih);function ih(e,t,n){var r=nh.call(this,mo.atPath(e),t,n)||this;if((r._path=e).length%2!=1)throw new I(E.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return r}function oh(e,t){if(void 0===t)return{merge:!1};if(z(e,t,["merge","mergeFields"]),B(e,"boolean","merge",t.merge),U(e,"mergeFields","a string or a FieldPath",t.mergeFields,function(e){return"string"==typeof e||e instanceof Vu}),void 0!==t.mergeFields&&void 0!==t.merge)throw new I(E.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function ah(e,t){return void 0===t?{}:(z(e,t,["serverTimestamps"]),j(e,0,"serverTimestamps",t.serverTimestamps,["estimate","previous","none"]),t)}function sh(e,t){q(e,"object",1,t),t&&(z(e,t,["source"]),j(e,0,"source",t.source,["default","server","cache"]))}function uh(e,t,n){if(t instanceof Kc){if(t.firestore!==n)throw new I(E.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}throw H(e,"DocumentReference",1,t)}function ch(e,t,n){var r;return e?(r=e.toFirestore(t),n="toFirestore() in "+n):r=t,[r,n]}var hh=D(Fc,"Use firebase.firestore() instead."),lh=D(Vc,"Use firebase.firestore().runTransaction() instead."),fh=D(Uc,"Use firebase.firestore().batch() instead."),dh=D(Kc,"Use firebase.firestore().doc() instead."),ph=D(zc),mh=D(Jc),gh=D($c),yh=D(eh),vh=D(rh,"Use firebase.firestore().collection() instead."),bh={Firestore:hh,GeoPoint:ws,Timestamp:Ue,Blob:se,Transaction:lh,WriteBatch:fh,DocumentReference:dh,DocumentSnapshot:ph,Query:gh,QueryDocumentSnapshot:mh,QuerySnapshot:yh,CollectionReference:vh,FieldPath:Vu,FieldValue:mc,setLogLevel:Fc.setLogLevel,CACHE_SIZE_UNLIMITED:Lc};function wh(e){e.INTERNAL.registerComponent(new i.Component("firestore",function(e){var t=e.getProvider("app").getImmediate();return new Fc(t,e.getProvider("auth-internal"))},"PUBLIC").setServiceProps(function(e){v(e&&"object"===(void 0===e?"undefined":l(e)),"shallowCopy() expects object parameter.");var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}(bh)))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Th=(Sh.prototype.addCallback=function(e){},Sh.prototype.shutdown=function(){},Sh);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sh(){}var _h="ConnectivityMonitor",Eh=(Ih.prototype.addCallback=function(e){this.callbacks.push(e)},Ih.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},Ih.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},Ih.prototype.onNetworkAvailable=function(){y(_h,"Network connectivity changed: AVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++)(0,t[e])(0)},Ih.prototype.onNetworkUnavailable=function(){y(_h,"Network connectivity changed: UNAVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++)(0,t[e])(1)},Ih.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Ih);function Ih(){var e=this;this.networkAvailableListener=function(){return e.onNetworkAvailable()},this.networkUnavailableListener=function(){return e.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ch=(Dh.prototype.onOpen=function(e){v(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=e},Dh.prototype.onClose=function(e){v(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=e},Dh.prototype.onMessage=function(e){v(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=e},Dh.prototype.close=function(){this.closeFn()},Dh.prototype.send=function(e){this.sendFn(e)},Dh.prototype.callOnOpen=function(){v(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},Dh.prototype.callOnClose=function(e){v(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(e)},Dh.prototype.callOnMessage=function(e){v(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(e)},Dh);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dh(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}var Ah="Connection",Nh={BatchGetDocuments:"batchGet",Commit:"commit"},kh="gl-js/ fire/"+a,Mh=(Rh.prototype.modifyHeadersForRequest=function(e,t){if(t)for(var n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n]);e["X-Goog-Api-Client"]=kh},Rh.prototype.invokeRPC=function(c,r,i){var o=this,h=this.makeUrl(c);return new Promise(function(a,s){var u=new p.XhrIo;u.listenOnce(p.EventType.COMPLETE,function(){try{switch(u.getLastErrorCode()){case p.ErrorCode.NO_ERROR:var e=u.getResponseJson();y(Ah,"XHR received:",JSON.stringify(e)),a(e);break;case p.ErrorCode.TIMEOUT:y(Ah,'RPC "'+c+'" timed out'),s(new I(E.DEADLINE_EXCEEDED,"Request time out"));break;case p.ErrorCode.HTTP_ERROR:var t=u.getStatus();if(y(Ah,'RPC "'+c+'" failed with status:',t,"response text:",u.getResponseText()),0<t){var n=u.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status,o=i.toLowerCase().replace("_","-"),0<=Object.values(E).indexOf(o)?o:E.UNKNOWN);s(new I(r,n.message))}else s(new I(E.UNKNOWN,"Server responded with status "+u.getStatus()))}else y(Ah,'RPC "'+c+'" failed'),s(new I(E.UNAVAILABLE,"Connection failed."));break;default:w('RPC "'+c+'" failed with unanticipated webchannel error '+u.getLastErrorCode()+": "+u.getLastError()+", giving up.")}}finally{y(Ah,'RPC "'+c+'" completed.')}var i,o});var e=m.__assign({},r);delete e.database;var t=JSON.stringify(e);y(Ah,"XHR sending: ",h+" "+t);var n={"Content-Type":"text/plain"};o.modifyHeadersForRequest(n,i),u.send(h,"POST",t,n,15)})},Rh.prototype.invokeStreamingRPC=function(e,t,n){return this.invokeRPC(e,t,n)},Rh.prototype.openStream=function(e,t){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=p.createWebChannelTransport(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,t),d.isReactNative()||d.isElectron()||d.isIE()||d.isUWP()||d.isBrowserExtension()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(e,t){s.listen(e,function(e){try{t(e)}catch(e){setTimeout(function(){throw e},0)}})}y(Ah,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new Ch({sendFn:function(e){c?y(Ah,"Not sending because WebChannel is closed:",e):(u||(y(Ah,"Opening WebChannel transport."),s.open(),u=!0),y(Ah,"WebChannel sending:",e),s.send(e))},closeFn:function(){return s.close()}});return a(p.WebChannel.EventType.OPEN,function(){c||y(Ah,"WebChannel transport opened.")}),a(p.WebChannel.EventType.CLOSE,function(){c||(c=!0,y(Ah,"WebChannel transport closed"),h.callOnClose())}),a(p.WebChannel.EventType.ERROR,function(e){c||(c=!0,y(Ah,"WebChannel transport errored:",e),h.callOnClose(new I(E.UNAVAILABLE,"The operation could not be completed")))}),a(p.WebChannel.EventType.MESSAGE,function(e){var t;if(!c){var n=e.data[0];v(!!n,"Got a webchannel message without data.");var r=n.error||(null===(t=n[0])||void 0===t?void 0:t.error);if(r){y(Ah,"WebChannel received error:",r);var i=r.status,o=function(e){var t=Ba[e];if(void 0!==t)return Ga(t)}(i),a=r.message;void 0===o&&(o=E.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new I(o,a)),s.close()}else y(Ah,"WebChannel received:",n),h.callOnMessage(n)}}),setTimeout(function(){h.callOnOpen()},0),h},Rh.prototype.makeUrl=function(e){var t=Nh[e];return v(void 0!==t,"Unknown REST mapping for: "+e),this.baseUrl+"/v1/projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents:"+t},Rh);function Rh(e){this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.baseUrl=t+"://"+e.host,this.forceLongPolling=e.forceLongPolling}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oh=(Object.defineProperty(Lh.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(Lh.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),Lh.prototype.loadConnection=function(e){return Promise.resolve(new Mh(e))},Lh.prototype.newConnectivityMonitor=function(){return new(Eh.isAvailable()?Eh:Th)},Lh.prototype.newSerializer=function(e){return new Bs(e,{useProto3Json:!0})},Lh.prototype.formatJSON=function(e){return JSON.stringify(e)},Lh.prototype.atob=function(e){return atob(e)},Lh.prototype.btoa=function(e){return btoa(e)},Lh);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lh(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}b.setPlatform(new Oh);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ph(e){wh(e),e.registerVersion("@firebase/firestore","1.9.3")}Ph(r),xh.registerFirestore=Ph}).call(this,Fh(125))},189:function(e,lr,t){"use strict";(function(e){Object.defineProperty(lr,"__esModule",{value:!0});var t,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},u=u||{},f=n;function s(e){return"string"==typeof e}function a(e){return"number"==typeof e}function i(e,t){e=e.split("."),t=t||f;for(var n=0;n<e.length;n++)if(null==(t=t[e[n]]))return null;return t}function o(){}function c(e){var t=void 0===e?"undefined":r(e);if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var n=Object.prototype.toString.call(e);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t}function h(e){return"array"==c(e)}function l(e){var t=c(e);return"array"==t||"object"==t&&"number"==typeof e.length}function d(e){var t=void 0===e?"undefined":r(e);return"object"==t&&null!=e||"function"==t}var p="closure_uid_"+(1e9*Math.random()>>>0),m=0;function g(e,t,n){return e.call.apply(e.bind,arguments)}function y(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function v(e,t,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?g:y).apply(null,arguments)}function b(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var w=Date.now||function(){return+new Date};function T(e,o){function t(){}t.prototype=o.prototype,e.N=o.prototype,e.prototype=new t,(e.prototype.constructor=e).xb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[t].apply(e,r)}}function S(){this.j=this.j,this.i=this.i}S.prototype.j=!1,S.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[p]||(this[p]=++m)},S.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var _=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(s(e))return s(t)&&1==t.length?e.indexOf(t,0):-1;for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},E=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=s(e)?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function I(e){return Array.prototype.concat.apply([],arguments)}function C(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function D(e){return/^[\s\xa0]*$/.test(e)}var A,N=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function k(e,t){return-1!=e.indexOf(t)}function M(e,t){return e<t?-1:t<e?1:0}e:{var R=f.navigator;if(R){var O=R.userAgent;if(O){A=O;break e}}A=""}function L(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function P(e){var t,n={};for(t in e)n[t]=e[t];return n}var x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function F(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var o=0;o<x.length;o++)n=x[o],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function q(e){return q[" "](e),e}q[" "]=o;var V,B,U=k(A,"Opera"),j=k(A,"Trident")||k(A,"MSIE"),K=k(A,"Edge"),W=K||j,G=k(A,"Gecko")&&!(k(A.toLowerCase(),"webkit")&&!k(A,"Edge"))&&!(k(A,"Trident")||k(A,"MSIE"))&&!k(A,"Edge"),Q=k(A.toLowerCase(),"webkit")&&!k(A,"Edge");function z(){var e=f.document;return e?e.documentMode:void 0}e:{var H="",Y=(B=A,G?/rv:([^\);]+)(\)|;)/.exec(B):K?/Edge\/([\d\.]+)/.exec(B):j?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(B):Q?/WebKit\/(\S+)/.exec(B):U?/(?:Version)[ \/]?(\S+)/.exec(B):void 0);if(Y&&(H=Y?Y[1]:""),j){var J=z();if(null!=J&&J>parseFloat(H)){V=String(J);break e}}V=H}var X,$={};function Z(s){return e=s,t=function(){for(var e=0,t=N(String(V)).split("."),n=N(String(s)).split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++){var o=t[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=M(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||M(0==o[2].length,0==a[2].length)||M(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e},n=$,Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e);var e,t,n}var ee=f.document;X=ee&&j?z()||("CSS1Compat"==ee.compatMode?parseInt(V,10):5):void 0;var te=!j||9<=Number(X),ne=j&&!Z("9"),re=function(){if(!f.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{f.addEventListener("test",o,t),f.removeEventListener("test",o,t)}catch(e){}return e}();function ie(e,t){this.type=e,this.a=this.target=t,this.Ia=!0}function oe(e,t){if(ie.call(this,e?e.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.a=t,t=e.relatedTarget){if(G){e:{try{q(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=s(e.pointerType)?e.pointerType:ae[e.pointerType]||"",(this.c=e).defaultPrevented&&this.b()}}ie.prototype.b=function(){this.Ia=!1},T(oe,ie);var ae={2:"touch",3:"pen",4:"mouse"};oe.prototype.b=function(){oe.N.b.call(this);var e=this.c;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,ne)try{(e.ctrlKey||112<=e.keyCode&&e.keyCode<=123)&&(e.keyCode=-1)}catch(e){}};var se="closure_listenable_"+(1e6*Math.random()|0),ue=0;function ce(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.da=i,this.key=++ue,this.X=this.Z=!1}function he(e){e.X=!0,e.listener=null,e.proxy=null,e.src=null,e.da=null}function le(e){this.src=e,this.a={},this.b=0}function fe(e,t){var n=t.type;if(n in e.a){var r,i=e.a[n],o=_(i,t);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(he(t),0==e.a[n].length&&(delete e.a[n],e.b--))}}function de(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.X&&o.listener==t&&o.capture==!!n&&o.da==r)return i}return-1}le.prototype.add=function(e,t,n,r,i){var o=e.toString();(e=this.a[o])||(e=this.a[o]=[],this.b++);var a=de(e,t,r,i);return-1<a?(t=e[a],n||(t.Z=!1)):((t=new ce(t,this.src,o,!!r,i)).Z=n,e.push(t)),t};var pe="closure_lm_"+(1e6*Math.random()|0),me={};function ge(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,o){if(h(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,o);return null}r=Ee(r);return t&&t[se]?t.Aa(n,r,d(i)?!!i.capture:!!i,o):ye(t,n,r,!0,i,o)}(e,t,n,r,i);if(h(t)){for(var o=0;o<t.length;o++)ge(e,t[o],n,r,i);return null}return n=Ee(n),e&&e[se]?e.za(t,n,d(r)?!!r.capture:!!r,i):ye(e,t,n,!1,r,i)}function ye(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var a=d(i)?!!i.capture:!!i;if(a&&!te)return null;var s,u,c=Se(e);if(c||(e[pe]=c=new le(e)),(n=c.add(t,n,r,a,o)).proxy)return n;if(s=Te,r=u=te?function(e){return s.call(u.src,u.listener,e)}:function(e){if(!(e=s.call(u.src,u.listener,e)))return e},(n.proxy=r).src=e,r.listener=n,e.addEventListener)re||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(be(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ve(e){if(!a(e)&&e&&!e.X){var t=e.src;if(t&&t[se])fe(t.c,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(be(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Se(t))?(fe(n,e),0==n.b&&(n.src=null,t[pe]=null)):he(e)}}}function be(e){return e in me?me[e]:me[e]="on"+e}function we(e,t){var n=e.listener,r=e.da||e.src;return e.Z&&ve(e),n.call(r,t)}function Te(e,t){return!!e.X||(te?we(e,new oe(t,this)):we(e,t=new oe(t||i("window.event"),this)))}function Se(e){return(e=e[pe])instanceof le?e:null}var _e="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ee(t){return"function"==c(t)?t:(t[_e]||(t[_e]=function(e){return t.handleEvent(e)}),t[_e])}function Ie(){S.call(this),this.c=new le(this),(this.J=this).B=null}function Ce(e,t,n,r){if(!(t=e.c.a[String(t)]))return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var a=t[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&fe(e.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ia}T(Ie,S),Ie.prototype[se]=!0,(t=Ie.prototype).addEventListener=function(e,t,n,r){ge(this,e,t,n,r)},t.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,o){if(h(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,o);else i=d(i)?!!i.capture:!!i,r=Ee(r),t&&t[se]?(t=t.c,(n=String(n).toString())in t.a&&-1<(r=de(a=t.a[n],r,i,o))&&(he(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.a[n],t.b--))):(t=t&&Se(t))&&(n=t.a[n.toString()],t=-1,n&&(t=de(n,r,i,o)),(r=-1<t?n[t]:null)&&ve(r))}(this,e,t,n,r)},t.dispatchEvent=function(e){var t,n=this.B;if(n)for(t=[];n;n=n.B)t.push(n);n=this.J;var r=e.type||e;if(s(e))e=new ie(e,n);else if(e instanceof ie)e.target=e.target||n;else{var i=e;F(e=new ie(r,n),i)}if(i=!0,t)for(var o=t.length-1;0<=o;o--){var a=e.a=t[o];i=Ce(a,r,!0,e)&&i}if(i=Ce(a=e.a=n,r,!0,e)&&i,i=Ce(a,r,!1,e)&&i,t)for(o=0;o<t.length;o++)i=Ce(a=e.a=t[o],r,!1,e)&&i;return i},t.G=function(){if(Ie.N.G.call(this),this.c){var e,t=this.c;for(e in t.a){for(var n=t.a[e],r=0;r<n.length;r++)he(n[r]);delete t.a[e],t.b--}}this.B=null},t.za=function(e,t,n,r){return this.c.add(String(e),t,!1,n,r)},t.Aa=function(e,t,n,r){return this.c.add(String(e),t,!0,n,r)};var De=f.JSON.stringify;function Ae(e,t){this.c=e,this.f=t,this.b=0,this.a=null}function Ne(){this.b=this.a=null}Ae.prototype.get=function(){if(0<this.b){this.b--;var e=this.a;this.a=e.next,e.next=null}else e=this.c();return e};var ke,Me=new Ae(function(){return new Re},function(e){e.reset()});function Re(){this.next=this.b=this.a=null}function Oe(e){f.setTimeout(function(){throw e},0)}function Le(e,t){var n;ke||(n=f.Promise.resolve(void 0),ke=function(){n.then(Fe)}),Pe||(ke(),Pe=!0),xe.add(e,t)}Ne.prototype.add=function(e,t){var n=Me.get();n.set(e,t),this.b?this.b.next=n:this.a=n,this.b=n},Re.prototype.set=function(e,t){this.a=e,this.b=t,this.next=null};var Pe=!(Re.prototype.reset=function(){this.next=this.b=this.a=null}),xe=new Ne;function Fe(){for(var e;r=n=void 0,r=null,(n=xe).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),e=r;){try{e.a.call(e.b)}catch(e){Oe(e)}var t=Me;t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}var n,r;Pe=!1}function qe(e,t){Ie.call(this),this.b=e||1,this.a=t||f,this.f=v(this.fb,this),this.g=w()}function Ve(e){e.ba=!1,e.L&&(e.a.clearTimeout(e.L),e.L=null)}function Be(e,t,n){if("function"==c(e))n&&(e=v(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=v(e.handleEvent,e)}return 2147483647<Number(t)?-1:f.setTimeout(e,t||0)}function Ue(e,t,n){S.call(this),this.f=null!=n?v(e,n):e,this.c=t,this.b=v(this.$a,this),this.a=[]}function je(e){e.U=Be(e.b,e.c),e.f.apply(null,e.a)}function Ke(e){S.call(this),this.b=e,this.a={}}T(qe,Ie),(t=qe.prototype).ba=!1,t.L=null,t.fb=function(){if(this.ba){var e=w()-this.g;0<e&&e<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-e):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Ve(this),this.start()))}},t.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=w())},t.G=function(){qe.N.G.call(this),Ve(this),delete this.a},T(Ue,S),(t=Ue.prototype).ea=!1,t.U=null,t.Ta=function(e){this.a=arguments,this.U?this.ea=!0:je(this)},t.G=function(){Ue.N.G.call(this),this.U&&(f.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},t.$a=function(){this.U=null,this.ea&&(this.ea=!1,je(this))},T(Ke,S);var We=[];function Ge(e,t,n,r){h(n)||(n&&(We[0]=n.toString()),n=We);for(var i=0;i<n.length;i++){var o=ge(t,n[i],r||e.handleEvent,!1,e.b||e);if(!o)break;e.a[o.key]=o}}function Qe(e){L(e.a,function(e,t){this.a.hasOwnProperty(t)&&ve(e)},e),e.a={}}function ze(){}Ke.prototype.G=function(){Ke.N.G.call(this),Qe(this)},Ke.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var He=new Ie;function Ye(e){ie.call(this,"serverreachability",e)}function Je(e){He.dispatchEvent(new Ye(He,e))}function Xe(e){ie.call(this,"statevent",e)}function $e(e){He.dispatchEvent(new Xe(He,e))}function Ze(e){ie.call(this,"timingevent",e)}function et(e,t){if("function"!=c(e))throw Error("Fn must not be null and must be a function");return f.setTimeout(function(){e()},t)}T(Ye,ie),T(Xe,ie),T(Ze,ie);var tt={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},nt={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function rt(){}function it(e){var t;return(t=e.a)||(t=e.a={}),t}function ot(){}rt.prototype.a=null;var at,st={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function ut(){ie.call(this,"d")}function ct(){ie.call(this,"c")}function ht(){}function lt(e,t,n){this.g=e,this.W=t,this.V=n||1,this.I=new Ke(this),this.O=ft,e=W?125:void 0,this.P=new qe(e),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}T(ut,ie),T(ct,ie),T(ht,rt),at=new ht;var ft=45e3,dt={},pt={};function mt(e,t,n){e.F=1,e.f=Bt(Ot(t)),e.l=n,e.H=!0,yt(e,null)}function gt(e,t,n,r){e.F=1,e.f=Bt(Ot(t)),e.l=null,e.H=n,yt(e,r)}function yt(e,t){e.v=w(),wt(e),e.D=Ot(e.f),Vt(e.D,"t",e.V),e.A=0,e.a=e.g.$(e.g.Y()?t:null),0<e.J&&(e.B=new Ue(v(e.Ja,e,e.a),e.J)),Ge(e.I,e.a,"readystatechange",e.cb),t=e.h?P(e.h):{},e.l?(e.w||(e.w="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.a.ca(e.D,e.w,e.l,t)):(e.w="GET",e.a.ca(e.D,e.w,null,t)),Je(1)}function vt(e,t,n){for(var r=!0;!e.m&&e.A<n.length;){var i=bt(e,n);if(i==pt){4==t&&(e.c=4,$e(14),r=!1);break}if(i==dt){e.c=4,$e(15),r=!1;break}It(e,i)}4==t&&0==n.length&&(e.c=1,$e(16),r=!1),e.b=e.b&&r,r||(Et(e),_t(e))}function bt(e,t){var n=e.A,r=t.indexOf("\n",n);return-1==r?pt:(n=Number(t.substring(n,r)),isNaN(n)?dt:(r+=1)+n>t.length?pt:(t=t.substr(r,n),e.A=r+n,t))}function wt(e){e.R=w()+e.O,Tt(e,e.O)}function Tt(e,t){if(null!=e.i)throw Error("WatchDog timer not null");e.i=et(v(e.ab,e),t)}function St(e){e.i&&(f.clearTimeout(e.i),e.i=null)}function _t(e){e.g.Ca()||e.m||e.g.na(e)}function Et(e){St(e);var t=e.B;t&&"function"==typeof t.la&&t.la(),e.B=null,Ve(e.P),Qe(e.I),e.a&&(t=e.a,e.a=null,t.abort(),t.la())}function It(e,t){try{e.g.Fa(e,t),Je(4)}catch(e){}}function Ct(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(l(e)||s(e))E(e,t,void 0);else{if(e.K&&"function"==typeof e.K)var n=e.K();else if(e.C&&"function"==typeof e.C)n=void 0;else if(l(e)||s(e)){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.C&&"function"==typeof e.C)return e.C();if(s(e))return e.split("");if(l(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function Dt(e,t){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Dt)for(n=e.K(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function At(e,t){kt(e.b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&Nt(e))}function Nt(e){if(e.c!=e.a.length){for(var t=0,n=0;t<e.a.length;){var r=e.a[t];kt(e.b,r)&&(e.a[n++]=r),t++}e.a.length=n}if(e.c!=e.a.length){var i={};for(n=t=0;t<e.a.length;)kt(i,r=e.a[t])||(i[e.a[n++]=r]=1),t++;e.a.length=n}}function kt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(t=lt.prototype).setTimeout=function(e){this.O=e},t.cb=function(e){e=e.target;var t=this.B;t&&3==On(e)?t.Ta():this.Ja(e)},t.Ja=function(e){try{if(e==this.a)e:{var t=On(this.a),n=this.a.ya(),r=this.a.T();if(!(t<3||3==t&&!W&&!this.a.aa())){this.m||4!=t||7==n||Je(8==n||r<=0?3:2),St(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){t:{if(this.a){var a=Ln(this.a,"X-HTTP-Initial-Response");if(a&&!D(a)){var s=a;break t}}s=null}if(!s){this.b=!1,this.c=3,$e(12),Et(this),_t(this);break e}this.s=!0,It(this,s)}this.H?(vt(this,t,o),W&&this.b&&3==t&&(Ge(this.I,this.P,"tick",this.bb),this.P.start())):It(this,o),4==t&&Et(this),this.b&&!this.m&&(4==t?this.g.na(this):(this.b=!1,wt(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,$e(12)):(this.c=0,$e(13)),Et(this),_t(this)}}}catch(e){}},t.bb=function(){if(this.a){var e=On(this.a),t=this.a.aa();this.A<t.length&&(St(this),vt(this,e,t),this.b&&4!=e&&wt(this))}},t.cancel=function(){this.m=!0,Et(this)},t.ab=function(){this.i=null;var e=w();0<=e-this.R?(2!=this.F&&(Je(3),$e(17)),Et(this),this.c=2,_t(this)):Tt(this,this.R-e)},(t=Dt.prototype).C=function(){Nt(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e},t.K=function(){return Nt(this),this.a.concat()},t.get=function(e,t){return kt(this.b,e)?this.b[e]:t},t.set=function(e,t){kt(this.b,e)||(this.c++,this.a.push(e)),this.b[e]=t},t.forEach=function(e,t){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};var Mt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Rt(e,t){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,e instanceof Rt?(this.h=void 0!==t?t:e.h,Lt(this,e.f),this.j=e.j,Pt(this,e.b),xt(this,e.i),this.a=e.a,Ft(this,en(e.c)),this.g=e.g):e&&(n=String(e).match(Mt))?(this.h=!!t,Lt(this,n[1]||"",!0),this.j=Ut(n[2]||""),Pt(this,n[3]||"",!0),xt(this,n[4]),this.a=Ut(n[5]||"",!0),Ft(this,n[6]||"",!0),this.g=Ut(n[7]||"")):(this.h=!!t,this.c=new Yt(null,this.h))}function Ot(e){return new Rt(e)}function Lt(e,t,n){e.f=n?Ut(t,!0):t,e.f&&(e.f=e.f.replace(/:$/,""))}function Pt(e,t,n){e.b=n?Ut(t,!0):t}function xt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.i=t}else e.i=null}function Ft(e,t,n){var r,i;t instanceof Yt?(e.c=t,r=e.c,(i=e.h)&&!r.f&&(Jt(r),r.c=null,r.a.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Xt(this,t),Zt(this,n,e))},r)),r.f=i):(n||(t=jt(t,zt)),e.c=new Yt(t,e.h))}function qt(e,t,n){e.c.set(t,n)}function Vt(e,t,n){h(n)||(n=[String(n)]),Zt(e.c,t,n)}function Bt(e){return qt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^w()).toString(36)),e}function Ut(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function jt(e,t,n){return s(e)?(e=encodeURI(e).replace(t,Kt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Kt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Rt.prototype.toString=function(){var e=[],t=this.f;t&&e.push(jt(t,Wt,!0),":");var n=this.b;return!n&&"file"!=t||(e.push("//"),(t=this.j)&&e.push(jt(t,Wt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&e.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&e.push("/"),e.push(jt(n,"/"==n.charAt(0)?Qt:Gt,!0))),(n=this.c.toString())&&e.push("?",n),(n=this.g)&&e.push("#",jt(n,Ht)),e.join("")},Rt.prototype.resolve=function(e){var t=Ot(this),n=!!e.f;n?Lt(t,e.f):n=!!e.j,n?t.j=e.j:n=!!e.b,n?Pt(t,e.b):n=null!=e.i;var r=e.a;if(n)xt(t,e.i);else if(n=!!e.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=t.a.lastIndexOf("/");-1!=i&&(r=t.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(k(i,"./")||k(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?t.a=r:n=""!==e.c.toString(),n?Ft(t,en(e.c)):n=!!e.g,n&&(t.g=e.g),t};var Wt=/[#\/\?@]/g,Gt=/[#\?:]/g,Qt=/[#\?]/g,zt=/[#\?@]/g,Ht=/#/g;function Yt(e,t){this.b=this.a=null,this.c=e||null,this.f=!!t}function Jt(n){n.a||(n.a=new Dt,n.b=0,n.c&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Xt(e,t){Jt(e),t=tn(e,t),kt(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,At(e.a,t))}function $t(e,t){return Jt(e),t=tn(e,t),kt(e.a.b,t)}function Zt(e,t,n){Xt(e,t),0<n.length&&(e.c=null,e.a.set(tn(e,t),C(n)),e.b+=n.length)}function en(e){var t=new Yt;return t.c=e.c,e.a&&(t.a=new Dt(e.a),t.b=e.b),t}function tn(e,t){return t=String(t),e.f&&(t=t.toLowerCase()),t}function nn(e){this.a=e,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function rn(e){var t=e.a.F.a;if(null!=t)$e(4),t?($e(10),Qn(e.a,e,!1)):($e(11),Qn(e.a,e,!0));else{e.b=new lt(e,void 0,void 0),e.b.h=e.h,t=Xn(t=e.a,t.Y()?e.f:null,e.i),$e(4),Vt(t,"TYPE","xmlhttp");var n=e.a.j,r=e.a.I;n&&r&&qt(t,n,r),gt(e.b,t,!1,e.f)}}function on(){this.a=this.b=null}function an(){this.a=new Dt}function sn(e){var t=void 0===e?"undefined":r(e);return"object"==t&&e||"function"==t?"o"+(e[p]||(e[p]=++m)):t.charAt(0)+e}function un(e,t){this.b=e,this.a=t}function cn(e){this.g=e||hn,e=f.PerformanceNavigationTiming?0<(e=f.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(f.ka&&f.ka.Da&&f.ka.Da()&&f.ka.Da().yb),this.f=e?this.g:1,this.a=null,1<this.f&&(this.a=new an),this.b=null,this.c=[]}(t=Yt.prototype).add=function(e,t){Jt(this),this.c=null,e=tn(this,e);var n=this.a.get(e);return n||this.a.set(e,n=[]),n.push(t),this.b+=1,this},t.forEach=function(n,r){Jt(this),this.a.forEach(function(e,t){E(e,function(e){n.call(r,e,t,this)},this)},this)},t.K=function(){Jt(this);for(var e=this.a.C(),t=this.a.K(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n},t.C=function(e){Jt(this);var t=[];if(s(e))$t(this,e)&&(t=I(t,this.a.get(tn(this,e))));else{e=this.a.C();for(var n=0;n<e.length;n++)t=I(t,e[n])}return t},t.set=function(e,t){return Jt(this),this.c=null,$t(this,e=tn(this,e))&&(this.b-=this.a.get(e).length),this.a.set(e,[t]),this.b+=1,this},t.get=function(e,t){return e&&0<(e=this.C(e)).length?String(e[0]):t},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.K(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),e.push(a)}}return this.c=e.join("&")},T(function(){},function(){}),(t=nn.prototype).M=null,t.$=function(e){return this.a.$(e)},t.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},t.Ca=function(){return!1},t.Fa=function(e,t){if(this.c=e.o,0==this.M){if(!this.a.o&&(e=e.a)){var n=Ln(e,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(e=Ln(e,"X-HTTP-Session-Id"))&&(this.a.I=e)}if(t){try{var r=this.a.ja.a.parse(t)}catch(e){return(t=this.a).m=this.c,void Yn(t,2)}this.f=r[0]}else(t=this.a).m=this.c,Yn(t,2)}else 1==this.M&&(this.g?$e(6):"11111"==t?($e(5),this.g=!0,(!j||10<=Number(X))&&(this.c=200,this.b.cancel(),$e(11),Qn(this.a,this,!0))):($e(7),this.g=!1))},t.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,rn(this)):1==this.M&&(this.g?($e(11),Qn(this.a,this,!0)):($e(10),Qn(this.a,this,!1)));else{0==this.M?$e(8):1==this.M&&$e(9);var e=this.a;e.m=this.c,Yn(e,2)}},t.Y=function(){return this.a.Y()},t.ma=function(){return this.a.ma()},an.prototype.add=function(e){this.a.set(sn(e),e)},an.prototype.C=function(){return this.a.C()};var hn=10;function ln(e,t){!e.a&&(k(t,"spdy")||k(t,"quic")||k(t,"h2"))&&(e.f=e.g,e.a=new an,e.b&&(mn(e,e.b),e.b=null))}function fn(e){return e.b||e.a&&e.a.a.c>=e.f}function dn(e){return e.b?1:e.a?e.a.a.c:0}function pn(e,t){return e=e.b?e.b==t:!!e.a&&(t=sn(t),kt(e.a.a.b,t))}function mn(e,t){e.a?e.a.add(t):e.b=t}function gn(e,t){var n;e.b&&e.b==t?e.b=null:((n=e.a)&&(n=sn(t),n=kt(e.a.a.b,n)),n&&At(e.a.a,sn(t)))}function yn(e){if(null!=e.b)return e.c.concat(e.b.j);if(null==e.a||0==e.a.a.c)return C(e.c);var t=e.c;return E(e.a.C(),function(e){t=t.concat(e.j)}),t}function vn(){}function bn(){this.a=new vn}function wn(e,r,t){var i=t||"";try{Ct(e,function(e,t){var n=e;d(e)&&(n=De(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}function Tn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}cn.prototype.cancel=function(){var e;this.c=yn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(E(this.a.C(),function(e){e.cancel()}),(e=this.a.a).b={},e.a.length=0,e.c=0)},vn.prototype.stringify=function(e){return f.JSON.stringify(e,void 0)},vn.prototype.parse=function(e){return f.JSON.parse(e,void 0)};var Sn=f.JSON.parse;function _n(e){Ie.call(this),this.headers=new Dt,this.H=e||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=En,this.D=this.F=!1}T(_n,Ie);var En="",In=/^https?$/i,Cn=["POST","PUT"];function Dn(e){return"content-type"==e.toLowerCase()}function An(e,t){e.b=!1,e.a&&(e.g=!0,e.a.abort(),e.g=!1),e.f=t,e.h=5,Nn(e),Mn(e)}function Nn(e){e.v||(e.v=!0,e.dispatchEvent("complete"),e.dispatchEvent("error"))}function kn(e){if(e.b&&void 0!==u&&(!e.s[1]||4!=On(e)||2!=e.T()))if(e.l&&4==On(e))Be(e.Ea,0,e);else if(e.dispatchEvent("readystatechange"),4==On(e)){e.b=!1;try{var t,n=e.T();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.A).match(Mt)[1]||null;if(!o&&f.self&&f.self.location){var a=f.self.location.protocol;o=a.substr(0,a.length-1)}i=!In.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{e.h=6;try{var s=2<On(e)?e.a.statusText:""}catch(e){s=""}e.f=s+" ["+e.T()+"]",Nn(e)}}finally{Mn(e)}}}function Mn(e,t){if(e.a){Rn(e);var n=e.a,r=e.s[0]?o:null;e.a=null,e.s=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){}}}function Rn(e){e.a&&e.D&&(e.a.ontimeout=null),e.m&&(f.clearTimeout(e.m),e.m=null)}function On(e){return e.a?e.a.readyState:0}function Ln(e,t){return e.a?e.a.getResponseHeader(t):null}function Pn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}if(r)return e;var i;if(i="",L(n,function(e,t){i+=t,i+=":",i+=e,i+="\r\n"}),n=i,s(e)){if(t=encodeURIComponent(String(t)),t+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=e.indexOf("#"))<0&&(n=e.length),(r=e.indexOf("?"))<0||n<r){r=n;var o=""}else o=e.substring(r+1,n);n=(e=[e.substr(0,r),o,e.substr(n)])[1],e[1]=t?n?n+"&"+t:t:n,e=e[0]+(e[1]?"?"+e[1]:"")+e[2]}return e}return qt(e,t,n),e}function xn(e){this.f=[],this.F=new on,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!i("internalChannelParams.failFast",e),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=i("internalChannelParams.baseRetryDelayMs",e)||5e3,this.Ra=i("internalChannelParams.retryDelaySeedMs",e)||1e4,this.Pa=i("internalChannelParams.forwardChannelMaxRetries",e)||2,this.qa=i("internalChannelParams.forwardChannelRequestTimeoutMs",e)||2e4,this.Ka=e&&e.zb||void 0,this.D=void 0,this.R=e&&e.supportsCrossDomainXhr||!1,this.H="",this.b=new cn(e&&e.concurrentRequestLimit),this.ja=new bn,this.o=!e||void 0===e.backgroundChannelTest||e.backgroundChannelTest,(this.W=e&&e.fastHandshake||!1)&&!this.o&&(this.o=!0),e&&e.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Fn(e){if(qn(e),3==e.u){var t=e.P++,n=Ot(e.B);qt(n,"SID",e.H),qt(n,"RID",t),qt(n,"TYPE","terminate"),jn(e,n),(t=new lt(e,t,void 0)).F=2,t.f=Bt(Ot(n)),n=!1,f.navigator&&f.navigator.sendBeacon&&(n=f.navigator.sendBeacon(t.f.toString(),"")),!n&&f.Image&&((new Image).src=t.f,n=!0),n||(t.a=t.g.$(null),t.a.ca(t.f)),t.v=w(),wt(t)}Jn(e)}function qn(e){e.w&&(e.w.abort(),e.w=null),e.a&&(e.a.cancel(),e.a=null),e.l&&(f.clearTimeout(e.l),e.l=null),zn(e),e.b.cancel(),e.h&&(a(e.h)&&f.clearTimeout(e.h),e.h=null)}function Vn(e,t){e.f.push(new un(e.Qa++,t)),3==e.u&&Bn(e)}function Bn(e){fn(e.b)||e.h||(e.h=!0,Le(e.Ha,e),e.A=0)}function Un(e,t){var n;n=t?t.W:e.P++;var r=Ot(e.B);qt(r,"SID",e.H),qt(r,"RID",n),qt(r,"AID",e.O),jn(e,r),e.g&&e.i&&Pn(r,e.g,e.i),n=new lt(e,n,e.A+1),null===e.g&&(n.h=e.i),t&&(e.f=t.j.concat(e.f)),t=Kn(e,n,1e3),n.setTimeout(Math.round(.5*e.qa)+Math.round(.5*e.qa*Math.random())),mn(e.b,n),mt(n,r,t)}function jn(e,n){e.c&&Ct({},function(e,t){qt(n,t,e)})}function Kn(e,t,n){n=Math.min(e.f.length,n);var r=e.c?v(e.c.Sa,e.c,e):null;e:for(var i=e.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{wn(h,a,"req"+c+"_")}catch(e){r&&r(h)}}if(s){r=a.join("&");break e}}return e=e.f.splice(0,n),t.j=e,r}function Wn(e){e.a||e.l||(e.S=1,Le(e.Ga,e),e.v=0)}function Gn(e){return!(e.a||e.l||3<=e.v)&&(e.S++,e.l=et(v(e.Ga,e),Hn(e,e.v)),e.v++,1)}function Qn(e,t,n){var r=t.l;r&&ln(e.b,r),e.ia=e.oa&&n,e.m=t.c,e.B=Xn(e,null,e.ha),Bn(e)}function zn(e){null!=e.s&&(f.clearTimeout(e.s),e.s=null)}function Hn(e,t){var n=e.Na+Math.floor(Math.random()*e.Ra);return e.ma()||(n*=2),n*t}function Yn(e,t){if(2==t){var n=null;e.c&&(n=null);var r=v(e.eb,e);n||(n=new Rt("//www.google.com/images/cleardot.gif"),f.location&&"http"==f.location.protocol||Lt(n,"https"),Bt(n)),function(e,t){var n=new ze;if(f.Image){var r=new Image;r.onload=b(Tn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=b(Tn,n,r,"TestLoadImage: error",!1,t),r.onabort=b(Tn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=b(Tn,n,r,"TestLoadImage: timeout",!1,t),f.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else $e(2);e.u=0,e.c&&e.c.ta(t),Jn(e),qn(e)}function Jn(e){e.u=0,e.m=-1,e.c&&(0==yn(e.b).length&&0==e.f.length||(e.b.c.length=0,C(e.f),e.f.length=0),e.c.sa())}function Xn(e,t,n){var r,i,o,a,s,u,c=(r=n)instanceof Rt?Ot(r):new Rt(r,void 0);if(""!=c.b)t&&Pt(c,t+"."+c.b),xt(c,c.i);else{var h,l=f.location;h=t?t+"."+l.hostname:l.hostname,i=l.protocol,o=h,a=+l.port,s=n,u=new Rt(null,void 0),i&&Lt(u,i),o&&Pt(u,o),a&&xt(u,a),s&&(u.a=s),c=u}return e.V&&L(e.V,function(e,t){qt(c,t,e)}),t=e.j,n=e.I,t&&n&&qt(c,t,n),qt(c,"VER",e.wa),jn(e,c),c}function $n(){}function Zn(){if(j&&!(10<=Number(X)))throw Error("Environmental error: no available transport.")}function er(e,t){Ie.call(this),this.a=new xn(t),this.g=e,this.m=t&&t.testUrl?t.testUrl:function(e){for(var t=e,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))t=i;else(r=""==t)||(r=0<=(r=t.length-1)&&t.indexOf("/",r)==r),t+=r?i:"/"+i}return t}(this.g,"test"),this.b=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.a.i=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.xa&&(e?e["X-WebChannel-Client-Profile"]=t.xa:e={"X-WebChannel-Client-Profile":t.xa}),this.a.J=e,(e=t&&t.httpHeadersOverwriteParam)&&!D(e)&&(this.a.g=e),this.l=t&&t.supportsCrossDomainXhr||!1,this.h=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!D(t)&&(this.a.j=t,null!==(e=this.b)&&t in e&&(t in(e=this.b)&&delete e[t])),this.f=new rr(this)}function tr(e){ut.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.c=e)?(e=this.c,this.data=null!==t&&e in t?t[e]:void 0):this.data=t}else this.data=e}function nr(){ct.call(this),this.status=1}function rr(e){this.a=e}(t=_n.prototype).ca=function(e,t,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+e);t=t?t.toUpperCase():"GET",this.A=e,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?it(this.H):it(at),this.a.onreadystatechange=v(this.Ea,this);try{this.w=!0,this.a.open(t,String(e),!0),this.w=!1}catch(e){return void An(this,e)}e=n||"";var i,o=new Dt(this.headers);r&&Ct(r,function(e,t){o.set(t,e)}),r=function(e){e:{for(var t=Dn,n=e.length,r=s(e)?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return t<0?null:s(e)?e.charAt(t):e[t]}(o.K()),n=f.FormData&&e instanceof f.FormData,0<=_(Cn,t)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(e,t){this.a.setRequestHeader(t,e)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Rn(this),0<this.o&&((this.D=(i=this.a,j&&Z(9)&&a(i.timeout)&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=v(this.Ba,this)):this.m=Be(this.Ba,this.o,this)),this.l=!0,this.a.send(e),this.l=!1}catch(e){An(this,e)}},t.Ba=function(){void 0!==u&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(e){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=e||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Mn(this))},t.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Mn(this,!0)),_n.N.G.call(this)},t.Ea=function(){this.j||(this.w||this.l||this.g?kn(this):this.Za())},t.Za=function(){kn(this)},t.T=function(){try{return 2<On(this)?this.a.status:-1}catch(e){return-1}},t.aa=function(){try{return this.a?this.a.responseText:""}catch(e){return""}},t.Ua=function(e){if(this.a){var t=this.a.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Sn(t)}},t.ya=function(){return this.h},t.Xa=function(){return s(this.f)?this.f:String(this.f)},(t=xn.prototype).wa=8,t.u=1,t.Ca=function(){return 0==this.u},t.Ha=function(e){if(this.h)if(this.h=null,1==this.u){if(!e){this.P=Math.floor(1e5*Math.random()),e=this.P++;var t,n=new lt(this,e,void 0),r=this.i;if(this.J&&(r?F(r=P(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)e:{for(var i=t=0;i<this.f.length;i++){var o=this.f[i];if("__data__"in o.a&&s(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(t+=o)){t=i;break e}if(4096===t||i===this.f.length-1){t=i+1;break e}}t=1e3}else t=1e3;t=Kn(this,n,t),qt(i=Ot(this.B),"RID",e),qt(i,"CVER",22),this.o&&this.j&&qt(i,"X-HTTP-Session-Id",this.j),jn(this,i),this.g&&r&&Pn(i,this.g,r),mn(this.b,n),this.W?(qt(i,"$req",t),qt(i,"SID","null"),n.S=!0,mt(n,i,null)):mt(n,i,t),this.u=2}}else 3==this.u&&(e?Un(this,e):0==this.f.length||fn(this.b)||Un(this))},t.Ga=function(){this.l=null,this.a=new lt(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var e=Ot(this.pa);qt(e,"RID","rpc"),qt(e,"SID",this.H),qt(e,"CI",this.ia?"0":"1"),qt(e,"AID",this.O),jn(this,e),qt(e,"TYPE","xmlhttp"),this.g&&this.i&&Pn(e,this.g,this.i),this.D&&this.a.setTimeout(this.D),gt(this.a,e,!0,this.ga)},t.Fa=function(e,t){if(0!=this.u&&(this.a==e||pn(this.b,e)))if(this.m=e.o,!e.s&&pn(this.b,e)&&3==this.u){try{var n=this.ja.a.parse(t)}catch(e){n=null}if(h(n)&&3==n.length){if(0==(t=n)[0]){e:if(!this.l){if(this.a){if(!(this.a.v+3e3<e.v))break e;zn(this),this.a.cancel(),this.a=null}Gn(this),$e(18)}}else this.ra=t[1],0<this.ra-this.O&&t[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=et(v(this.Ya,this),6e3));if(dn(this.b)<=1&&this.fa){try{this.fa()}catch(e){}this.fa=void 0}}else Yn(this,11)}else if(!e.s&&this.a!=e||zn(this),!D(t))for(t=n=this.ja.a.parse(t),n=0;n<t.length;n++){var r=t[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&a(r)&&0<r&&(this.D=1.5*r),this.o&&(r=e.a)&&((i=Ln(r,"X-Client-Wire-Protocol"))&&ln(this.b,i),this.j&&(r=Ln(r,"X-HTTP-Session-Id")))&&(this.I=r,qt(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=e,this.pa=Xn(this,this.Y()?this.ga:null,this.ha),r.s?(gn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(St(r),wt(r)),this.a=r):Wn(this),0<this.f.length&&Bn(this)}else"stop"!=r[0]&&"close"!=r[0]||Yn(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?Yn(this,7):Fn(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},t.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Gn(this),$e(19))},t.na=function(e){var t=null;if(this.a==e){zn(this),this.a=null;var n=2}else{if(!pn(this.b,e))return;t=e.j,gn(this.b,e),n=1}if(this.m=e.o,0!=this.u)if(e.b)1==n?(t=w()-e.v,He.dispatchEvent(new Ze(He,e.l?e.l.length:0,t,this.A)),Bn(this)):Wn(this);else{var r=e.c;if(3==r||0==r&&0<this.m||!(1==n&&function(e,t){if(!(dn(e.b)>=e.b.f-(e.h?1:0))){if(e.h)return e.f=t.j.concat(e.f),1;if(!(1==e.u||2==e.u||e.A>=(e.Oa?0:e.Pa)))return e.h=et(v(e.Ha,e,t),Hn(e,e.A)),e.A++,1}}(this,e)||2==n&&Gn(this)))switch(t&&0<t.length&&(e=this.b,e.c=e.c.concat(t)),r){case 1:Yn(this,5);break;case 4:Yn(this,10);break;case 3:Yn(this,6);break;default:Yn(this,2)}}},t.eb=function(e){$e(e?2:1)},t.$=function(e){if(e&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new _n(this.Ka)).F=this.R,e},t.ma=function(){return!!this.c&&!0},t.Y=function(){return this.R},(t=$n.prototype).va=function(){},t.ua=function(){},t.ta=function(){},t.sa=function(){},t.Sa=function(){},Zn.prototype.a=function(e,t){return new er(e,t)},T(er,Ie),(t=er.prototype).addEventListener=function(e,t,n,r){er.N.addEventListener.call(this,e,t,n,r)},t.removeEventListener=function(e,t,n,r){er.N.removeEventListener.call(this,e,t,n,r)},t.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var e=this.a,t=this.m,n=this.g,r=this.b||void 0;$e(0),e.ha=n,e.V=r||{},e.o&&(e.F.b=[],e.F.a=!1),e.w=new nn(e),null===e.g&&(e.w.h=e.i),n=t,e.g&&e.i&&(n=Pn(t,e.g,e.i)),(e=e.w).i=n,t=Xn(e.a,null,e.i),$e(3),null!=(n=e.a.F.b)?(e.f=n[0],e.M=1,rn(e)):(Vt(t,"MODE","init"),!e.a.o&&e.a.j&&Vt(t,"X-HTTP-Session-Id",e.a.j),e.b=new lt(e,void 0,void 0),e.b.h=e.h,gt(e.b,t,!1,null),e.M=0)},t.close=function(){Fn(this.a)},t.Wa=function(e){if(s(e)){var t={};t.__data__=e,Vn(this.a,t)}else this.h?((t={}).__data__=De(e),Vn(this.a,t)):Vn(this.a,e)},t.G=function(){this.a.c=null,delete this.f,Fn(this.a),delete this.a,er.N.G.call(this)},T(tr,ut),T(nr,ct),T(rr,$n),rr.prototype.va=function(){this.a.dispatchEvent("a")},rr.prototype.ua=function(e){this.a.dispatchEvent(new tr(e))},rr.prototype.ta=function(e){this.a.dispatchEvent(new nr(e))},rr.prototype.sa=function(){this.a.dispatchEvent("b")};var ir=b(function(e,t){function n(){}n.prototype=e.prototype;var r=new n;return e.apply(r,Array.prototype.slice.call(arguments,1)),r},Zn);Zn.prototype.createWebChannel=Zn.prototype.a,er.prototype.send=er.prototype.Wa,er.prototype.open=er.prototype.Va,er.prototype.close=er.prototype.close,tt.NO_ERROR=0,tt.TIMEOUT=8,tt.HTTP_ERROR=6,nt.COMPLETE="complete",(ot.EventType=st).OPEN="a",st.CLOSE="b",st.ERROR="c",st.MESSAGE="d",Ie.prototype.listen=Ie.prototype.za,_n.prototype.listenOnce=_n.prototype.Aa,_n.prototype.getLastError=_n.prototype.Xa,_n.prototype.getLastErrorCode=_n.prototype.ya,_n.prototype.getStatus=_n.prototype.T,_n.prototype.getResponseJson=_n.prototype.Ua,_n.prototype.getResponseText=_n.prototype.aa,_n.prototype.send=_n.prototype.ca;var or={createWebChannelTransport:ir,ErrorCode:tt,EventType:nt,WebChannel:ot,XhrIo:_n},ar=or.createWebChannelTransport,sr=or.ErrorCode,ur=or.EventType,cr=or.WebChannel,hr=or.XhrIo;lr.default=or,lr.ErrorCode=sr,lr.EventType=ur,lr.WebChannel=cr,lr.XhrIo=hr,lr.createWebChannelTransport=ar}).call(this,t(39))},190:function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i,o,a=(i=n(16))&&"object"===(void 0===i?"undefined":r(i))&&"default"in i?i.default:i,d=n(17),s=n(27),c={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},p=(o=Error,d.__extends(u,o),u);function u(e,t,n){var r=o.call(this,t)||this;return Object.setPrototypeOf(r,u.prototype),r.code=e,r.details=n,r}function m(e,t,n){var r=function(e){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),i=r,o=void 0;try{var a=t&&t.error;if(a){var s=a.status;if("string"==typeof s){if(!c[s])return new p("internal","internal");r=c[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(e){}return"ok"===r?null:new p(r,i,o)}var h=(l.prototype.getAuthToken=function(){return d.__awaiter(this,void 0,void 0,function(){var t;return d.__generator(this,function(e){switch(e.label){case 0:if(!this.auth)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 3:return e.sent(),[2,void 0];case 4:return[2]}})})},l.prototype.getInstanceIdToken=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(e){if(!(this.messaging&&"Notification"in self&&"granted"===Notification.permission))return[2,void 0];try{return[2,this.messaging.getToken()]}catch(e){return[2,void 0]}return[2]})})},l.prototype.getContext=function(){return d.__awaiter(this,void 0,void 0,function(){var t,n;return d.__generator(this,function(e){switch(e.label){case 0:return[4,this.getAuthToken()];case 1:return t=e.sent(),[4,this.getInstanceIdToken()];case 2:return n=e.sent(),[2,{authToken:t,instanceIdToken:n}]}})})},l);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l(e,t){var n=this;this.auth=null,this.messaging=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(function(e){return n.auth=e},function(){}),this.messaging||t.get().then(function(e){return n.messaging=e},function(){})}function f(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}var g=(y.prototype.encode=function(e){var t=this;if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(Array.isArray(e))return e.map(function(e){return t.encode(e)});if("function"==typeof e||"object"===(void 0===e?"undefined":r(e)))return f(e,function(e){return t.encode(e)});throw new Error("Data cannot be encoded in JSON: "+e)},y.prototype.decode=function(e){var t=this;if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(e.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+e);return n;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(function(e){return t.decode(e)}):"function"==typeof e||"object"===(void 0===e?"undefined":r(e))?f(e,function(e){return t.decode(e)}):e},y);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y(){}var v=(Object.defineProperty(b.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),b.prototype._url=function(e){var t=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+t+".cloudfunctions.net/"+e:this.emulatorOrigin+"/"+t+"/"+n+"/"+e},b.prototype.useFunctionsEmulator=function(e){this.emulatorOrigin=e},b.prototype.httpsCallable=function(t,n){var r=this;return function(e){return r.call(t,e,n||{})}},b.prototype.postJSON=function(r,i,o){return d.__awaiter(this,void 0,void 0,function(){var t,n;return d.__generator(this,function(e){switch(e.label){case 0:o.append("Content-Type","application/json"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return t=e.sent(),[3,4];case 3:return e.sent(),[2,{status:0,json:null}];case 4:n=null,e.label=5;case 5:return e.trys.push([5,7,,8]),[4,t.json()];case 6:return n=e.sent(),[3,8];case 7:return e.sent(),[3,8];case 8:return[2,{status:t.status,json:n}]}})})},b.prototype.call=function(h,l,f){return d.__awaiter(this,void 0,void 0,function(){var t,r,i,o,a,s,u,c;return d.__generator(this,function(e){switch(e.label){case 0:return t=this._url(h),l=this.serializer.encode(l),r={data:l},i=new Headers,[4,this.contextProvider.getContext()];case 1:return(o=e.sent()).authToken&&i.append("Authorization","Bearer "+o.authToken),o.instanceIdToken&&i.append("Firebase-Instance-ID-Token",o.instanceIdToken),a=f.timeout||7e4,[4,Promise.race([this.postJSON(t,r,i),(n=a,new Promise(function(e,t){setTimeout(function(){t(new p("deadline-exceeded","deadline-exceeded"))},n)})),this.cancelAllRequests])];case 2:if(!(s=e.sent()))throw new p("cancelled","Firebase Functions instance was deleted.");if(u=m(s.status,s.json,this.serializer))throw u;if(!s.json)throw new p("internal","Response is not valid JSON object.");if(void 0===(c=s.json.data)&&(c=s.json.result),void 0===c)throw new p("internal","Response is missing data field.");return[2,{data:this.serializer.decode(c)}]}var n})})},b);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b(e,t,n,r){var i=this;void 0===r&&(r="us-central1"),this.app_=e,this.region_=r,this.serializer=new g,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return i.deleteService()}},this.contextProvider=new h(t,n),this.cancelAllRequests=new Promise(function(e){i.deleteService=function(){return e()}})}function w(e,t){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging");return new v(n,r,i,t)}var T;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
T={Functions:v},a.INTERNAL.registerComponent(new s.Component("functions",w,"PUBLIC").setServiceProps(T).setMultipleInstances(!0)),a.registerVersion("@firebase/functions","0.4.30")},191:function(e,t,n){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(16),a=(r=i)&&r.__esModule?r:{default:r};n(66);var s,u=n(27),p=n(17),c=n(32),h=n(126);var l=((s={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',s["only-available-in-window"]="This method is available in a Window context.",s["only-available-in-sw"]="This method is available in a service worker context.",s["permission-default"]="The notification permission was not granted and dismissed instead.",s["permission-blocked"]="The notification permission was not granted and blocked instead.",s["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",s["failed-service-worker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",s["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",s["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",s["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",s["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",s["token-update-no-token"]="FCM returned no token when updating the user to push.",s["use-sw-after-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",s["invalid-sw-registration"]="The input to useServiceWorker() must be a ServiceWorkerRegistration.",s["invalid-bg-handler"]="The input to setBackgroundMessageHandler() must be a function.",s["invalid-vapid-key"]="The public VAPID key must be a string.",s["use-vapid-key-after-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",s),m=new c.ErrorFactory("messaging","Messaging",l);function f(e){return m.create("missing-app-config-values",{valueName:e})}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g(e){var t=new Uint8Array(e);return btoa(String.fromCharCode.apply(String,(0,p.__spread)(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var d="fcm_token_details_db",y=5,v="fcm_token_object_Store";function b(s){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,a,n=this;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return"databases"in indexedDB?[4,indexedDB.databases()]:[3,2];case 1:if(t=e.sent(),!t.map(function(e){return e.name}).includes(d))return[2,null];e.label=2;case 2:return[4,(a=null,h.openDb)(d,y,function(o){return(0,p.__awaiter)(n,void 0,void 0,function(){var t,n,r,i;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return o.oldVersion<2?[2]:o.objectStoreNames.contains(v)?[4,(t=o.transaction.objectStore(v)).index("fcmSenderId").get(s)]:[2];case 1:return n=e.sent(),[4,t.clear()];case 2:if(e.sent(),!n)return[2];if(2===o.oldVersion){if(!(r=n).auth||!r.p256dh||!r.endpoint)return[2];a={token:r.fcmToken,createTime:null!=(i=r.createTime)?i:Date.now(),subscriptionOptions:{auth:r.auth,p256dh:r.p256dh,endpoint:r.endpoint,swScope:r.swScope,vapidKey:"string"==typeof r.vapidKey?r.vapidKey:g(r.vapidKey)}}}else(3===o.oldVersion||4===o.oldVersion)&&(a={token:(r=n).fcmToken,createTime:r.createTime,subscriptionOptions:{auth:g(r.auth),p256dh:g(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:g(r.vapidKey)}});return[2]}})})})];case 3:return e.sent().close(),[4,(0,h.deleteDb)(d)];case 4:return e.sent(),[4,(0,h.deleteDb)("fcm_vapid_details_db")];case 5:return e.sent(),[4,(0,h.deleteDb)("undefined")];case 6:return e.sent(),[2,function(e){if(!e||!e.subscriptionOptions)return;var t=e.subscriptionOptions;return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(a)?a:null]}})})}var w="firebase-messaging-database",T=1,S="firebase-messaging-store",_=null;function E(){return _=_||(0,h.openDb)(w,T,function(e){switch(e.oldVersion){case 0:e.createObjectStore(S)}})}function I(i){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n,r;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return t=D(i),[4,E()];case 1:return[4,e.sent().transaction(S).objectStore(S).get(t)];case 2:return(n=e.sent())?[2,n]:[3,3];case 3:return[4,b(i.appConfig.senderId)];case 4:return(r=e.sent())?[4,C(i,r)]:[3,6];case 5:return e.sent(),[2,r];case 6:return[2]}})})}function C(i,o){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n,r;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return t=D(i),[4,E()];case 1:return n=e.sent(),[4,(r=n.transaction(S,"readwrite")).objectStore(S).put(o,t)];case 2:return e.sent(),[4,r.complete];case 3:return e.sent(),[2,o]}})})}function D(e){return e.appConfig.appId}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var A="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",N="https://fcmregistrations.googleapis.com/v1",k="google.c.a.c_id";function M(a,s){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return[4,O(a)];case 1:t=e.sent(),n={method:"DELETE",headers:t},e.label=2;case 2:return e.trys.push([2,5,,6]),[4,fetch(R(a.appConfig)+"/"+s,n)];case 3:return[4,e.sent().json()];case 4:if((r=e.sent()).error)throw i=r.error.message,m.create("token-unsubscribe-failed",{errorInfo:i});return[3,6];case 5:throw o=e.sent(),m.create("token-unsubscribe-failed",{errorInfo:o});case 6:return[2]}})})}function R(e){var t=e.projectId;return N+"/projects/"+t+"/registrations"}function O(e){var n=e.appConfig,r=e.installations;return(0,p.__awaiter)(this,void 0,void 0,function(){var t;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return[4,r.getToken()];case 1:return t=e.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})]}})})}function L(e){var t=e.p256dh,n=e.auth,r=e.endpoint,i=e.vapidKey,o={web:{endpoint:r,auth:n,p256dh:t}};return i!==A&&(o.web.applicationPubKey=i),o}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var P,x;function F(l,f,d){return(0,p.__awaiter)(this,void 0,void 0,function(){var s,u,c,h;return(0,p.__generator)(this,function(e){switch(e.label){case 0:if("granted"!==Notification.permission)throw m.create("permission-blocked");return[4,function(n,r){return(0,p.__awaiter)(this,void 0,void 0,function(){var t;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return[4,n.pushManager.getSubscription()];case 1:return(t=e.sent())?[2,t]:[2,n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r})]}})})}(f,d)];case 1:return s=e.sent(),[4,I(l)];case 2:return u=e.sent(),c={vapidKey:d,swScope:f.scope,endpoint:s.endpoint,auth:g(s.getKey("auth")),p256dh:g(s.getKey("p256dh"))},u?[3,3]:[2,V(l,c)];case 3:if(t=u.subscriptionOptions,r=(n=c).vapidKey===t.vapidKey,i=n.endpoint===t.endpoint,o=n.auth===t.auth,a=n.p256dh===t.p256dh,r&&i&&o&&a)return[3,8];e.label=4;case 4:return e.trys.push([4,6,,7]),[4,M(l,u.token)];case 5:return e.sent(),[3,7];case 6:return h=e.sent(),console.warn(h),[3,7];case 7:return[2,V(l,c)];case 8:return Date.now()>=u.createTime+6048e5?[2,function(i,o,a){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n,r;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,5]),[4,function(s,u){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o,a;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return[4,O(s)];case 1:t=e.sent(),n=L(u.subscriptionOptions),r={method:"PATCH",headers:t,body:JSON.stringify(n)},e.label=2;case 2:return e.trys.push([2,5,,6]),[4,fetch(R(s.appConfig)+"/"+u.token,r)];case 3:return[4,e.sent().json()];case 4:return i=e.sent(),[3,6];case 5:throw o=e.sent(),m.create("token-update-failed",{errorInfo:o});case 6:if(i.error)throw a=i.error.message,m.create("token-update-failed",{errorInfo:a});if(!i.token)throw m.create("token-update-no-token");return[2,i.token]}})})}(o,i)];case 1:return t=e.sent(),n=(0,p.__assign)({token:t,createTime:Date.now()},i),[4,C(o,n)];case 2:return e.sent(),[2,t];case 3:return r=e.sent(),[4,q(o,a)];case 4:throw e.sent(),r;case 5:return[2]}})})}({token:u.token,createTime:Date.now(),subscriptionOptions:c},l,f)]:[2,u.token];case 9:return[2]}var t,n,r,i,o,a;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */})})}function q(r,i){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return[4,I(r)];case 1:return(t=e.sent())?[4,M(r,t.token)]:[3,4];case 2:return e.sent(),[4,function(i){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n,r;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return t=D(i),[4,E()];case 1:return n=e.sent(),[4,(r=n.transaction(S,"readwrite")).objectStore(S).delete(t)];case 2:return e.sent(),[4,r.complete];case 3:return e.sent(),[2]}})})}(r)];case 3:e.sent(),e.label=4;case 4:return[4,i.pushManager.getSubscription()];case 5:return(n=e.sent())?[2,n.unsubscribe()]:[2,!0]}})})}function V(r,i){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return[4,
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(s,u){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o,a;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return[4,O(s)];case 1:t=e.sent(),n=L(u),r={method:"POST",headers:t,body:JSON.stringify(n)},e.label=2;case 2:return e.trys.push([2,5,,6]),[4,fetch(R(s.appConfig),r)];case 3:return[4,e.sent().json()];case 4:return i=e.sent(),[3,6];case 5:throw o=e.sent(),m.create("token-subscribe-failed",{errorInfo:o});case 6:if(i.error)throw a=i.error.message,m.create("token-subscribe-failed",{errorInfo:a});if(!i.token)throw m.create("token-subscribe-no-token");return[2,i.token]}})})}(r,i)];case 1:return t=e.sent(),n={token:t,createTime:Date.now(),subscriptionOptions:i},[4,C(r,n)];case 2:return e.sent(),[2,n.token]}})})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function B(e){return"object"===(void 0===e?"undefined":o(e))&&e&&k in e}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(x=P=P||{}).PUSH_RECEIVED="push-received",x.NOTIFICATION_CLICKED="notification-clicked";var U=(Object.defineProperty(j.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!0,configurable:!0}),j.prototype.getToken=function(){return(0,p.__awaiter)(this,void 0,void 0,function(){var t;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return this.vapidKey||(this.vapidKey=A),[4,this.getServiceWorkerRegistration()];case 1:return t=e.sent(),"default"!==Notification.permission?[3,3]:[4,Notification.requestPermission()];case 2:e.sent(),e.label=3;case 3:if("granted"!==Notification.permission)throw m.create("permission-blocked");return[2,F(this.firebaseDependencies,t,this.vapidKey)]}})})},j.prototype.deleteToken=function(){return(0,p.__awaiter)(this,void 0,void 0,function(){var t;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return[4,this.getServiceWorkerRegistration()];case 1:return t=e.sent(),[2,q(this.firebaseDependencies,t)]}})})},j.prototype.requestPermission=function(){return(0,p.__awaiter)(this,void 0,void 0,function(){var t;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?m.create("permission-blocked"):m.create("permission-default")}})})},j.prototype.usePublicVapidKey=function(e){if(null!==this.vapidKey)throw m.create("use-vapid-key-after-get-token");if("string"!=typeof e||0===e.length)throw m.create("invalid-vapid-key");this.vapidKey=e},j.prototype.useServiceWorker=function(e){if(!(e instanceof ServiceWorkerRegistration))throw m.create("invalid-sw-registration");if(this.swRegistration)throw m.create("use-sw-after-get-token");this.swRegistration=e},j.prototype.onMessage=function(e){var t=this;return this.onMessageCallback="function"==typeof e?e:e.next,function(){t.onMessageCallback=null}},j.prototype.setBackgroundMessageHandler=function(){throw m.create("only-available-in-sw")},j.prototype.onTokenRefresh=function(){return function(){}},j.prototype.getServiceWorkerRegistration=function(){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,p.__generator)(this,function(e){switch(e.label){case 0:if(this.swRegistration)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this,[4,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"})];case 2:return t.swRegistration=e.sent(),[3,4];case 3:throw n=e.sent(),m.create("failed-service-worker-registration",{browserErrorMessage:n.message});case 4:return[2,this.swRegistration]}})})},j.prototype.messageEventListener=function(o){var a;return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n,r,i;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return null!==(a=o.data)&&void 0!==a&&a.firebaseMessaging?(t=o.data.firebaseMessaging,n=t.type,r=t.payload,this.onMessageCallback&&n===P.PUSH_RECEIVED&&this.onMessageCallback(r),B(i=r.data)&&"1"===i["google.c.a.e"]?[4,this.logEvent(n,i)]:[3,2]):[2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},j.prototype.logEvent=function(n,r){return(0,p.__awaiter)(this,void 0,void 0,function(){var t;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return t=function(e){switch(e){case P.NOTIFICATION_CLICKED:return"notification_open";case P.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n),[4,this.firebaseDependencies.analyticsProvider.get()];case 1:return e.sent().logEvent(t,{message_id:r[k],message_name:r["google.c.a.c_l"],message_time:r["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)}),[2]}})})},j);function j(e){var t=this;this.firebaseDependencies=e,this.vapidKey=null,this.onMessageCallback=null,navigator.serviceWorker.addEventListener("message",function(e){return t.messageEventListener(e)})}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var K=(Object.defineProperty(W.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!0,configurable:!0}),W.prototype.setBackgroundMessageHandler=function(e){if(!e||"function"!=typeof e)throw m.create("invalid-bg-handler");this.bgMessageHandler=e},W.prototype.getToken=function(){var n,r,i;return(0,p.__awaiter)(this,void 0,void 0,function(){var t;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return this.vapidKey?[3,2]:[4,I(this.firebaseDependencies)];case 1:t=e.sent(),this.vapidKey=null!=(i=null===(r=null===(n=t)||void 0===n?void 0:n.subscriptionOptions)||void 0===r?void 0:r.vapidKey)?i:A,e.label=2;case 2:return[2,F(this.firebaseDependencies,self.registration,this.vapidKey)]}})})},W.prototype.deleteToken=function(){return q(this.firebaseDependencies,self.registration)},W.prototype.requestPermission=function(){throw m.create("only-available-in-window")},W.prototype.usePublicVapidKey=function(e){if(null!==this.vapidKey)throw m.create("use-vapid-key-after-get-token");if("string"!=typeof e||0===e.length)throw m.create("invalid-vapid-key");this.vapidKey=e},W.prototype.useServiceWorker=function(){throw m.create("only-available-in-window")},W.prototype.onMessage=function(){throw m.create("only-available-in-window")},W.prototype.onTokenRefresh=function(){throw m.create("only-available-in-window")},W.prototype.onPush=function(i){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n,r;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return(t=function(e){var t=e.data;if(!t)return null;try{return t.json()}catch(e){return null}}(i))?[4,G()]:[2];case 1:return(n=e.sent()).some(function(e){return"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")})?[2,function(e,t){var n,r,i=Q(P.PUSH_RECEIVED,t);try{for(var o=(0,p.__values)(e),a=o.next();!a.done;a=o.next())a.value.postMessage(i)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}(n,t)]:(r=function(e){var t;if(e&&"object"===o(e.notification)){var n=(0,p.__assign)({},e.notification);return n.data=(0,p.__assign)((0,p.__assign)({},e.notification.data),((t={}).FCM_MSG=e,t)),n}}(t))?[4,function(e){var t,n=null!==(t=e.title)&&void 0!==t?t:"",r=e.actions,i=Notification.maxActions;return r&&i&&r.length>i&&console.warn("This browser only supports "+i+" actions. The remaining actions will not be displayed."),self.registration.showNotification(n,e)}(r)]:[3,3];case 2:return e.sent(),[3,5];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(t)]:[3,5];case 4:e.sent(),e.label=5;case 5:return[2]}})})},W.prototype.onSubChange=function(n){var r,i,o;return(0,p.__awaiter)(this,void 0,void 0,function(){var t;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return n.newSubscription?[3,2]:[4,q(this.firebaseDependencies,self.registration)];case 1:return e.sent(),[2];case 2:return[4,I(this.firebaseDependencies)];case 3:return t=e.sent(),[4,q(this.firebaseDependencies,self.registration)];case 4:return e.sent(),[4,F(this.firebaseDependencies,self.registration,null!=(o=null===(i=null===(r=t)||void 0===r?void 0:r.subscriptionOptions)||void 0===i?void 0:i.vapidKey)?o:A)];case 5:return e.sent(),[2]}})})},W.prototype.onNotificationClick=function(a){var s,u;return(0,p.__awaiter)(this,void 0,void 0,function(){var n,r,i,o;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return!(n=null===(u=null===(s=a.notification)||void 0===s?void 0:s.data)||void 0===u?void 0:u.FCM_MSG)||a.action?[2]:(a.stopImmediatePropagation(),a.notification.close(),(r=function(e){var t,n,r,i=null!==(n=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==n?n:null===(r=e.notification)||void 0===r?void 0:r.click_action;return i||(B(e.data)?self.location.origin:null)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n))?[4,function(u){return(0,p.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o,a,s;return(0,p.__generator)(this,function(e){switch(e.label){case 0:return t=new URL(u,self.location.href).href,[4,G()];case 1:n=e.sent();try{for(r=(0,p.__values)(n),i=r.next();!i.done;i=r.next())if(o=i.value,new URL(o.url,self.location.href).href===t)return[2,o]}catch(e){a={error:e}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(a)throw a.error}}return[2,null]}})})}(r)]:[2]);case 1:return(i=e.sent())?[3,4]:[4,self.clients.openWindow(r)];case 2:return i=e.sent(),[4,(t=3e3,new Promise(function(e){setTimeout(e,t)}))];case 3:return e.sent(),[3,6];case 4:return[4,i.focus()];case 5:i=e.sent(),e.label=6;case 6:return i?(o=Q(P.NOTIFICATION_CLICKED,n),[2,i.postMessage(o)]):[2]}var t})})},W);function W(e){var t=this;this.firebaseDependencies=e,this.vapidKey=null,this.bgMessageHandler=null,self.addEventListener("push",function(e){e.waitUntil(t.onPush(e))}),self.addEventListener("pushsubscriptionchange",function(e){e.waitUntil(t.onSubChange(e))}),self.addEventListener("notificationclick",function(e){e.waitUntil(t.onNotificationClick(e))})}function G(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function Q(e,t){return{firebaseMessaging:{type:e,payload:t}}}var z={isSupported:H};function H(){return self&&"ServiceWorkerGlobalScope"in self?"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}a.default.INTERNAL.registerComponent(new u.Component("messaging",function(e){var t=e.getProvider("app").getImmediate(),n={app:t,appConfig:
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){var t,n;if(!e||!e.options)throw f("App Configuration Object");if(!e.name)throw f("App Name");var r=e.options;try{for(var i=(0,p.__values)(["projectId","apiKey","appId","messagingSenderId"]),o=i.next();!o.done;o=i.next()){var a=o.value;if(!r[a])throw f(a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return{appName:e.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}}(t),installations:e.getProvider("installations").getImmediate(),analyticsProvider:e.getProvider("analytics-internal")};if(!H())throw m.create("unsupported-browser");return new(self&&"ServiceWorkerGlobalScope"in self?K:U)(n)},"PUBLIC").setServiceProps(z))},192:function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var i,o=(i=n(16))&&"object"===(void 0===i?"undefined":r(i))&&"default"in i?i.default:i;n(66);var a,s,u,c,h=n(17),l=n(32),f=n(57),d=n(27),p="0.2.30",m="FB-PERF-TRACE-MEASURE",g="@firebase/performance/config",y="@firebase/performance/configexpire",v="Performance",b=((a={})["trace started"]="Trace {$traceName} was started before.",a["trace stopped"]="Trace {$traceName} is not running.",a["no window"]="Window is not available.",a["no app id"]="App id is not available.",a["no project id"]="Project id is not available.",a["no api key"]="Api key is not available.",a["invalid cc log"]="Attempted to queue invalid cc event",a["FB not default"]="Performance can only start when Firebase app instance is the default one.",a["RC response not ok"]="RC response is not ok",a["invalid attribute name"]="Attribute name {$attributeName} is invalid.",a["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",a["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",a),w=new l.ErrorFactory("performance",v,b),T=(S.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},S.prototype.mark=function(e){this.performance&&this.performance.mark&&this.performance.mark(e)},S.prototype.measure=function(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)},S.prototype.getEntriesByType=function(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]},S.prototype.getEntriesByName=function(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]},S.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},S.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},S.prototype.setupObserver=function(e,i){this.PerformanceObserver&&new this.PerformanceObserver(function(e){for(var t=0,n=e.getEntries();t<n.length;t++){var r=n[t];i(r)}}).observe({entryTypes:[e]})},S.getInstance=function(){return void 0===s&&(s=new S(u)),s},S);function S(e){if(!(this.window=e))throw w.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}var _,E,I,C=(D.prototype.getAppId=function(){var e=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!e)throw w.create("no app id");return e},D.prototype.getProjectId=function(){var e=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!e)throw w.create("no project id");return e},D.prototype.getApiKey=function(){var e=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!e)throw w.create("no api key");return e},D.getInstance=function(){return void 0===c&&(c=new D),c},D);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function A(){return _}(I=E=E||{})[I.UNKNOWN=0]="UNKNOWN",I[I.VISIBLE=1]="VISIBLE",I[I.HIDDEN=2]="HIDDEN";var N=["firebase_","google_","ga_"],k=new RegExp("^[a-zA-Z]\\w*$");function M(){switch(T.getInstance().document.visibilityState){case"visible":return E.VISIBLE;case"hidden":return E.HIDDEN;default:return E.UNKNOWN}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var R=new f.Logger(v);R.logLevel=f.LogLevel.INFO;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var O="0.0.1",L={loggingEnabled:!0},P="FIREBASE_INSTALLATIONS_AUTH";function x(e){var r,t=function(){var e=T.getInstance().localStorage;if(!e)return;var t=e.getItem(y);if(!t||!function(e){return Number(e)>Date.now()}(t))return;var n=e.getItem(g);if(!n)return;try{return JSON.parse(n)}catch(e){return}}();return t?(q(t),Promise.resolve()):(r=e,function(){var e=C.getInstance().installationsService.getToken();return e.then(function(e){}),e}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */().then(function(e){var t="https://firebaseremoteconfig.googleapis.com/v1/projects/"+C.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+C.getInstance().getApiKey(),n=new Request(t,{method:"POST",headers:{Authorization:P+" "+e},body:JSON.stringify({app_instance_id:r,app_instance_id_token:e,app_id:C.getInstance().getAppId(),app_version:p,sdk_version:O})});return fetch(n).then(function(e){if(e.ok)return e.json();throw w.create("RC response not ok")})}).catch(function(){R.info(F)}).then(function(e){return q(e)}).then(function(e){return function(e){var t=T.getInstance().localStorage;if(!e||!t)return;t.setItem(g,JSON.stringify(e)),t.setItem(y,String(Date.now()+60*C.getInstance().configTimeToLive*60*1e3))}(e)},function(){}))}var F="Could not fetch config, will use default configs";function q(e){if(!e)return e;var t=C.getInstance(),n=e.entries||{};return t.loggingEnabled=void 0!==n.fpr_enabled?"true"===String(n.fpr_enabled):L.loggingEnabled,n.fpr_log_source&&(t.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(t.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),t.logTraceAfterSampling=V(t.tracesSamplingRate),t.logNetworkAfterSampling=V(t.networkRequestsSamplingRate),e}function V(e){return Math.random()<=e}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var B,U=1;function j(){return U=2,B=B||function(){var n=T.getInstance().document;return new Promise(function(t){n&&"complete"!==n.readyState?n.addEventListener("readystatechange",function e(){"complete"===n.readyState&&(n.removeEventListener("readystatechange",e),t())}):t()})}().then(function(){return(e=C.getInstance().installationsService.getId()).then(function(e){_=e}),e;var e}).then(function(e){return x(e)}).then(function(){return K()},function(){return K()})}function K(){U=3}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var W,G=1e4,Q=5500,z=3,H=z,Y=[],J=!1;function X(){J||(!function r(e){setTimeout(function(){if(0!==H){if(!Y.length)return r(G);var e=h.__spreadArrays(Y);Y=[];var t=e.map(function(e){return{source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)}}),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:C.getInstance().logSource,log_event:t};fetch(C.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(n)}).then(function(e){return e.ok||R.info("Call to Firebase backend failed."),e.json()}).then(function(e){var t=Number(e.next_request_wait_millis),n=isNaN(t)?G:Math.max(G,t);H=z,r(n)}).catch(function(){Y=h.__spreadArrays(e,Y),H--,R.info("Tries left: "+H+"."),r(G)})}},e)}(Q),J=!0)}function $(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];!function(e){if(!e.eventTime||!e.message)throw w.create("invalid cc log");Y=h.__spreadArrays(Y,[e])}({message:n.apply(void 0,e),eventTime:Date.now()})}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z(e,t){(W=W||$(ne))(e,t)}function ee(e){var t=C.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&T.getInstance().requiredApisAvailable()&&(e.isAuto&&M()!==E.VISIBLE||t.loggingEnabled&&t.logTraceAfterSampling&&(3===U?te(e):j().then(function(){return te(e)},function(){return te(e)})))}function te(e){A()&&setTimeout(function(){return Z(e,1)},0)}function ne(e,t){return 0===t?(r={url:(n=e).url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},i={application_info:re(),network_request_metric:r},JSON.stringify(i)):function(e){var t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);var r={application_info:re(),trace_metric:t};return JSON.stringify(r)}(e);var n,r,i}function re(){return{google_app_id:C.getInstance().getAppId(),app_instance_id:A(),web_app_info:{sdk_version:p,page_url:T.getInstance().getUrl(),service_worker_status:"serviceWorker"in(e=T.getInstance().navigator)?e.serviceWorker.controller?2:3:1,visibility_state:M(),effective_connection_type:function(){var e=T.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0};var e}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ie=["_fp","_fcp","_fid"];
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var oe=(ae.prototype.start=function(){if(1!==this.state)throw w.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},ae.prototype.stop=function(){if(2!==this.state)throw w.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),ee(this)},ae.prototype.record=function(e,t,n){if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=h.__assign({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}ee(this)},ae.prototype.incrementMetric=function(e,t){void 0===t&&(t=1),void 0===this.counters[e]&&this.putMetric(e,0),this.counters[e]+=t},ae.prototype.putMetric=function(e,t){if(n=e,r=this.name,0===n.length||100<n.length||!(r&&r.startsWith("_wt_")&&-1<ie.indexOf(n))&&n.startsWith("_"))throw w.create("invalide custom metric name",{customMetricName:e});var n,r;this.counters[e]=t},ae.prototype.getMetric=function(e){return this.counters[e]||0},ae.prototype.putAttribute=function(e,t){var n,r,i=!(0===(n=e).length||40<n.length||N.some(function(e){return n.startsWith(e)})||!n.match(k)),o=0!==(r=t).length&&r.length<=100;if(i&&o)this.customAttributes[e]=t;else{if(!i)throw w.create("invalid attribute name",{attributeName:e});if(!o)throw w.create("invalid attribute value",{attributeValue:t})}},ae.prototype.getAttribute=function(e){return this.customAttributes[e]},ae.prototype.removeAttribute=function(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]},ae.prototype.getAttributes=function(){return h.__assign({},this.customAttributes)},ae.prototype.setStartTime=function(e){this.startTimeUs=e},ae.prototype.setDuration=function(e){this.durationUs=e},ae.prototype.calculateTraceMetrics=function(){var e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(1e3*t.duration),this.startTimeUs=Math.floor(1e3*(t.startTime+this.api.getTimeOrigin())))},ae.createOobTrace=function(e,t,n){var r=T.getInstance().getUrl();if(r){var i=new ae("_wt_"+r,!0),o=Math.floor(1e3*T.getInstance().getTimeOrigin());if(i.setStartTime(o),e&&e[0]&&(i.setDuration(Math.floor(1e3*e[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*e[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*e[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*e[0].loadEventEnd))),t){var a=t.find(function(e){return"first-paint"===e.name});a&&a.startTime&&i.putMetric("_fp",Math.floor(1e3*a.startTime));var s=t.find(function(e){return"first-contentful-paint"===e.name});s&&s.startTime&&i.putMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.putMetric("_fid",Math.floor(1e3*n))}ee(i)}},ae.createUserTimingTrace=function(e){ee(new ae(e,!1,e))},ae);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ae(e,t,n){void 0===t&&(t=!1),this.name=e,this.isAuto=t,this.state=1,this.customAttributes={},this.counters={},this.api=T.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||m+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function se(e){var t=e;if(t&&void 0!==t.responseStart){var n,r,i=T.getInstance().getTimeOrigin(),o=Math.floor(1e3*(t.startTime+i)),a=t.responseStart?Math.floor(1e3*(t.responseStart-t.startTime)):void 0,s=Math.floor(1e3*(t.responseEnd-t.startTime)),u={url:t.name&&t.name.split("?")[0],responsePayloadBytes:t.transferSize,startTimeUs:o,timeToResponseInitiatedUs:a,timeToResponseCompletedUs:s};n=u,(r=C.getInstance()).instrumentationEnabled&&n.url!==r.logEndPointUrl.split("?")[0]&&r.loggingEnabled&&r.logNetworkAfterSampling&&setTimeout(function(){return Z(n,0)},0)}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ue=5e3;function ce(){A()&&(setTimeout(function(){return function(){var e=T.getInstance(),t=e.getEntriesByType("navigation"),n=e.getEntriesByType("paint");if(e.onFirstInputDelay){var r=setTimeout(function(){oe.createOobTrace(t,n),r=void 0},ue);e.onFirstInputDelay(function(e){r&&(clearTimeout(r),oe.createOobTrace(t,n,e))})}else oe.createOobTrace(t,n)}()},0),setTimeout(function(){return function(){for(var e=T.getInstance(),t=e.getEntriesByType("resource"),n=0,r=t;n<r.length;n++){se(r[n])}e.setupObserver("resource",se)}()},0),setTimeout(function(){return function(){for(var e=T.getInstance(),t=e.getEntriesByType("measure"),n=0,r=t;n<r.length;n++){he(r[n])}e.setupObserver("measure",he)}()},0))}function he(e){var t=e.name;t.substring(0,m.length)!==m&&oe.createUserTimingTrace(t)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var le=(fe.prototype.trace=function(e){return new oe(e)},Object.defineProperty(fe.prototype,"instrumentationEnabled",{get:function(){return C.getInstance().instrumentationEnabled},set:function(e){C.getInstance().instrumentationEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fe.prototype,"dataCollectionEnabled",{get:function(){return C.getInstance().dataCollectionEnabled},set:function(e){C.getInstance().dataCollectionEnabled=e},enumerable:!0,configurable:!0}),fe);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fe(e){this.app=e,T.getInstance().requiredApisAvailable()?(X(),j().then(ce,ce)):R.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}function de(e){function r(e,t){if("[DEFAULT]"!==e.name)throw w.create("FB not default");if("undefined"==typeof window)throw w.create("no window");return u=window,C.getInstance().firebaseAppInstance=e,C.getInstance().installationsService=t,new le(e)}e.INTERNAL.registerComponent(new d.Component("performance",function(e){var t=e.getProvider("app").getImmediate(),n=e.getProvider("installations").getImmediate();return r(t,n)},"PUBLIC")),e.registerVersion("@firebase/performance","0.2.30")}de(o),t.registerPerformance=de},193:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.settings=t.resetGlobalVars=t.registerAnalytics=t.factory=void 0;var r,i=n(16),o=(r=i)&&r.__esModule?r:{default:r};n(66);var h=n(17),a=n(32),s=n(27);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var p,u,c,l,f,d="measurementId",m="firebase_id",g="origin",y="https://www.googletagmanager.com/gtag/js";function v(e,n,t){var f,d,r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];window[n].push(arguments)};return window[t]&&"function"==typeof window[t]&&(r=window[t]),window[t]=(f=r,d=e,function(e,t,n){if(e===p.EVENT){var r=[];if(n&&n.send_to){var i=n.send_to;Array.isArray(i)||(i=[i]);for(var o=0,a=i;o<a.length;o++){var s=a[o],u=d[s];if(!u){r=[];break}r.push(u)}}if(0===r.length)for(var c=0,h=Object.values(d);c<h.length;c++){var l=h[c];r.push(l)}Promise.all(r).then(function(){return f(p.EVENT,t,n||{})}).catch(function(e){return console.error(e)})}else e===p.CONFIG?(d[t]||Promise.resolve()).then(function(){f(p.CONFIG,t,n)}).catch(function(e){return console.error(e)}):f(p.SET,t)}),{gtagCore:r,wrappedGtag:window[t]}}(u=p=p||{}).EVENT="event",u.SET="set",u.CONFIG="config",(l=c=c||{}).ADD_PAYMENT_INFO="add_payment_info",l.ADD_TO_CART="add_to_cart",l.ADD_TO_WISHLIST="add_to_wishlist",l.BEGIN_CHECKOUT="begin_checkout",l.CHECKOUT_PROGRESS="checkout_progress",l.EXCEPTION="exception",l.GENERATE_LEAD="generate_lead",l.LOGIN="login",l.PAGE_VIEW="page_view",l.PURCHASE="purchase",l.REFUND="refund",l.REMOVE_FROM_CART="remove_from_cart",l.SCREEN_VIEW="screen_view",l.SEARCH="search",l.SELECT_CONTENT="select_content",l.SET_CHECKOUT_OPTION="set_checkout_option",l.SHARE="share",l.SIGN_UP="sign_up",l.TIMING_COMPLETE="timing_complete",l.VIEW_ITEM="view_item",l.VIEW_ITEM_LIST="view_item_list",l.VIEW_PROMOTION="view_promotion",l.VIEW_SEARCH_RESULTS="view_search_results";var b,w,T=((f={})["no-ga-id"]='"'+d+'" field is empty in Firebase config. Firebase Analytics requires this field to contain a valid measurement ID.',f["already-exists"]="A Firebase Analytics instance with the measurement ID ${id}  already exists. Only one Firebase Analytics instance can be created for each measurement ID.",f["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",f["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate",f),S=new a.ErrorFactory("analytics","Analytics",T),_={},E="dataLayer",I="gtag",C=!1;function D(e){if(C)throw S.create("already-initialized");e.dataLayerName&&(E=e.dataLayerName),e.gtagName&&(I=e.gtagName)}function A(e,t){var n,r,i,o,c=e.options[d];if(!c)throw S.create("no-ga-id");if(null!=_[c])throw S.create("already-exists",{id:c});if(!C){!function(){for(var e=window.document.getElementsByTagName("script"),t=0,n=Object.values(e);t<n.length;t++){var r=n[t];if(r.src&&r.src.includes(y))return r}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */()&&(i=E,(o=document.createElement("script")).src=y+"?l="+i,o.async=!0,document.head.appendChild(o)),n=E,r=[],Array.isArray(window[n])?r=window[n]:window[n]=r;var a=v(_,E,I),s=a.wrappedGtag,u=a.gtagCore;w=s,b=u,C=!0}return _[c]=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(r,i,o){return(0,h.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,h.__generator)(this,function(e){switch(e.label){case 0:return[4,i.getId()];case 1:return t=e.sent(),o("js",new Date),o(p.CONFIG,r.options[d],((n={})[m]=t,n[g]="firebase",n.update=!0,n)),[2]}})})}(e,t,b),{app:e,logEvent:function(e,t,n){return r=w,i=c,o=e,u=(a=t)||{},(s=n)&&s.global||(u=(0,h.__assign)((0,h.__assign)({},a),{send_to:i})),void r(p.EVENT,o,u||{});
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var r,i,o,a,s,u},setCurrentScreen:function(e,t){return n=w,r=c,i=e,void((o=t)&&o.global?n(p.SET,{screen_name:i}):n(p.CONFIG,r,{update:!0,screen_name:i}));var n,r,i,o},setUserId:function(e,t){return n=w,r=c,i=e,void((o=t)&&o.global?n(p.SET,{user_id:i}):n(p.CONFIG,r,{update:!0,user_id:i}));var n,r,i,o},setUserProperties:function(e,t){return function(e,t,n,r){if(r&&r.global){for(var i={},o=0,a=Object.keys(n);o<a.length;o++){var s=a[o];i["user_properties."+s]=n[s]}e(p.SET,i)}else e(p.CONFIG,t,{update:!0,user_properties:n})}(w,c,e,t)},setAnalyticsCollectionEnabled:function(e){return t=e,void(window["ga-disable-"+c]=!t);var t}}}function N(e){e.INTERNAL.registerComponent(new s.Component("analytics",function(e){return A(e.getProvider("app").getImmediate(),e.getProvider("installations").getImmediate())},"PUBLIC").setServiceProps({settings:D,EventName:c})),e.INTERNAL.registerComponent(new s.Component("analytics-internal",function(e){try{return{logEvent:e.getProvider("analytics").getImmediate().logEvent}}catch(e){throw S.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),e.registerVersion("@firebase/analytics","0.2.11")}N(o.default),t.factory=A,t.registerAnalytics=N,t.resetGlobalVars=function(e,t){void 0===e&&(e=!1),void 0===t&&(t={}),C=e,_=t,E="dataLayer",I="gtag"},t.settings=D},194:function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var i,o=(i=n(16))&&"object"===(void 0===i?"undefined":r(i))&&"default"in i?i.default:i;n(66);var a,S=n(17),f=n(32),g=n(57),s=n(27),y=(u.prototype.isCachedDataFresh=function(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,r=n<=e;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+e+". Is cache hit: "+r+"."),r},u.prototype.fetch=function(a){return S.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return S.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return t=e.sent(),n=t[0],(r=t[1])&&this.isCachedDataFresh(a.cacheMaxAgeMillis,n)?[2,r]:(a.eTag=r&&r.eTag,[4,this.client.fetch(a)]);case 2:return i=e.sent(),o=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===i.status&&o.push(this.storage.setLastSuccessfulFetchResponse(i)),[4,Promise.all(o)];case 3:return e.sent(),[2,i]}})})},u);function u(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}var c=((a={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",a["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",a["registration-api-key"]="Undefined API key. Check Firebase app initialization.",a["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",a["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",a["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",a["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",a["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",a["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",a["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',a["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',a["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",a["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",a),_=new f.ErrorFactory("remoteconfig","Remote Config",c);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var v=(h.prototype.fetch=function(T){return S.__awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,h,l,f,d,p,m,g,y,v,b,w;return S.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:n=e.sent(),r=n[0],i=n[1],o=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",a=o+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":T.eTag||"*"},u={sdk_version:this.sdkVersion,app_instance_id:r,app_instance_id_token:i,app_id:this.appId,language_code:(void 0===t&&(t=navigator),t.languages&&t.languages[0]||t.language)},c={method:"POST",headers:s,body:JSON.stringify(u)},h=fetch(a,c),l=new Promise(function(e,t){T.signal.addEventListener(function(){var e=new Error("The operation was aborted.");e.name="AbortError",t(e)})}),e.label=2;case 2:return e.trys.push([2,5,,6]),[4,Promise.race([h,l])];case 3:return e.sent(),[4,h];case 4:return f=e.sent(),[3,6];case 5:throw d=e.sent(),p="fetch-client-network","AbortError"===d.name&&(p="fetch-timeout"),_.create(p,{originalErrorMessage:d.message});case 6:if(m=f.status,g=f.headers.get("ETag")||void 0,200!==f.status)return[3,11];b=void 0,e.label=7;case 7:return e.trys.push([7,9,,10]),[4,f.json()];case 8:return b=e.sent(),[3,10];case 9:throw w=e.sent(),_.create("fetch-client-parse",{originalErrorMessage:w.message});case 10:y=b.entries,v=b.state,e.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===v?m=500:"NO_CHANGE"===v?m=304:"NO_TEMPLATE"!==v&&"EMPTY_CONFIG"!==v||(y={}),304!==m&&200!==m)throw _.create("fetch-status",{httpStatus:m});return[2,{status:m,eTag:g,config:y}]}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var t})})},h);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h(e,t,n,r,i,o){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}var l=(d.prototype.addEventListener=function(e){this.listeners.push(e)},d.prototype.abort=function(){this.listeners.forEach(function(e){return e()})},d);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d(){this.listeners=[]}var p=["1","true","t","yes","y","on"],m=(b.prototype.asString=function(){return this._value},b.prototype.asBoolean=function(){return"static"!==this._source&&0<=p.indexOf(this._value.toLowerCase())},b.prototype.asNumber=function(){if("static"===this._source)return 0;var e=Number(this._value);return isNaN(e)&&(e=0),e},b.prototype.getSource=function(){return this._source},b);function b(e,t){void 0===t&&(t=""),this._source=e,this._value=t}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var w=(T.prototype.setLogLevel=function(e){switch(e){case"debug":this._logger.logLevel=g.LogLevel.DEBUG;break;case"silent":this._logger.logLevel=g.LogLevel.SILENT;break;default:this._logger.logLevel=g.LogLevel.ERROR}},Object.defineProperty(T.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!0,configurable:!0}),Object.defineProperty(T.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!0,configurable:!0}),T.prototype.activate=function(){return S.__awaiter(this,void 0,void 0,function(){var t,n,r;return S.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return t=e.sent(),n=t[0],r=t[1],n&&n.config&&n.eTag&&n.eTag!==r?[4,Promise.all([this._storageCache.setActiveConfig(n.config),this._storage.setActiveConfigEtag(n.eTag)])]:[2,!1];case 2:return e.sent(),[2,!0]}})})},T.prototype.ensureInitialized=function(){var e=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then(function(){e._isInitializationComplete=!0})),this._initializePromise},T.prototype.fetch=function(){return S.__awaiter(this,void 0,void 0,function(){var r,i,o,a=this;return S.__generator(this,function(e){switch(e.label){case 0:r=new l,setTimeout(function(){return S.__awaiter(a,void 0,void 0,function(){return S.__generator(this,function(e){return r.abort(),[2]})})},this.settings.fetchTimeoutMillis),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:r})];case 2:return e.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return e.sent(),[3,6];case 4:return i=e.sent(),n="fetch-throttle",o=(t=i)instanceof f.FirebaseError&&-1!==t.code.indexOf(n)?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(o)];case 5:throw e.sent(),i;case 6:return[2]}var t,n})})},T.prototype.fetchAndActivate=function(){return S.__awaiter(this,void 0,void 0,function(){return S.__generator(this,function(e){switch(e.label){case 0:return[4,this.fetch()];case 1:return e.sent(),[2,this.activate()]}})})},T.prototype.getAll=function(){var n=this;return function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),Object.keys(S.__assign(S.__assign({},e),t))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._storageCache.getActiveConfig(),this.defaultConfig).reduce(function(e,t){return e[t]=n.getValue(t),e},{})},T.prototype.getBoolean=function(e){return this.getValue(e).asBoolean()},T.prototype.getNumber=function(e){return this.getValue(e).asNumber()},T.prototype.getString=function(e){return this.getValue(e).asString()},T.prototype.getValue=function(e){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+e+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var t=this._storageCache.getActiveConfig();return t&&void 0!==t[e]?new m("remote",t[e]):this.defaultConfig&&void 0!==this.defaultConfig[e]?new m("default",String(this.defaultConfig[e])):(this._logger.debug('Returning static value for key "'+e+'". Define a default or remote value if this is unintentional.'),new m("static"))},T);function T(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}function E(e,t){var n=e.target.error||void 0;return _.create(t,{originalErrorMessage:n&&n.message})}var I="app_namespace_store",C="firebase_remote_config",D=1;var A=(N.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},N.prototype.setLastFetchStatus=function(e){return this.set("last_fetch_status",e)},N.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},N.prototype.setLastSuccessfulFetchTimestampMillis=function(e){return this.set("last_successful_fetch_timestamp_millis",e)},N.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},N.prototype.setLastSuccessfulFetchResponse=function(e){return this.set("last_successful_fetch_response",e)},N.prototype.getActiveConfig=function(){return this.get("active_config")},N.prototype.setActiveConfig=function(e){return this.set("active_config",e)},N.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},N.prototype.setActiveConfigEtag=function(e){return this.set("active_config_etag",e)},N.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},N.prototype.setThrottleMetadata=function(e){return this.set("throttle_metadata",e)},N.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},N.prototype.get=function(s){return S.__awaiter(this,void 0,void 0,function(){var o,a=this;return S.__generator(this,function(e){switch(e.label){case 0:return[4,this.openDbPromise];case 1:return o=e.sent(),[2,new Promise(function(n,t){var e=o.transaction([I],"readonly").objectStore(I),r=a.createCompositeKey(s);try{var i=e.get(r);i.onerror=function(e){t(E(e,"storage-get"))},i.onsuccess=function(e){var t=e.target.result;n(t?t.value:void 0)}}catch(e){t(_.create("storage-get",{originalErrorMessage:e&&e.message}))}})]}})})},N.prototype.set=function(s,u){return S.__awaiter(this,void 0,void 0,function(){var o,a=this;return S.__generator(this,function(e){switch(e.label){case 0:return[4,this.openDbPromise];case 1:return o=e.sent(),[2,new Promise(function(e,t){var n=o.transaction([I],"readwrite").objectStore(I),r=a.createCompositeKey(s);try{var i=n.put({compositeKey:r,value:u});i.onerror=function(e){t(E(e,"storage-set"))},i.onsuccess=function(){e()}}catch(e){t(_.create("storage-set",{originalErrorMessage:e&&e.message}))}})]}})})},N.prototype.delete=function(s){return S.__awaiter(this,void 0,void 0,function(){var o,a=this;return S.__generator(this,function(e){switch(e.label){case 0:return[4,this.openDbPromise];case 1:return o=e.sent(),[2,new Promise(function(e,t){var n=o.transaction([I],"readwrite").objectStore(I),r=a.createCompositeKey(s);try{var i=n.delete(r);i.onerror=function(e){t(E(e,"storage-delete"))},i.onsuccess=function(){e()}}catch(e){t(_.create("storage-delete",{originalErrorMessage:e&&e.message}))}})]}})})},N.prototype.createCompositeKey=function(e){return[this.appId,this.appName,this.namespace,e].join()},N);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N(e,t,n,r){void 0===r&&(r=new Promise(function(t,n){var e=indexedDB.open(C,D);e.onerror=function(e){n(E(e,"storage-open"))},e.onsuccess=function(e){t(e.target.result)},e.onupgradeneeded=function(e){var t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(I,{keyPath:"compositeKey"})}}})),this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}var k=(M.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},M.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},M.prototype.getActiveConfig=function(){return this.activeConfig},M.prototype.loadFromStorage=function(){return S.__awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a;return S.__generator(this,function(e){switch(e.label){case 0:return t=this.storage.getLastFetchStatus(),n=this.storage.getLastSuccessfulFetchTimestampMillis(),r=this.storage.getActiveConfig(),[4,t];case 1:return(i=e.sent())&&(this.lastFetchStatus=i),[4,n];case 2:return(o=e.sent())&&(this.lastSuccessfulFetchTimestampMillis=o),[4,r];case 3:return(a=e.sent())&&(this.activeConfig=a),[2]}})})},M.prototype.setLastFetchStatus=function(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)},M.prototype.setLastSuccessfulFetchTimestampMillis=function(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)},M.prototype.setActiveConfig=function(e){return this.activeConfig=e,this.storage.setActiveConfig(e)},M);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M(e){this.storage=e}var R=(O.prototype.fetch=function(n){return S.__awaiter(this,void 0,void 0,function(){var t;return S.__generator(this,function(e){switch(e.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return t=e.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(n,t)]}})})},O.prototype.attemptFetch=function(c,e){var h=e.throttleEndTimeMillis,l=e.backoffCount;return S.__awaiter(this,void 0,void 0,function(){var a,s,u;return S.__generator(this,function(e){switch(e.label){case 0:return[4,(i=c.signal,o=h,new Promise(function(e,t){var n=Math.max(o-Date.now(),0),r=setTimeout(e,n);i.addEventListener(function(){clearTimeout(r),t(_.create("fetch-throttle",{throttleEndTimeMillis:o}))})}))];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this.client.fetch(c)];case 3:return a=e.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return e.sent(),[2,a];case 5:if(!function(e){if(e instanceof f.FirebaseError){var t=Number(e.httpStatus);return 429===t||500===t||503===t||504===t}}(s=e.sent()))throw s;return u={throttleEndTimeMillis:Date.now()+(t=l,n=1e3*Math.pow(2,t),r=Math.round(.5*n*(Math.random()-.5)*2),Math.min(144e5,n+r)),backoffCount:l+1},[4,this.storage.setThrottleMetadata(u)];case 6:return e.sent(),[2,this.attemptFetch(c,u)];case 7:return[2]}var t,n,r,i,o;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */})})},O);function O(e,t){this.client=e,this.storage=t}var L="@firebase/remote-config";
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function P(m){m.INTERNAL.registerComponent(new s.Component("remoteConfig",function(e,t){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations").getImmediate();if("undefined"==typeof window)throw _.create("registration-window");var i=n.options,o=i.projectId,a=i.apiKey,s=i.appId;if(!o)throw _.create("registration-project-id");if(!a)throw _.create("registration-api-key");if(!s)throw _.create("registration-app-id");t=t||"firebase";var u=new A(s,n.name,t),c=new k(u),h=new g.Logger(L);h.logLevel=g.LogLevel.ERROR;var l=new v(r,m.SDK_VERSION,t,o,a,s),f=new R(l,u),d=new y(f,u,c,h),p=new w(n,d,c,u,h);return p.ensureInitialized(),p},"PUBLIC").setMultipleInstances(!0)),m.registerVersion(L,"0.1.11")}P(o),t.registerRemoteConfig=P},66:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerInstallations=void 0;var r,i=n(16),o=(r=i)&&r.__esModule?r:{default:r},a=n(27),d=n(17),s=n(32),u=n(126);var c,h=1e4,p="w:0.4.0",l="FIS_v2",f="https://firebaseinstallations.googleapis.com/v1",m=36e5,g=((c={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',c["not-registered"]="Firebase Installation is not registered.",c["installation-not-found"]="Firebase Installation not found.",c["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',c["app-offline"]="Could not process request. Application offline.",c["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",c),y=new s.ErrorFactory("installations","Installations",g);function v(e){return e instanceof s.FirebaseError&&e.code.includes("request-failed")}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b(e){var t=e.projectId;return f+"/projects/"+t+"/installations"}function w(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}function T(r,i){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return[4,i.json()];case 1:return t=e.sent(),n=t.error,[2,y.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})]}})})}function S(e){var t=e.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function _(e,t){var n=t.refreshToken,r=S(e);return r.append("Authorization",l+" "+n),r}function E(n){return(0,d.__awaiter)(this,void 0,void 0,function(){var t;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return[4,n()];case 1:return 500<=(t=e.sent()).status&&t.status<600?[2,n()]:[2,t]}})})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function I(t){return new Promise(function(e){setTimeout(e,t)})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var C=/^[cdef][\w-]{21}$/,D="";function A(){try{var e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;var t=function(e){return btoa(String.fromCharCode.apply(String,(0,d.__spread)(e))).replace(/\+/g,"-").replace(/\//g,"_")}(e).substr(0,22);return C.test(t)?t:D}catch(e){return D}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function N(e){return e.appName+"!"+e.appId}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var k=new Map;function M(e,t){var n=N(e);R(n,t),function(e,t){var n=L();n&&n.postMessage({key:e,fid:t});P()}(n,t)}function R(e,t){var n,r,i=k.get(e);if(i)try{for(var o=(0,d.__values)(i),a=o.next();!a.done;a=o.next()){(0,a.value)(t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}var O=null;function L(){return!O&&"BroadcastChannel"in self&&((O=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(e){R(e.data.key,e.data.fid)}),O}function P(){0===k.size&&O&&(O.close(),O=null)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var x="firebase-installations-database",F=1,q="firebase-installations-store",V=null;function B(){return V=V||(0,u.openDb)(x,F,function(e){switch(e.oldVersion){case 0:e.createObjectStore(q)}})}function U(a,s){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return t=N(a),[4,B()];case 1:return n=e.sent(),r=n.transaction(q,"readwrite"),[4,(i=r.objectStore(q)).get(t)];case 2:return o=e.sent(),[4,i.put(s,t)];case 3:return e.sent(),[4,r.complete];case 4:return e.sent(),o&&o.fid===s.fid||M(a,s.fid),[2,s]}})})}function j(i){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n,r;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return t=N(i),[4,B()];case 1:return n=e.sent(),[4,(r=n.transaction(q,"readwrite")).objectStore(q).delete(t)];case 2:return e.sent(),[4,r.complete];case 3:return e.sent(),[2]}})})}function K(s,u){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o,a;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return t=N(s),[4,B()];case 1:return n=e.sent(),r=n.transaction(q,"readwrite"),[4,(i=r.objectStore(q)).get(t)];case 2:return o=e.sent(),void 0!==(a=u(o))?[3,4]:[4,i.delete(t)];case 3:return e.sent(),[3,6];case 4:return[4,i.put(a,t)];case 5:e.sent(),e.label=6;case 6:return[4,r.complete];case 7:return e.sent(),!a||o&&o.fid===a.fid||M(s,a.fid),[2,a]}})})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W(i){return(0,d.__awaiter)(this,void 0,void 0,function(){var r,t,n;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return[4,K(i,function(e){var t=Q(e||{fid:A(),registrationStatus:0}),n=function(e,t){{if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:function(o){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n,r,i;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return[4,G(o)];case 1:t=e.sent(),e.label=2;case 2:return 1!==t.registrationStatus?[3,5]:[4,I(100)];case 3:return e.sent(),[4,G(o)];case 4:return t=e.sent(),[3,2];case 5:return 0!==t.registrationStatus?[3,7]:[4,W(o)];case 6:return n=e.sent(),r=n.installationEntry,(i=n.registrationPromise)?[2,i]:[2,r];case 7:return[2,t]}})})}(e)}:{installationEntry:t};if(!navigator.onLine){var n=Promise.reject(y.create("app-offline"));return{installationEntry:t,registrationPromise:n}}var r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=function(r,i){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,7]),[4,
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(s,e){var u=e.fid;return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o,a;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return t=b(s),n=S(s),r={fid:u,authVersion:l,appId:s.appId,sdkVersion:p},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,E(function(){return fetch(t,i)})];case 1:return(o=e.sent()).ok?[4,o.json()]:[3,3];case 2:return a=e.sent(),[2,{fid:a.fid||u,registrationStatus:2,refreshToken:a.refreshToken,authToken:w(a.authToken)}];case 3:return[4,T("Create Installation",o)];case 4:throw e.sent()}})})}(r,i)];case 1:return t=e.sent(),[2,U(r,t)];case 2:return v(n=e.sent())&&409===n.serverCode?[4,j(r)]:[3,4];case 3:return e.sent(),[3,6];case 4:return[4,U(r,{fid:i.fid,registrationStatus:0})];case 5:e.sent(),e.label=6;case 6:throw n;case 7:return[2]}})})}(e,r);return{installationEntry:r,registrationPromise:i}}}(i,t);return r=n.registrationPromise,n.installationEntry})];case 1:return(t=e.sent()).fid!==D?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=e.sent(),n)];case 3:return[2,{installationEntry:t,registrationPromise:r}]}})})}function G(e){return K(e,function(e){if(!e)throw y.create("installation-not-found");return Q(e)})}function Q(e){return 1===(t=e).registrationStatus&&t.registrationTime+h<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}function z(e,h){var l=e.appConfig,f=e.platformLoggerProvider;return(0,d.__awaiter)(this,void 0,void 0,function(){var r,i,o,a,s,u,c;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return t=l,n=h.fid,r=b(t)+"/"+n+"/authTokens:generate",i=_(l,h),(o=f.getImmediate({optional:!0}))&&i.append("x-firebase-client",o.getPlatformInfoString()),a={installation:{sdkVersion:p}},s={method:"POST",headers:i,body:JSON.stringify(a)},[4,E(function(){return fetch(r,s)})];case 1:return(u=e.sent()).ok?[4,u.json()]:[3,3];case 2:return c=e.sent(),[2,w(c)];case 3:return[4,T("Generate Auth Token",u)];case 4:throw e.sent()}var t,n;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */})})}function H(s,u){return void 0===u&&(u=!1),(0,d.__awaiter)(this,void 0,void 0,function(){var a,t,n;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return[4,K(s.appConfig,function(e){if(!J(e))throw y.create("not-registered");var t,n,r,i=e.authToken;if(u||2!==(r=i).requestStatus||function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+m}(r)){if(1===i.requestStatus)return a=function(r,i){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return[4,Y(r.appConfig)];case 1:t=e.sent(),e.label=2;case 2:return 1!==t.authToken.requestStatus?[3,5]:[4,I(100)];case 3:return e.sent(),[4,Y(r.appConfig)];case 4:return t=e.sent(),[3,2];case 5:return 0===(n=t.authToken).requestStatus?[2,H(r,i)]:[2,n]}})})}(s,u),e;if(!navigator.onLine)throw y.create("app-offline");var o=(t=e,n={requestStatus:1,requestTime:Date.now()},(0,d.__assign)((0,d.__assign)({},t),{authToken:n}));return a=function(i,o){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n,r;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,8]),[4,z(i,o)];case 1:return t=e.sent(),r=(0,d.__assign)((0,d.__assign)({},o),{authToken:t}),[4,U(i.appConfig,r)];case 2:return e.sent(),[2,t];case 3:return!v(n=e.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,j(i.appConfig)];case 4:return e.sent(),[3,7];case 5:return r=(0,d.__assign)((0,d.__assign)({},o),{authToken:{requestStatus:0}}),[4,U(i.appConfig,r)];case 6:e.sent(),e.label=7;case 7:throw n;case 8:return[2]}})})}(s,o),o}return e})];case 1:return t=e.sent(),a?[4,a]:[3,3];case 2:return n=e.sent(),[3,4];case 3:n=t.authToken,e.label=4;case 4:return[2,n]}})})}function Y(e){return K(e,function(e){if(!J(e))throw y.create("not-registered");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+h<Date.now()?(0,d.__assign)((0,d.__assign)({},e),{authToken:{requestStatus:0}}):e})}function J(e){return void 0!==e&&2===e.registrationStatus}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function X(t,n){return void 0===n&&(n=!1),(0,d.__awaiter)(this,void 0,void 0,function(){return(0,d.__generator)(this,function(e){switch(e.label){case 0:return[4,function(n){return(0,d.__awaiter)(this,void 0,void 0,function(){var t;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return[4,W(n)];case 1:return(t=e.sent().registrationPromise)?[4,t]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t.appConfig)];case 1:return e.sent(),[4,H(t,n)];case 2:return[2,e.sent().token]}})})}function $(s,u){return(0,d.__awaiter)(this,void 0,void 0,function(){var r,i,o,a;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return t=s,n=u.fid,r=b(t)+"/"+n,i=_(s,u),o={method:"DELETE",headers:i},[4,E(function(){return fetch(r,o)})];case 1:return(a=e.sent()).ok?[3,3]:[4,T("Delete Installation",a)];case 2:throw e.sent();case 3:return[2]}var t,n;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */})})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Z(e,r){var i=e.appConfig;return function(e,t){L();var n=N(e),r=k.get(n);r||(r=new Set,k.set(n,r)),r.add(t)}(i,r),function(){var e,t,n;e=r,t=N(i),(n=k.get(t))&&(n.delete(e),0===n.size&&k.delete(t),P())}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ee(e){return y.create("missing-app-config-values",{valueName:e})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function te(e){e.INTERNAL.registerComponent(new a.Component("installations",function(e){var t=e.getProvider("app").getImmediate(),n={appConfig:function(e){var t,n;if(!e||!e.options)throw ee("App Configuration");if(!e.name)throw ee("App Name");try{for(var r=(0,d.__values)(["projectId","apiKey","appId"]),i=r.next();!i.done;i=r.next()){var o=i.value;if(!e.options[o])throw ee(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),platformLoggerProvider:e.getProvider("platform-logger")};return{app:t,getId:function(){
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
return function(i){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n,r;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return[4,W(i.appConfig)];case 1:return t=e.sent(),n=t.installationEntry,(r=t.registrationPromise)?r.catch(console.error):H(i).catch(console.error),[2,n.fid]}})})}(n)},getToken:function(e){return X(n,e)},delete:function(){return function(r){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return[4,K(t=r.appConfig,function(e){if(!e||0!==e.registrationStatus)return e})];case 1:if(!(n=e.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw y.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw y.create("app-offline");case 3:return[4,$(t,n)];case 4:return e.sent(),[4,j(t)];case 5:e.sent(),e.label=6;case 6:return[2]}})})}(n)},onIdChange:function(e){return Z(n,e)}}},"PUBLIC")),e.registerVersion("@firebase/installations","0.4.0")}te(o.default),t.registerInstallations=te}}]);