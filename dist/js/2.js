(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{152:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=r(59);t.default=function(){return e.createElement("div",{className:"d-flex justify-content-between mb-3 p-2 align-items-center"},e.createElement("div",{className:"logo"},e.createElement("img",{src:r(153),alt:"Logo",className:"ml-3 logo-image"})),e.createElement("div",{className:"menu"},e.createElement(n.NavLink,{activeClassName:"active",className:"mr-3",to:"/profile"},"Профиль"),e.createElement(n.NavLink,{activeClassName:"active",to:"/map",className:"mr-3"},"Карта"),e.createElement(n.NavLink,{activeClassName:"active",to:"/dashboard",className:"mr-3"},"Доска объявлений"),e.createElement(n.NavLink,{to:"/",onClick:function(){firebaseProj.auth().signOut()},className:"mr-3"},"Выйти")))}}).call(this,r(11))},153:function(e,t,r){e.exports=r.p+"assets/images/logo.jpg"},158:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(159));function s(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var s=t[a](o),i=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}r(160);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=null,this.googleMaps=t,this.geodecoder=new t.Geocoder,this.database=firebaseProj.database(),this.dbInfo=this.database.ref("/"),this.selectedAuto=null,this.orders=[],this.auto=[],this.icons={car:{free:r(363),wait:r(364),busy:r(365)},order:{free:r(366),inWait:r(367),inMove:r(368)}}}var t,i;return a(e,[{key:"animateMove",value:function(){var e=this;this.auto.forEach((function(t){if(t.inMove){var r=t.coords,n=e.orders.find((function(e){return e.orderID===t.orderID}));if((!t.path.steps.length||!t.path.steps[0].distance.value)&&t.path.loaded)if(n.status===o.ORDER_WAIT)t.status=o.AUTO_WAIT,t.path.loaded=!1,t.marker.setIcon(e.icons.car.wait),n.status=o.ORDER_AUTO,n.marker.setMap(null),e.updateAutoData(t.autoID,{status:o.AUTO_WAIT}).then((function(){return e.updateOrderData(n.orderID,{status:o.ORDER_AUTO})}));else if(n.status===o.ORDER_MOVE)return t.inMove=!1,n.status=o.ORDER_PAY,t.status=o.AUTO_PAY,n.marker.setMap(null),t.marker.setIcon(e.icons.car.wait),void e.updateAutoData(t.autoID,{status:o.AUTO_PAY}).then((function(){return e.updateOrderData(n.orderID,{status:o.ORDER_PAY})}));for(var a=.01,s={lat:r.lat,lng:r.lng};a>0&&t.path.steps.length;){var i=t.path.steps[0].end_point,u=Math.sqrt(Math.pow(r.lat-i.lat(),2)+Math.pow(r.lng-i.lng(),2));if(u>a){s=i;for(var c=0;c<t.path.steps[0].path.length;c++){var l=t.path.steps[0].path[c];if(Math.sqrt(Math.pow(r.lat-l.lat(),2)+Math.pow(r.lng-l.lng(),2))>a){s={lat:t.path.steps[0].path[c].lat(),lng:t.path.steps[0].path[c].lng()};break}}a=0}else s={lat:i.lat(),lng:i.lng()},a-=u,t.path.steps.shift()}n.status===o.ORDER_MOVE&&(t.distance+=e.googleMaps.geometry.spherical.computeDistanceBetween(new e.googleMaps.LatLng(t.coords.lat,t.coords.lng),new e.googleMaps.LatLng(s.lat,s.lng))/1e3),t.marker.setPosition(s),t.coords=s,e.updateAutoData(t.autoID,{coords:t.coords,distance:t.distance}),t.path.directionServ.route({origin:t.coords,destination:t.path.dest,travelMode:"DRIVING"},(function(e,r){"OK"===r?(t.path.steps=e.routes[0].legs[0].steps,t.path.directionRenderer.setDirections(e),t.path.steps[0].distance.value&&(t.path.loaded=!0)):alert("Directions request failed due to "+r)})),t.messageWindow.setContent(e.createContentForAuto(t))}}))}},{key:"createMap",value:function(e){this.map=new this.googleMaps.Map(e,{center:{lat:46.65,lng:32.58},zoom:15,mapTypeControl:!1}),setInterval(this.animateMove.bind(this),2e3)}},{key:"createOrder",value:(i=s(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.ORDER_FINISHED!==t.status){e.next=2;break}return e.abrupt("return");case 2:return r=this.icons.order.free,n=t.start,[o.ORDER_WAIT,o.ORDER_AUTO].includes(t.status)?r=this.icons.order.inWait:t.status!==o.ORDER_FREE&&(r=this.icons.order.inMove,n=t.destination),e.next=6,this.geocode({address:n});case 6:a=e.sent,t.coords=a[0].geometry.location,t.marker=this.createMarker(t.coords,r),[o.ORDER_PAY,o.ORDER_AUTO].includes(t.status)&&t.marker.setMap(null),t.messageWindow=this.createWindow(this.createContentForOrder(t)),t.marker.addListener("click",this.orderMarkerListener.bind(this,t)),this.orders.push(t);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"createAuto",value:function(e){var t=this.icons.car.free;[o.AUTO_WAIT,o.AUTO_PAY].includes(e.status)?t=this.icons.car.wait:e.status!==o.AUTO_FREE&&(t=this.icons.car.busy),e.marker=this.createMarker(e.coords,t),e.messageWindow=this.createWindow(this.createContentForAuto(e)),e.marker.addListener("click",this.autoMarkerClick.bind(this,e)),e.orderID&&""!==e.orderID&&o.AUTO_PAY!==e.status&&this.createPath(e),this.auto.push(e)}},{key:"createWindow",value:function(e){return new this.googleMaps.InfoWindow({content:e})}},{key:"createPath",value:function(e){var t=this.orders.find((function(t){return t.orderID===e.orderID})),r={dest:t.coords};r.directionServ=new this.googleMaps.DirectionsService,r.directionRenderer=new this.googleMaps.DirectionsRenderer({map:this.map,suppressMarkers:!0,preserveViewport:!0}),r.directionServ.route({origin:e.coords,destination:t.coords,travelMode:"DRIVING"},(function(t,n){"OK"===n?(e.inMove=!0,e.path.steps=t.routes[0].legs[0].steps,e.path.loaded=!0,r.directionRenderer.setDirections(t)):alert("Directions request failed due to "+n)})),e.path=r}},{key:"createMarker",value:function(e,t){return new this.googleMaps.Marker({map:this.map,position:e,icon:t})}},{key:"createContentForAuto",value:function(t){var r="";if(window.onAutoButClick=this.autoButClick.bind(this),t.orderID&&""!==t.orderID){var n=(t.distance*o.default).toFixed(2);r="<div>Номер заказа: "+t.orderID+"</div>",t.status!==o.AUTO_MOVE&&t.status!==o.AUTO_PAY||(r+="<div>Проехано на: "+n+" грн.</div>"),t.status===o.AUTO_WAIT&&(r+=e.makeBut(o.EVENT_WAIT,t.nomer,"Пассажир прибыл")),t.status===o.AUTO_PAY&&(r+=e.makeBut(o.EVENT_PAY,t.nomer,"Оплачено"))}else r=e.makeBut(o.EVENT_TRAVEL,t.nomer,"В путь");return'\n        <div class = "justify-content-center">\n            <div>Номер машины: '+t.nomer+"</div>\n            <div>Статус: "+t.status+"</div>\n            "+r+"\n        </div>"}},{key:"createContentForOrder",value:function(e){var t=Math.ceil((new Date-e.orderCreate)/6e4),r="";return r+='\n        <div class = "justify-content-center">\n            <div>Номер заказа: '+e.orderID+"</div>\n            <div>Телефон: "+e.phone+"</div>\n            <div>Пункт назначения: "+e.destination+"</div>",e.status===o.ORDER_FREE&&(r+="<div>Время ожидания: "+t+" минут</div>"),r+="<div>Статус: "+e.status+"</div></div>"}},{key:"eventTravelHandler",value:function(){this.selectedAuto&&this.selectedAuto.nomer===event.target.dataset.nomer?this.selectedAuto=null:(this.selectedAuto=this.auto.find((function(e){return e.nomer===event.target.dataset.nomer})),this.selectedAuto.messageWindow.setContent("<div>Выберите заказ</div>"))}},{key:"eventPayHandler",value:function(e,t){var r=this;this.updateAutoData(e.autoID,{status:o.AUTO_FREE,orderID:"",distance:0}).then((function(){return r.updateOrderData(t.orderID,{status:o.ORDER_FINISHED,price:(e.distance*o.default).toFixed(2),orderFinished:+new Date})})).then((function(){e.orderID="",e.distance=0,e.inMove=!1,e.status=o.AUTO_FREE,e.path={},e.marker.setIcon(r.icons.car.free),e.messageWindow.close()}))}},{key:"eventWaitHandler",value:function(e,t){var r=this;e.status=o.AUTO_MOVE,e.marker.setIcon(this.icons.car.busy),t.status=o.ORDER_MOVE,this.geocode({address:t.destination}).then((function(n){r.updateAutoData(e.autoID,{status:o.AUTO_MOVE}).then((function(){return r.updateOrderData(t.orderID,{status:o.ORDER_MOVE})})).then((function(){t.marker.setPosition(n[0].geometry.location),t.marker.setMap(r.map),t.marker.setIcon(r.icons.order.inMove),e.path.dest=n[0].geometry.location,e.path.loaded=!1}))}))}},{key:"loadData",value:(t=s(regeneratorRuntime.mark((function e(t){var r,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(t.orders);case 1:if((e.t1=e.t0()).done){e.next=8;break}return r=e.t1.value,console.log(t.orders[r]),e.next=6,this.createOrder(n({orderID:r},t.orders[r]));case 6:e.next=1;break;case 8:t.auto.forEach((function(e,t){e&&a.createAuto(n({autoID:t},e))}));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"orderMarkerListener",value:function(e){var t=this;this.selectedAuto?e.status!==o.ORDER_FREE?alert("Невозможно выбрать заказ который уже принят!"):(this.selectedAuto.marker.setIcon(this.icons.car.busy),e.marker.setIcon(this.icons.order.inWait),e.status=o.ORDER_WAIT,e.messageWindow.setContent(this.createContentForOrder(e)),this.selectedAuto.inMove=!0,this.selectedAuto.orderID=e.orderID,this.selectedAuto.status=o.AUTO_ORDER,this.selectedAuto.messageWindow.setContent(this.createContentForAuto(this.selectedAuto)),this.selectedAuto.messageWindow.close(),this.updateOrderData(e.orderID,{autoID:this.selectedAuto.autoID,status:o.ORDER_WAIT,orderAccept:+new Date}).then((function(){return t.updateAutoData(t.selectedAuto.autoID,{orderID:e.orderID,status:o.AUTO_ORDER})})).then((function(){t.createPath(t.selectedAuto),t.selectedAuto=null}))):(e.messageWindow.setContent(this.createContentForOrder(e)),e.messageWindow.open(this.map,e.marker))}},{key:"autoMarkerClick",value:function(e){this.selectedAuto?alert("Выберите заказ или отмените выбор заказа"):(e.messageWindow.setContent(this.createContentForAuto(e)),e.messageWindow.open(this.map,e.marker))}},{key:"autoButClick",value:function(e){var t=e.target.dataset.type,r=this.auto.find((function(t){return t.nomer===e.target.dataset.nomer}));console.log(this);var n=this.orders.find((function(e){return e.orderID===r.orderID}));t===o.EVENT_TRAVEL?this.eventTravelHandler():t===o.EVENT_WAIT?this.eventWaitHandler(r,n):t===o.EVENT_PAY&&this.eventPayHandler(r,n)}},{key:"geocode",value:function(e){var t=this;return new Promise((function(r,n){try{t.geodecoder.geocode(e,(function(e,t){"OK"!==t?n(e):r(e)}))}catch(e){n(e)}}))}},{key:"updateAutoData",value:function(e,t){return console.log("Auto:",t),this.dbInfo.child("auto/"+e).update(t)}},{key:"updateOrderData",value:function(e,t){return console.log("Order:",t),this.dbInfo.child("orders/"+e).update(t)}}],[{key:"makeBut",value:function(e,t,r){return"<div \n                    onclick = \"onAutoButClick(event)\"\n                    class = 'btn btn-link'\n                    data-type = "+e+" \n                    data-nomer = "+t+">\n                        "+r+"\n                    </div>"}}]),e}();t.default=i},159:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AUTO_FREE="Free",t.AUTO_ORDER="MoveToOrder",t.AUTO_WAIT="Wait",t.AUTO_MOVE="Move",t.AUTO_PAY="Pay",t.ORDER_FREE="Free",t.ORDER_WAIT="Wait",t.ORDER_AUTO="MoveToAuto",t.ORDER_MOVE="Move",t.ORDER_PAY="Pay",t.ORDER_FINISHED="Finished",t.EVENT_TRAVEL="InTravel",t.EVENT_PAY="Pay",t.EVENT_WAIT="Wait";t.default=10},363:function(e,t,r){e.exports=r.p+"assets/images/carFree.png"},364:function(e,t,r){e.exports=r.p+"assets/images/carWait.png"},365:function(e,t,r){e.exports=r.p+"assets/images/carBusy.png"},366:function(e,t,r){e.exports=r.p+"assets/images/peopleFree.png"},367:function(e,t,r){e.exports=r.p+"assets/images/peopleBusy.png"},368:function(e,t,r){e.exports=r.p+"assets/images/target.png"},369:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function(t){function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.onFormChange=t.onFormChange.bind(t),t.addOrder=t.addOrder.bind(t),t.state={fieldsValue:{orderStart:"",orderDestination:"",orderPhone:""},fieldsError:{},savingError:null},t}var o,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,t),n(a,[{key:"render",value:function(){return console.log(this.state),e.createElement("form",{onSubmit:this.addOrder,className:"w-50 align-items-center d-flex flex-column"},this.state.savingError?e.createElement("div",{className:"alert alert-danger"},this.state.savingError):null,e.createElement("h3",{className:"text-center"},"Добавить заказ"),e.createElement("input",{type:"text",name:"orderStart",onInput:this.onFormChange,value:this.state.fieldsValue.orderStart,className:"form-control",placeholder:"Enter start address"}),e.createElement("label",{className:"text-danger text-small"},this.state.fieldsError.orderStart),e.createElement("input",{type:"text",name:"orderDestination",onInput:this.onFormChange,value:this.state.fieldsValue.orderDestination,className:"form-control",placeholder:"Enter destination address"}),e.createElement("label",{className:"text-danger text-small"},this.state.fieldsError.orderDestination),e.createElement("input",{type:"text",name:"orderPhone",onInput:this.onFormChange,value:this.state.fieldsValue.orderPhone,className:"form-control",placeholder:"Enter your phone"}),e.createElement("label",{className:"text-danger text-small"},this.state.fieldsError.orderPhone),e.createElement("button",{type:"submit",name:"create",className:"btn btn-primary mt-3 w-50"},"Создать"))}},{key:"onFormChange",value:function(e){var t=e.target;this.setState((function(e){return{fieldsValue:r({},e.fieldsValue,(n={},a=t.name,o=t.value,a in n?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o,n))};var n,a,o}))}},{key:"addOrder",value:(o=regeneratorRuntime.mark((function e(t){var n,a,o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n=this.testForm(),this.setState({fieldsError:n}),!Object.keys(n).length){e.next=5;break}return e.abrupt("return");case 5:return a={destination:this.state.fieldsValue.orderDestination,start:this.state.fieldsValue.orderStart,status:"Free",orderCreate:+new Date,phone:this.state.fieldsValue.orderPhone,user:firebaseProj.auth().currentUser.uid},e.next=8,firebaseProj.database().ref("/orders").push(a);case 8:(o=e.sent).set(a).then((function(){s.props.onCreate(r({orderID:o.key},a)),s.setState({fieldsError:{},fieldsValue:{orderStart:"",orderDestination:"",orderPhone:""},savingError:null})}),(function(e){s.setState({savingError:e.message})}));case 10:case"end":return e.stop()}}),e,this)})),s=function(){var e=o.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var s=e[a](o),i=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return s.apply(this,arguments)})},{key:"testForm",value:function(){var e={};return new RegExp("\\+\\d{10}").test(this.state.fieldsValue.orderPhone)||(e.orderPhone="Input correct phone(like +380501122333)"),this.state.fieldsValue.orderStart||(e.userName="Enter start address!"),this.state.fieldsValue.orderDestination||(e.userName="Enter destination address!"),e}}]),a}(e.Component);t.default=a}).call(this,r(11))},373:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=i(r(158)),o=i(r(369)),s=i(r(76));function i(e){return e&&e.__esModule?e:{default:e}}var u=r(107),c=function(t){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.mapControll=null,t.mapElem=null,t.onOrderCreate=t.onOrderCreate.bind(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,t),n(r,[{key:"componentDidMount",value:function(){var e=this;u({key:"AIzaSyDdJjjkx2zXC_pIjlW7MtTgU2HvYFrqIqY"}).then((function(t){e.mapControll=new a.default(t),e.mapControll.createMap(e.mapElem)})),firebaseProj.database().ref("/").once("value").then((function(t){e.mapControll.loadData(t.val())}))}},{key:"render",value:function(){var t=this;return e.createElement(e.Fragment,null,e.createElement("div",{id:"map",ref:function(e){return t.mapElem=e}},"."),e.createElement("div",{className:"mt-3 d-flex justify-content-center"},e.createElement(o.default,{onCreate:this.onOrderCreate})))}},{key:"onOrderCreate",value:function(e){this.mapControll.createOrder(e)}}]),r}(e.Component);t.default=(0,s.default)(c)}).call(this,r(11))},76:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(152),s=(n=o)&&n.__esModule?n:{default:n},i=r(59);t.default=function(t){return function(r){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,r),a(n,[{key:"render",value:function(){return firebaseProj.auth().currentUser?e.createElement(e.Fragment,null,e.createElement(s.default,null),e.createElement(t,null)):e.createElement(i.Redirect,{to:"/"})}}]),n}(e.Component)}}).call(this,r(11))}}]);